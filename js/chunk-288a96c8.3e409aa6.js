(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-288a96c8"],{"6d79":function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));r("caad"),r("d3b7"),r("ac1f"),r("25f0"),r("2532"),r("841c");var n=r("54f8"),o={name:"cassUtil",data:function(){return{}},methods:{getOrganizationByEcPk:function(e,t,r){var o=e.toPem(),a={size:1e4};EcOrganization.search(window.repo,"",(function(e){var a,s=Object(n["a"])(e);try{for(s.s();!(a=s.n()).done;){var i=a.value;try{var c,d=i.getOrgKeys(),l=Object(n["a"])(d);try{for(l.s();!(c=l.n()).done;){var u=c.value;if(u&&u.toPk().toPem().equals(o))return void t(i)}}catch(p){l.e(p)}finally{l.f()}}catch(h){r(h.toString())}}}catch(p){s.e(p)}finally{s.f()}t(null)}),(function(e){r(e)}),a)},getOrganizationEcPk:function(e){try{return e.getCurrentOrgKey().toPk()}catch(t){return null}},getPersonEcPk:function(e){var t=this.generateProbablePersonFingerprintFromShortId(e.shortId());if(e.owner){var r,o=Object(n["a"])(e.owner);try{for(o.s();!(r=o.n()).done;){var a=r.value,s=EcPk.fromPem(a);if(t.equals(s.fingerprint()))return s}}catch(i){o.e(i)}finally{o.f()}}return null},addAllOwnersFromObjectToObject:function(e,t){if(e&&e.owner){var r,o=Object(n["a"])(e.owner);try{for(o.s();!(r=o.n()).done;){var a=r.value,s=EcPk.fromPem(a);t.addOwner(s)}}catch(i){o.e(i)}finally{o.f()}}},setDefaultBrowserConfigId:function(e){localStorage.setItem("cassAuthoringToolDefaultBrowserConfigId",e)},removeDefaultBrowserConfig:function(){localStorage.removeItem("cassAuthoringToolDefaultBrowserConfigId")},getDefaultBrowserConfigId:function(){return localStorage.getItem("cassAuthoringToolDefaultBrowserConfigId")},getBooleanValue:function(e){return"boolean"===typeof e?e:"string"===typeof e&&!!e.equalsIgnoreCase("true")},addAllIdentityPksAsOwners:function(e){if(EcIdentityManager&&EcIdentityManager.ids&&EcIdentityManager.ids.length>0)for(var t=0;t<EcIdentityManager.ids.length;t++)e.addOwner(EcIdentityManager.ids[t].ppk.toPk())},isObjectOwnerless:function(e){return!e.owner||0===e.owner.length},doesAnyIdentityOwnObject:function(e){if(!EcIdentityManager||!EcIdentityManager.ids||EcIdentityManager.ids.length<=0)return!1;for(var t=0;t<EcIdentityManager.ids.length;t++)if(e.hasOwner(EcIdentityManager.ids[t].ppk.toPk()))return!0;return!1},generateProbablePersonFingerprintFromShortId:function(e){return e.substring(e.lastIndexOf("/")+1)},isPersonIdAnObjectOwner:function(e,t){if(!t.owner||0===t.owner.length)return!1;var r,o=this.generateProbablePersonFingerprintFromShortId(e),a=Object(n["a"])(t.owner);try{for(a.s();!(r=a.n()).done;){var s=r.value,i=EcPk.fromPem(s).fingerprint();if(i.equals(o))return!0}}catch(c){a.e(c)}finally{a.f()}return!1},isPersonIdAnObjectReader:function(e,t){if(!t.reader||0===t.reader.length)return!1;var r,o=this.generateProbablePersonFingerprintFromShortId(e),a=Object(n["a"])(t.reader);try{for(a.s();!(r=a.n()).done;){var s=r.value,i=EcPk.fromPem(s).fingerprint();if(i.equals(o))return!0}}catch(c){a.e(c)}finally{a.f()}return!1},areAnyIdentitiesThisPerson:function(e){var t=e.getFingerprint();if(EcIdentityManager&&EcIdentityManager.ids&&EcIdentityManager.ids.length>0)for(var r=0;r<EcIdentityManager.ids.length;r++)if(EcIdentityManager.ids[r].ppk.toPk().fingerprint().equals(t))return!0;return!1},isPersonalIdentityAnObjectOwner:function(e){if(!e.owner||0===e.owner.length)return!1;var t=this.getPersonalIdentityPk().toPem();return e.owner.includes(t)},getPersonalIdentityPk:function(){return EcIdentityManager&&EcIdentityManager.ids&&EcIdentityManager.ids.length>0?EcIdentityManager.ids[0].ppk.toPk():null},buildEcAlignmentsFromRemoteLinkedData:function(e){var t,r=[],o=Object(n["a"])(e);try{for(o.s();!(t=o.n()).done;){var a=t.value,s=new EcAlignment;s.copyFrom(a),r.push(s)}}catch(i){o.e(i)}finally{o.f()}return r}},computed:{amLoggedIn:function(){return!!(EcIdentityManager&&EcIdentityManager.ids&&EcIdentityManager.ids.length>0)}}}},8138:function(e,t,r){"use strict";var n=r("cce9"),o=r.n(n);o.a},"984b":function(e,t,r){},a434:function(e,t,r){"use strict";var n=r("23e7"),o=r("23cb"),a=r("a691"),s=r("50c4"),i=r("7b0b"),c=r("65f0"),d=r("8418"),l=r("1dde"),u=l("splice"),p=Math.max,h=Math.min,m=9007199254740991,f="Maximum allowed length exceeded";n({target:"Array",proto:!0,forced:!u},{splice:function(e,t){var r,n,l,u,v,w,y=i(this),g=s(y.length),k=o(e,g),b=arguments.length;if(0===b?r=n=0:1===b?(r=0,n=g-k):(r=b-2,n=h(p(a(t),0),g-k)),g+r-n>m)throw TypeError(f);for(l=c(y,n),u=0;u<n;u++)v=k+u,v in y&&d(l,u,y[v]);if(l.length=n,r<n){for(u=k;u<g-n;u++)v=u+n,w=u+r,v in y?y[w]=y[v]:delete y[w];for(u=g;u>g-n+r;u--)delete y[u-1]}else if(r>n)for(u=g-n;u>k;u--)v=u+n-1,w=u+r-1,v in y?y[w]=y[v]:delete y[w];for(u=0;u<r;u++)y[u+k]=arguments[u+2];return y.length=g-n+r,l}})},a907:function(e,t,r){},ad86:function(e,t,r){"use strict";var n=r("a907"),o=r.n(n);o.a},af07:function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"modal cass-editor___modal",class:[{"is-active":e.active},"is-"+e.size,"cass-editor__modal--"+e.content],attrs:{id:"cass-modal"}},[r("div",{staticClass:"modal-background"}),r("div",{staticClass:"modal-card",class:"cass-editor__modal-card--"+e.size},[r("header",{staticClass:"modal-card-head is-size-4 has-text-weight-bold",class:["has-background-"+e.type,"has-text-"+e.fontColor]},[r("p",{staticClass:"modal-card-title"},[e._t("modal-header")],2),e.canClose?r("button",{staticClass:"delete",attrs:{"aria-label":"close"},on:{click:function(t){e.$store.commit("app/closeModal"),e.$emit("close")}}}):e._e()]),r("div",{staticClass:"modal-card-body has-text-dark"},[e._t("modal-body")],2),r("footer",{staticClass:"modal-card-foot has-background-white"},[e._t("modal-foot")],2)])])},o=[],a=(r("984b"),{name:"ModalTemplate",props:{canClose:{type:Boolean,default:!0},active:{type:Boolean,default:!1},type:{default:"primary",type:String},fontColor:{type:String,default:"white"},size:{type:String,default:"medium"},content:{defualt:"default",type:String}},data:function(){return{}},computed:{}}),s=a,i=(r("ad86"),r("2877")),c=Object(i["a"])(s,n,o,!1,null,null,null);t["a"]=c.exports},c24a:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("modal-template",{attrs:{active:!0,type:"primary"},on:{close:function(t){e.closeModal,e.$emit("close")}}},[r("template",{slot:"modal-header"},[r("span",{staticClass:"title has-text-white"},[e._v("Share "+e._s(e.objectType))]),r("br"),r("span",{staticClass:"subtitle has-text-white has-text-weight-medium"},[e._v(" Sharing settings for "+e._s(e.frameworkName)+" "+e._s(e.objectType)+" ")])]),e.isProcessing?r("template",{slot:"modal-body"},[r("h2",{staticClass:"header has-text-centered"},[e._v(" Processing request... ")]),r("div",{staticClass:"section has-background-white has-text-centered"},[r("span",{staticClass:"icon is-large"},[r("i",{staticClass:"fa fa-spinner fa-2x fa-pulse"})])])]):e.confirmMakePrivate?r("template",{slot:"modal-body"},[r("h2",{staticClass:"header is-size-3"},[e._v(" Confirm make private ")]),r("p",[e._v(" Making this "+e._s(e.objectType)+" private means only those users/groups in your access list will have the ability to read, write, or edit this "+e._s(e.objectType)+". ")])]):e.confirmMakePublic?r("template",{slot:"modal-body"},[r("h2",{staticClass:"header is-size-3"},[e._v(" Confirm make public ")]),r("p",[e._v(" Making this "+e._s(e.objectType)+" public means anyone with a link can access and read this "+e._s(e.objectType)+". Only those with admin access will be able to edit or delete the "+e._s(e.objectType)+". ")])]):e.confirmMakePublic||e.confirmMakePrivate?e._e():r("template",{slot:"modal-body"},[e.shareEnabled?r("div",{staticClass:"columns box is-mobile is-multiline"},[r("div",{staticClass:"column is-12"},[r("h3",{staticClass:"has-text-weight-bold"},[e._v(" Shareable link ")])]),r("div",{staticClass:"column"},[r("p",{staticClass:"share-url has-text-weight-light"},[e._v(" "+e._s(e.shareableFrameworkInEditor)+" ")])]),r("div",{staticClass:"column is-narrow"},[r("div",{directives:[{name:"clipboard",rawName:"v-clipboard",value:e.shareableFrameworkInEditor,expression:"shareableFrameworkInEditor"},{name:"clipboard",rawName:"v-clipboard:success",value:e.successfulClip,expression:"successfulClip",arg:"success"},{name:"clipboard",rawName:"v-clipboard:error",value:e.errorClip,expression:"errorClip",arg:"error"}],staticClass:"button is-outlined is-large is-primary",attrs:{title:"Copy URL to the clipboard."}},["ready"===e.clipStatus?r("i",{staticClass:"fa fa-copy"}):e._e(),"success"===e.clipStatus?r("i",{staticClass:"fa fa-check"}):e._e(),"error"===e.clipStatus?r("i",{staticClass:"fa fa-times"}):e._e()])])]):e._e(),e.canEditFramework&&e.userManagementEnabled?r("div",{staticClass:"columns is-multiline is-mobile"},[0===e.ownerCount?r("div",[e._v(" To add users or groups or to make your "+e._s(e.objectType)+" private, first add yourself as an owner. "),r("button",{on:{click:e.makeCurrentUserAnOwner}},[e._v(" Make me an owner ")])]):r("div",{staticClass:"column is-12"},[r("div",{staticClass:"columns is-vcentered is-mobile"},[r("div",{staticClass:"column"},[r("label",{staticClass:"label"},[e._v("Add users or groups")])]),e.loggedIn?r("div",{staticClass:"column is-narrow"},[r("div",{staticClass:"buttons has-addons is-pulled-right"},[r("button",{staticClass:"button is-small is-link",class:{"is-outlined":e.privateFramework},on:{click:e.handlePublicClick}},[e._v(" Public ")]),r("button",{staticClass:"button is-small is-link",class:{"is-outlined":!e.privateFramework},on:{click:e.handlePrivateClick}},[e._v(" Private ")])])]):e._e()]),r("div",{staticClass:"field is-grouped"},[r("div",{staticClass:"control is-expanded share auto-complete__control"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.search,expression:"search"}],staticClass:"input share is-fullwidth",attrs:{type:"search",placeholder:"search"},domProps:{value:e.search},on:{blur:e.closeAutoComplete,input:[function(t){t.target.composing||(e.search=t.target.value)},e.filterResults]}}),r("div",{directives:[{name:"show",rawName:"v-show",value:e.isOpenAutocomplete,expression:"isOpenAutocomplete"}],staticClass:"auto"},[r("ul",e._l(e.filtered,(function(t,n){return r("li",{key:n,on:{mousedown:function(r){return e.selectUserOrGroup(t)}}},[e._v(" "+e._s(t.name+" ("+t.email+")")+" ")])})),0)])]),r("div",{staticClass:"control"},[r("div",{staticClass:"select is-dark"},[r("select",{directives:[{name:"model",rawName:"v-model",value:e.selectViewOrAdmin,expression:"selectViewOrAdmin"}],on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selectViewOrAdmin=t.target.multiple?r:r[0]}}},e._l(e.viewOptions,(function(t,n){return r("option",{key:n,attrs:{disabled:t.disabled,title:t.title},domProps:{value:t.value}},[e._v(" "+e._s(t.label)+" ")])})),0)])]),r("div",{staticClass:"control is-narrow"},[r("div",{staticClass:"button is-outlined is-primary",on:{click:e.saveSettings}},[r("span",{staticClass:"icon"},[r("i",{staticClass:"fa fa-save"})]),r("span",[e._v("Add Selection")])])])])]),e.canEditFramework?r("div",{staticClass:"column is-12"},[e.groups.length>0?r("div",{staticClass:"table-container"},[r("table",{staticClass:"table is-fullwidth"},[r("thead",[r("tr",[r("th",[r("abbr",{attrs:{title:"Username"}},[e._v("Group Name")])]),r("th",[r("abbr",{attrs:{title:"Access"}},[e._v("View")])]),r("th",[r("abbr",{attrs:{title:"Delete"}},[e._v("Delete")])])])]),r("tbody",e._l(e.groups,(function(t){return r("tr",{key:t},[r("td",[e._v(" "+e._s(t.header))]),r("td",[r("div",{staticClass:"select is-small is-primary"},[r("select",{directives:[{name:"model",rawName:"v-model",value:t.view,expression:"group.view"}],on:{change:[function(r){var n=Array.prototype.filter.call(r.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(t,"view",r.target.multiple?n:n[0])},function(e){t.changed=!0}]}},e._l(e.viewOptions,(function(t){return r("option",{key:t,domProps:{value:t.value}},[e._v(" "+e._s(t.label)+" ")])})),0)])]),r("td",[r("div",{staticClass:"button is-text is-small has-text-danger",attrs:{disabled:t.currentUser&&1===e.numGroupsAsOwner&&"admin"==t.view&&e.cantRemoveCurrentUserAsOwner&&!e.userIsOwner},on:{click:function(r){return e.removeOwnerOrReader(t,"group")}}},[r("div",{staticClass:"icon"},[r("i",{staticClass:"fa fa-trash"})])])])])})),0)])]):e._e()]):e._e(),e.canEditFramework?r("div",{staticClass:"column is-12"},[e.users.length>0?r("div",{staticClass:"table-container"},[r("table",{staticClass:"table is-fullwidth"},[r("thead",[r("tr",[r("th",[r("abbr",{attrs:{title:"User name"}},[e._v("User Name")])]),r("th",[r("abbr",{attrs:{title:"User email"}},[e._v("User Email")])]),r("th",[r("abbr",{attrs:{title:"Access"}},[e._v("View")])]),r("th",[r("abbr",{attrs:{title:"Delete"}},[e._v("Delete")])])])]),r("tbody",e._l(e.users,(function(t){return r("tr",{key:t},[r("td",[e._v(" "+e._s(t.header))]),r("td",[e._v(" "+e._s(t.email))]),r("td",[r("div",{staticClass:"select is-primary is-small"},[r("select",{directives:[{name:"model",rawName:"v-model",value:t.view,expression:"user.view"}],on:{change:[function(r){var n=Array.prototype.filter.call(r.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(t,"view",r.target.multiple?n:n[0])},function(r){t.changed=!0,e.saveSettings()}]}},e._l(e.viewOptions,(function(t){return r("option",{key:t,domProps:{value:t.value}},[e._v(" "+e._s(t.label)+" ")])})),0)])]),r("td",[r("div",{staticClass:"button is-text is-small has-text-danger",attrs:{disabled:e.cantRemoveCurrentUserAsOwner&&t.currentUser&&!e.numGroupsAsOwner},on:{click:function(r){return e.removeOwnerOrReader(t,"user")}}},[r("div",{staticClass:"icon"},[r("i",{staticClass:"fa fa-trash"})])])])])})),0)])]):e._e()]):e._e()]):e._e()]),r("template",{slot:"modal-foot"},[e.confirmMakePrivate||e.confirmMakePublic?e._e():r("div",{staticClass:"buttons is-spaced"},[r("button",{staticClass:"button is-primary is-outlined",attrs:{disabled:e.isProcessing},on:{click:function(t){return e.$store.commit("app/closeModal")}}},[e._v(" Done ")])]),e.confirmMakePrivate?r("div",{staticClass:"buttons is-centered"},[r("div",{staticClass:"button is-dark is-outlined",attrs:{disabled:e.isProcessing},on:{click:function(t){e.confirmMakePrivate=!1}}},[r("span",{staticClass:"icon"},[r("i",{staticClass:"fa fa-times"})]),r("span",[e._v("cancel")])]),r("div",{staticClass:"button is-primary is-outlined",attrs:{disabled:e.isProcessing},on:{click:e.makePrivate}},[r("span",{staticClass:"icon"},[r("i",{staticClass:"fa fa-check"})]),r("span",[e._v("confirm make private")])])]):e._e(),e.confirmMakePublic?r("div",{staticClass:"buttons is-centered"},[r("div",{staticClass:"button is-dark is-outlined",attrs:{disabled:e.isProcessing},on:{click:function(t){e.confirmMakePublic=!1}}},[r("span",{staticClass:"icon"},[r("i",{staticClass:"fa fa-times"})]),r("span",[e._v("cancel")])]),r("div",{staticClass:"button is-primary is-outlined",attrs:{disabled:e.isProcessing},on:{click:e.makePublic}},[r("span",{staticClass:"icon"},[r("i",{staticClass:"fa fa-check"})]),r("span",[e._v("confirm make public")])])]):e._e()])],2)},o=[],a=(r("4de4"),r("a434"),r("b0c0"),r("ac1f"),r("5319"),r("841c"),r("6d79")),s=r("af07"),i={name:"ShareModal",props:{isActive:Boolean},components:{ModalTemplate:s["a"]},mixins:[a["a"]],data:function(){return{isProcessing:!1,confirmMakePrivate:!1,confirmMakePublic:!1,clipStatus:"ready",viewOptions:[{label:"Admin",value:"admin",disabled:!1,title:null},{label:"View",value:"view",disabled:!0,title:"Make the "+(this.$store.getters["editor/conceptMode"]?"concept scheme":"framework")+" private to add users/groups with view access"}],groups:[],users:[],search:"",filtered:[],possibleGroupsAndUsers:[],isOpenAutocomplete:!1,userOrGroupToAdd:null,selectViewOrAdmin:"admin",removeReader:[],removeOwner:[],addReader:[],privateFramework:!1,addOwner:[],repo:window.repo,conceptsProcessed:0,conceptsToProcess:0,cantRemoveCurrentUserAsOwner:!1,ownerCount:0,decryptingConcepts:!1,toSave:[],frameworksToProcess:0,numGroupsAsOwner:0,userIsOwner:!1}},computed:{loggedIn:function(){return!!(EcIdentityManager.ids&&EcIdentityManager.ids.length>0)},shareableFrameworkInEditor:function(){var e=window.location.href;return e=e.replace("/frameworks","").replace("/directory",""),this.directory?e+"?directoryId="+this.directory.shortId():!0===this.$store.getters["editor/conceptMode"]?e+"?concepts=true&frameworkId="+this.frameworkId:e+"?frameworkId="+this.frameworkId},framework:function(){return!this.objFromListItemInfo||"Framework"!==this.objFromListItemInfo.type&&"ConceptScheme"!==this.objFromListItemInfo.type?this.$store.state.editor.framework:this.objFromListItemInfo},frameworkId:function(){return this.framework?this.framework.shortId():null},directory:function(){return this.objFromListItemInfo&&"Directory"===this.objFromListItemInfo.type?this.objFromListItemInfo:this.objFromListItemInfo||"framework"===this.$route.name||"conceptScheme"===this.$route.name?null:this.$store.getters["app/selectedDirectory"]},resource:function(){return this.objFromListItemInfo&&"CreativeWork"===this.objFromListItemInfo.type?this.objFromListItemInfo:null},frameworkName:function(){return this.directory?this.directory.name:this.resource?this.resource.name:this.framework.name?Thing.getDisplayStringFrom(this.framework.name):Thing.getDisplayStringFrom(this.framework["dcterms:title"])},queryParams:function(){return this.$store.getters["editor/queryParams"]},canEditFramework:function(){return!!this.loggedIn&&((!this.queryParams||"true"!==this.queryParams.view)&&(!(this.framework&&!this.framework.canEditAny(EcIdentityManager.getMyPks()))&&(!(this.directory&&!this.directory.canEditAny(EcIdentityManager.getMyPks()))&&!(this.resource&&!this.resource.canEditAny(EcIdentityManager.getMyPks())))))},loggedOnPerson:function(){return this.$store.getters["user/loggedOnPerson"]},objectType:function(){return this.resource?"resource":this.directory?"directory":this.$store.getters["editor/conceptMode"]?"concept scheme":"framework"},shareEnabled:function(){return!this.resource&&this.$store.state.featuresEnabled.shareEnabled},userManagementEnabled:function(){return this.$store.state.featuresEnabled.userManagementEnabled},objFromListItemInfo:function(){return this.$store.getters["app/objForShareModal"]}},mounted:function(){if(this.objFromListItemInfo&&this.objFromListItemInfo.encryptedType){var e="Ec"+this.object.encryptedType,t=new EcEncryptedValue;t.copyFrom(this.object);var r=new window[e];r.copyFrom(t.decryptIntoObject()),this.$store.commit("app/objForShareModal",r)}this.getCurrentOwnersAndReaders(!0),this.checkIsPrivate()},methods:{handlePrivateClick:function(){this.privateFramework||(this.confirmMakePrivate=!0)},handlePublicClick:function(){this.privateFramework&&(this.confirmMakePublic=!0)},checkIsPrivate:function(){var e=this.directory?this.directory:this.resource?this.resource:this.framework;delete EcRepository.cache[e.shortId()];var t=this;EcRepository.get(e.shortId(),(function(e){"EncryptedValue"===e.type?(t.privateFramework=!0,t.viewOptions[1].disabled=!1,t.viewOptions[1].title=null,t.cantRemoveCurrentUserAsOwner=!0):(t.privateFramework=!1,t.viewOptions[1].disabled=!0,t.viewOptions[1].title="Make the "+t.objectType+" private to add users/groups with view access",t.ownerCount<2&&(t.cantRemoveCurrentUserAsOwner=!1))}),(function(e){appError(e)}))},closeAutoComplete:function(){this.isOpenAutocomplete=!1},successfulClip:function(e){var t=this,r=e.value;e.event;appLog("success",r),this.clipStatus="success",setTimeout((function(){t.clipStatus="ready"}),1e3)},errorClip:function(e){var t=this,r=e.value;e.event;appLog("error",r),this.clipStatus="error",setTimeout((function(){t.clipStatus="ready"}),1e3)},getEachOwner:function(e){var t=EcPk.fromPem(e),r=this;EcPerson.getByPk(window.repo,t,(function(e){if(appLog(e),e){var n=!1;r.loggedOnPerson.shortId()===e.shortId()&&(n=!0,r.userIsOwner=!0);var o={header:e.name,email:e.email,view:"admin",id:e.shortId(),changed:!1,pk:t,currentUser:n};r.users.push(o),r.ownerCount++}}),(function(e){r.getOrganizationByEcPk(t,(function(e){if(appLog(e),e){var n=t.fingerprint(),o=!1;for(var a in EcIdentityManager.ids){var s=EcIdentityManager.ids[a].ppk.toPk().fingerprint();n.equals(s)&&(o=!0,r.numGroupsAsOwner++)}var i={header:e.name,view:"admin",id:e.shortId(),changed:!1,pk:t,currentUser:o};r.groups.push(i),r.ownerCount++}}),(function(e){appError(e)}))}))},getEachReader:function(e){var t=this,r=EcPk.fromPem(e);EcPerson.getByPk(window.repo,r,(function(e){if(appLog(e),e){var n={header:e.name,email:e.email,view:"view",id:e.shortId(),changed:!1,pk:r};t.users.push(n)}}),(function(e){t.getOrganizationByEcPk(r,(function(e){if(appLog(e),e){var n={header:e.name,view:"view",id:e.shortId(),changed:!1,pk:r};t.groups.push(n)}}),(function(e){appError(e)}))}))},getCurrentOwnersAndReaders:function(e){var t=this,r=this;r.numGroupsAsOwner=0,r.userIsOwner=!1;var n=this.directory?this.directory:this.resource?this.resource:this.framework;if(n.owner)for(var o=0;o<n.owner.length;o++)this.getEachOwner(n.owner[o]);if(n.reader){this.cantRemoveCurrentUserAsOwner=!0;for(o=0;o<n.reader.length;o++)this.getEachReader(n.reader[o])}e&&setTimeout((function(){t.getPossibleOwnersAndReaders()}),4e3)},getPossibleOwnersAndReaders:function(){var e={size:1e4},t=this;EcPerson.search(window.repo,"",(function(e){appLog(e);for(var r=0;r<e.length;r++){var n={id:e[r].shortId(),name:e[r].name,email:e[r].email,pk:t.getPersonEcPk(e[r])};t.possibleGroupsAndUsers.push(n)}}),(function(e){appError(e)}),e),EcOrganization.search(window.repo,"",(function(e){appLog(e);for(var r=0;r<e.length;r++){var n=t.getOrganizationEcPk(e[r]);if(n){var o={id:e[r].shortId(),name:e[r].name,pk:n};t.possibleGroupsAndUsers.push(o)}}}),(function(e){appError(e)}),e)},filterResults:function(){var e=this;this.isOpenAutocomplete=!0,this.filtered=this.possibleGroupsAndUsers.filter((function(t){return-1!==t.name.toLowerCase().indexOf(e.search.toLowerCase())}))},selectUserOrGroup:function(e){this.userOrGroupToAdd=e,this.search=e.name,this.isOpenAutocomplete=!1},saveSettings:function(){this.populateAddAndRemoveArrays(),this.addAndRemoveFromAllObjects()},populateAddAndRemoveArrays:function(){this.isProcessing=!0;for(var e=0;e<this.users.length;e++)this.users[e].changed&&("view"===this.users[e].view?(this.removeOwner.push(this.users[e].pk),this.addReader.push(this.users[e].pk)):"admin"===this.users[e].view&&(this.removeReader.push(this.users[e].pk),this.addOwner.push(this.users[e].pk)));for(var t=0;t<this.groups.length;t++)this.groups[t].changed&&("view"===this.groups[t].view?(this.removeOwner.push(this.groups[t].pk),this.addReader.push(this.groups[t].pk)):"admin"===this.groups[t].view&&(this.removeReader.push(this.groups[t].pk),this.addOwner.push(this.groups[t].pk)));this.userOrGroupToAdd&&("view"===this.selectViewOrAdmin?this.addReader.push(this.userOrGroupToAdd.pk):"admin"===this.selectViewOrAdmin&&this.addOwner.push(this.userOrGroupToAdd.pk)),this.addReader.length>0&&this.addOwner.push(EcIdentityManager.ids[0].ppk.toPk())},multiput:function(e,t){var r=this;this.frameworksToProcess--,this.frameworksToProcess<=0&&this.repo.multiput(e,(function(e){r.resetVariables(),r.confirmMakePublic=!1,r.confirmMakePrivate||r.getCurrentOwnersAndReaders(),r.confirmMakePrivate=!1,t&&t()}),appError)},addAndRemoveFromAllObjects:function(){return this.resource?this.addAndRemoveFromResource(this.resource):this.directory?this.addAndRemoveFromAllDirectoryObjects(this.directory):!0===this.$store.getters["editor/conceptMode"]?this.addAndRemoveFromAllConceptObjects():this.addAndRemoveFromAllFrameworkObjects(this.framework)},addAndRemoveFromAllDirectoryObjects:function(e){for(var t=this,r=0;r<t.removeReader.length;r++)e.removeReader(t.removeReader[r]);for(var n=0;n<t.removeOwner.length;n++)e.removeOwner(t.removeOwner[n]);for(var o=0;o<t.addReader.length;o++)e.addReader(t.addReader[o]);for(var a=0;a<t.addOwner.length;a++)e.addOwner(t.addOwner[a]);t.toSave.push(e),this.repo.search('(directory:"'+e.shortId()+'" OR parentDirectory:"'+e.shortId()+'")',(function(){}),(function(e){t.frameworksToProcess+=e.length,(new EcAsyncHelper).each(e,(function(e,r){"Framework"===e.type||"Framework"===e.encryptedType?t.addAndRemoveFromAllFrameworkObjects(e):"CreativeWork"===e.type||"CreativeWork"===e.encryptedType?t.addAndRemoveFromResource(e):"Directory"!==e.type&&"Directory"!==e.encryptedType||(t.frameworksToProcess--,t.addAndRemoveFromAllDirectoryObjects(e)),r()}),(function(e){0===e.length&&t.multiput(t.toSave)}))}),appError)},addAndRemoveFromResource:function(e){for(var t=0;t<this.removeReader.length;t++)e.removeReader(this.removeReader[t]);for(var r=0;r<this.removeOwner.length;r++)e.removeOwner(this.removeOwner[r]);for(var n=0;n<this.addReader.length;n++)e.addReader(this.addReader[n]);for(var o=0;o<this.addOwner.length;o++)e.addOwner(this.addOwner[o]);this.toSave.push(e),this.multiput(this.toSave)},addAndRemoveFromAllFrameworkObjects:function(e,t){var r=this;e.competency&&e.competency.length>0?(new EcAsyncHelper).each(e.competency,(function(e,t){EcCompetency.get(e,(function(e){for(var n=0;n<r.removeReader.length;n++)e.removeReader(r.removeReader[n]);for(var o=0;o<r.removeOwner.length;o++)e.removeOwner(r.removeOwner[o]);for(var a=0;a<r.addReader.length;a++)e.addReader(r.addReader[a]);for(var s=0;s<r.addOwner.length;s++)e.addOwner(r.addOwner[s]);r.toSave.push(e),t()}),t)}),(function(t){e.relation&&e.relation.length>0?(new EcAsyncHelper).each(e.relation,(function(e,t){EcAlignment.get(e,(function(e){for(var n=0;n<r.removeReader.length;n++)e.removeReader(r.removeReader[n]);for(var o=0;o<r.removeOwner.length;o++)e.removeOwner(r.removeOwner[o]);for(var a=0;a<r.addReader.length;a++)e.addReader(r.addReader[a]);for(var s=0;s<r.addOwner.length;s++)e.addOwner(r.addOwner[s]);r.toSave.push(e),t()}),t)}),(function(t){r.addAndRemoveFromFrameworkObject(e)})):r.addAndRemoveFromFrameworkObject(e)})):r.addAndRemoveFromFrameworkObject(e)},addAndRemoveFromFrameworkObject:function(e){for(var t=this,r=0;r<t.removeReader.length;r++)e.removeReader(t.removeReader[r]);for(var n=0;n<t.removeOwner.length;n++)e.removeOwner(t.removeOwner[n]);for(var o=0;o<t.addReader.length;o++)e.addReader(t.addReader[o]);for(var a=0;a<t.addOwner.length;a++)e.addOwner(t.addOwner[a]);t.toSave.push(e),t.multiput(t.toSave,(function(){t.framework&&t.$store.commit("editor/framework",e)}),(function(){}))},addAndRemoveFromAllConceptObjects:function(){this.framework["skos:hasTopConcept"]&&this.addAndRemoveFromConceptArray(this.framework["skos:hasTopConcept"])},addAndRemoveFromConceptArray:function(e){this.conceptsToProcess+=e.length;var t=this;(new EcAsyncHelper).each(e,(function(e,r){EcConcept.get(e,(function(e){for(var n=0;n<t.removeReader.length;n++)e.removeReader(t.removeReader[n]);for(var o=0;o<t.removeOwner.length;o++)e.removeOwner(t.removeOwner[o]);for(var a=0;a<t.addReader.length;a++)e.addReader(t.addReader[a]);for(var s=0;s<t.addOwner.length;s++)e.addOwner(t.addOwner[s]);e["skos:narrower"]&&t.addAndRemoveFromConceptArray(e["skos:narrower"]),t.conceptsProcessed++,t.toSave.push(e),r()}),r)}),(function(){}))},removeOwnerOrReader:function(e,t){if("user"===t){if(this.cantRemoveCurrentUserAsOwner&&e.currentUser&&!this.numGroupsAsOwner)return}else if("group"===t&&e.currentUser&&1===this.numGroupsAsOwner&&"admin"===e.view&&this.cantRemoveCurrentUserAsOwner&&!this.userIsOwner)return;"view"===e.view?this.removeReader.push(e.pk):"admin"===e.view&&this.removeOwner.push(e.pk),this.saveSettings()},resetVariables:function(){var e=this;e.users.splice(0,e.users.length),e.groups.splice(0,e.groups.length),e.removeOwner.splice(0,e.removeOwner.length),e.removeReader.splice(0,e.removeReader.length),e.addOwner.splice(0,e.addOwner.length),e.addReader.splice(0,e.addReader.length),e.userOrGroupToAdd=null,e.search="",e.conceptsProcessed=0,e.conceptsToProcess=0,e.isProcessing=!1,e.privateFramework||(e.cantRemoveCurrentUserAsOwner=!1),e.ownerCount=0,e.selectViewOrAdmin="admin",e.toSave.splice(0,e.toSave.length),e.decryptingConcepts=!1},makePrivate:function(){this.isProcessing=!0;var e=this.framework;return this.$store.commit("editor/private",!0),this.resource?this.handleMakePrivateResource(this.resource):this.directory?this.handleMakePrivateDirectory(this.directory):void(!0===this.$store.getters["editor/conceptMode"]?this.handleMakePrivateConceptScheme():this.handleMakePrivateFramework(e))},handleMakePrivateDirectory:function(e){var t=this;e.canEditAny(EcIdentityManager.getMyPks())&&(e.owner||e.addOwner(EcIdentityManager.ids[0].ppk.toPk()),this.directory.shortId()===e.shortId()&&this.$store.commit("app/selectDirectory",e),e["schema:dateModified"]=(new Date).toISOString(),EcEncryptedValue.toEncryptedValueAsync(e,!1,(function(r){t.toSave.push(r),t.repo.search('(directory:"'+e.shortId()+'" OR parentDirectory:"'+e.shortId()+'")',(function(){}),(function(e){t.frameworksToProcess+=e.length,(new EcAsyncHelper).each(e,(function(e,r){"Framework"===e.type?t.handleMakePrivateFramework(e):"CreativeWork"===e.type?t.handleMakePrivateResource(e):"Directory"===e.type?(t.frameworksToProcess--,t.handleMakePrivateDirectory(e)):t.frameworksToProcess--,r()}),(function(e){0===e.length&&t.multiput(t.toSave)}))}),appError)}),appError))},handleMakePrivateResource:function(e){var t=this;e.canEditAny(EcIdentityManager.getMyPks())&&(e.owner||e.addOwner(EcIdentityManager.ids[0].ppk.toPk()),this.resource&&this.$store.commit("app/objForShareModal",e),e["schema:dateModified"]=(new Date).toISOString(),EcEncryptedValue.toEncryptedValueAsync(e,!1,(function(e){t.toSave.push(e),t.multiput(t.toSave)}),appError))},handleMakePrivateFramework:function(e){var t=this;e.competency&&e.competency.length>0?(new EcAsyncHelper).each(e.competency,(function(e,r){EcCompetency.get(e,(function(e){e.canEditAny(EcIdentityManager.getMyPks())?(e.owner||e.addOwner(EcIdentityManager.ids[0].ppk.toPk()),e["schema:dateModified"]=(new Date).toISOString(),EcEncryptedValue.toEncryptedValueAsync(e,!1,(function(e){t.toSave.push(e),r()}),r)):r()}),r)}),(function(r){e.relation&&e.relation.length>0?(new EcAsyncHelper).each(e.relation,(function(e,r){EcAlignment.get(e,(function(e){e.owner||e.addOwner(EcIdentityManager.ids[0].ppk.toPk()),EcEncryptedValue.toEncryptedValueAsync(e,!1,(function(e){t.toSave.push(e),r()}),r)}),r)}),(function(r){t.encryptFramework(e)})):t.encryptFramework(e)})):t.encryptFramework(e)},makePublic:function(){this.isProcessing=!0;var e=this.framework;return this.$store.commit("editor/private",!1),this.resource?this.handleMakePublicResource(this.resource):this.directory?this.handleMakePublicDirectory(this.directory):void(!0===this.$store.getters["editor/conceptMode"]?this.handleMakePublicConceptScheme():this.handleMakePublicFramework(e))},handleMakePublicDirectory:function(e){var t,r=this,n=new EcDirectory;"Directory"===e.type?t=EcEncryptedValue.toEncryptedValue(e):(t=new EcEncryptedValue,t.copyFrom(e)),n.copyFrom(t.decryptIntoObject()),n["schema:dateModified"]=(new Date).toISOString(),delete n.reader,EcEncryptedValue.encryptOnSave(n.id,!1),r.toSave.push(n),this.directory.shortId()===n.shortId()&&this.$store.commit("app/selectDirectory",n),this.repo.search('(directory:"'+e.shortId()+'" OR parentDirectory:"'+e.shortId()+'")',(function(){}),(function(e){r.frameworksToProcess+=e.length,(new EcAsyncHelper).each(e,(function(e,t){"Framework"===e.type||"Framework"===e.encryptedType?r.handleMakePublicFramework(e):"CreativeWork"===e.type||"CreativeWork"===e.encryptedType?r.handleMakePublicResource(e):"Directory"!==e.type&&"Directory"!==e.encryptedType||(r.frameworksToProcess--,r.handleMakePublicDirectory(e)),t()}),(function(e){0===e.length&&r.multiput(r.toSave)}))}),appError)},handleMakePublicResource:function(e){var t,r=new CreativeWork;"CreativeWork"===e.type?t=EcEncryptedValue.toEncryptedValue(e):(t=new EcEncryptedValue,t.copyFrom(e)),r.copyFrom(t.decryptIntoObject()),r["schema:dateModified"]=(new Date).toISOString(),delete r.reader,EcEncryptedValue.encryptOnSave(r.id,!1),this.toSave.push(r),this.resource&&this.$store.commit("app/objForShareModal",r),this.multiput(this.toSave)},handleMakePublicFramework:function(e){var t,r=this,n=new EcFramework;"Framework"===e.type?t=EcEncryptedValue.toEncryptedValue(e):(t=new EcEncryptedValue,t.copyFrom(e)),n.copyFrom(t.decryptIntoObject()),n["schema:dateModified"]=(new Date).toISOString(),delete n.reader,EcEncryptedValue.encryptOnSave(n.id,!1),r.toSave.push(n),this.framework&&r.$store.commit("editor/framework",n),e=n,e.competency&&e.competency.length>0?(new EcAsyncHelper).each(e.competency,(function(e,t){EcRepository.get(e,(function(e){var n;e.canEditAny(EcIdentityManager.getMyPks())?(e.isAny((new EcEncryptedValue).getTypes())?(n=new EcEncryptedValue,n.copyFrom(e)):n=EcEncryptedValue.toEncryptedValue(e),e=new EcCompetency,e.copyFrom(n.decryptIntoObject()),e["schema:dateModified"]=(new Date).toISOString(),delete e.reader,EcEncryptedValue.encryptOnSave(e.id,!1),r.toSave.push(e),t()):t()}),t)}),(function(t){e.relation&&e.relation.length>0?(new EcAsyncHelper).each(e.relation,(function(e,t){EcRepository.get(e,(function(e){var n;e.isAny((new EcEncryptedValue).getTypes())?(n=new EcEncryptedValue,n.copyFrom(e)):n=EcEncryptedValue.toEncryptedValue(e),e=new EcAlignment,e.copyFrom(n.decryptIntoObject()),delete e.reader,EcEncryptedValue.encryptOnSave(e.id,!1),r.toSave.push(e),t()}),t)}),(function(e){r.finishedMakingPublic()})):r.finishedMakingPublic()})):r.finishedMakingPublic()},finishedMakingPublic:function(){var e=this;this.multiput(this.toSave,(function(){e.framework&&(e.confirmMakePublic=!1,e.isProcessing=!1,e.resetVariables(),e.getCurrentOwnersAndReaders())}))},encryptFramework:function(e){var t=this,r=new EcFramework;r.copyFrom(e),r.owner||r.addOwner(EcIdentityManager.ids[0].ppk.toPk()),this.framework&&this.$store.commit("editor/framework",r),r["schema:dateModified"]=(new Date).toISOString(),EcEncryptedValue.toEncryptedValueAsync(r,!1,(function(e){t.toSave.push(e),t.multiput(t.toSave,(function(){t.framework&&(t.confirmMakePrivate=!1,t.cantRemoveCurrentUserAsOwner=!0,t.isProcessing=!1,t.toSave.splice(0,t.toSave.length))}))}),appError)},handleMakePrivateConceptScheme:function(){var e=this,t=this.framework,r=new EcConceptScheme;r.copyFrom(t),r.owner||r.addOwner(EcIdentityManager.ids[0].ppk.toPk()),this.$store.commit("editor/framework",r);var n=r["dcterms:title"];r["schema:dateModified"]=(new Date).toISOString(),r=EcEncryptedValue.toEncryptedValue(r),r["dcterms:title"]=n,this.toSave.push(r),t["skos:hasTopConcept"]?this.encryptConcepts(t):this.repo.multiput(this.toSave,(function(){e.confirmMakePrivate=!1,e.isProcessing=!1,e.toSave.splice(0,e.toSave.length)}),appError)},handleMakePublicConceptScheme:function(){var e=this,t=this.framework;t=EcEncryptedValue.toEncryptedValue(t);var r=new EcConceptScheme;appLog(t),appLog(t.decryptIntoObject()),appLog(r),r.copyFrom(t.decryptIntoObject()),delete r.reader,t=r,EcEncryptedValue.encryptOnSave(r.id,!1),r["schema:dateModified"]=(new Date).toISOString(),e.decryptingConcepts=!0,e.toSave.push(r),e.$store.commit("editor/framework",r),r["skos:hasTopConcept"]?e.decryptConcepts(r):e.finishedMakingPublic()},encryptConcepts:function(e){var t=this,r=e["skos:hasTopConcept"]?e["skos:hasTopConcept"]:e["skos:narrower"];(new EcAsyncHelper).each(r,(function(e,r){EcRepository.get(e,(function(e){e.owner||e.addOwner(EcIdentityManager.ids[0].ppk.toPk()),e["schema:dateModified"]=(new Date).toISOString(),e["skos:narrower"]&&e["skos:narrower"].length>0&&t.encryptConcepts(e),!0!==EcEncryptedValue.encryptOnSaveMap[e.id]&&(e=EcEncryptedValue.toEncryptedValue(e)),t.toSave.push(e),r()}),r)}),(function(e){t.repo.multiput(t.toSave,(function(){t.confirmMakePrivate=!1,t.isProcessing=!1,t.toSave.splice(0,t.toSave.length)}),appError)}))},decryptConcepts:function(e){var t=this,r=e["skos:hasTopConcept"]?e["skos:hasTopConcept"]:e["skos:narrower"];t.conceptsToProcess+=r.length,(new EcAsyncHelper).each(r,(function(e,r){EcRepository.get(e,(function(e){var n;e.isAny((new EcEncryptedValue).getTypes())?(n=new EcEncryptedValue,n.copyFrom(e)):n=EcEncryptedValue.toEncryptedValue(e),e=new EcConcept,e.copyFrom(n.decryptIntoObject()),delete e.reader,EcEncryptedValue.encryptOnSave(e.id,!1),e["skos:narrower"]&&t.decryptConcepts(e),e["schema:dateModified"]=(new Date).toISOString(),t.conceptsProcessed++,t.toSave.push(e),r()}),r)}),(function(e){}))},makeCurrentUserAnOwner:function(){return this.isProcessing=!0,this.resource?this.makeCurrentUserResourceOwner(this.resource):this.directory?this.makeCurrentUserDirectoryOwner(this.directory):!0===this.$store.getters["editor/conceptMode"]?this.makeCurrentUserAnOwnerForConceptObjects():void this.makeCurrentUserFrameworkAndSubObjectOwner(this.framework)},makeCurrentUserDirectoryOwner:function(e){var t=this;e.addOwner(EcIdentityManager.ids[0].ppk.toPk()),t.toSave.push(e),this.directory.shortId()===e.shortId()&&this.$store.commit("app/selectDirectory",e),this.repo.search('(directory:"'+e.shortId()+'" OR parentDirectory:"'+e.shortId()+'")',(function(){}),(function(e){t.frameworksToProcess+=e.length,(new EcAsyncHelper).each(e,(function(e,r){"Framework"===e.type||"Framework"===e.encryptedType?t.makeCurrentUserFrameworkAndSubObjectOwner(e):"CreativeWork"===e.type||"CreativeWork"===e.encryptedType?t.makeCurrentUserResourceOwner(e):"Directory"!==e.type&&"Directory"!==e.encryptedType||(t.frameworksToProcess--,t.makeCurrentUserDirectoryOwner(e)),r()}),(function(e){0===e.length&&t.multiput(t.toSave)}))}),appError)},makeCurrentUserResourceOwner:function(e){e.addOwner(EcIdentityManager.ids[0].ppk.toPk()),this.toSave.push(e),this.multiput(this.toSave)},makeCurrentUserFrameworkAndSubObjectOwner:function(e){var t=this;e.competency&&e.competency.length>0?(new EcAsyncHelper).each(e.competency,(function(e,r){EcCompetency.get(e,(function(e){e.addOwner(EcIdentityManager.ids[0].ppk.toPk()),t.toSave.push(e),r()}),r)}),(function(r){e.relation&&e.relation.length>0?(new EcAsyncHelper).each(e.relation,(function(e,r){EcAlignment.get(e,(function(e){e.addOwner(EcIdentityManager.ids[0].ppk.toPk()),t.toSave.push(e),r()}),r)}),(function(r){t.makeCurrentUserFrameworkOwner(e)})):t.makeCurrentUserFrameworkOwner(e)})):t.makeCurrentUserFrameworkOwner(e)},makeCurrentUserFrameworkOwner:function(e){var t=e,r=this;t.addOwner(EcIdentityManager.ids[0].ppk.toPk()),r.toSave.push(t),r.multiput(r.toSave,(function(){r.framework&&r.$store.commit("editor/framework",t)}),(function(){}))},makeCurrentUserAnOwnerForConceptObjects:function(){this.framework["skos:hasTopConcept"]&&this.makeCurrentUserAnOwnerForConcepts(this.framework["skos:hasTopConcept"])},makeCurrentUserAnOwnerForConcepts:function(e){this.conceptsToProcess+=e.length;var t=this;(new EcAsyncHelper).each(e,(function(e,r){EcConcept.get(e,(function(e){e.addOwner(EcIdentityManager.ids[0].ppk.toPk()),e["skos:narrower"]&&t.makeCurrentUserAnOwnerForConcepts(e["skos:narrower"]),t.conceptsProcessed++,t.toSave.push(e),r()}),r)}),(function(){}))}},watch:{conceptsProcessed:function(){this.conceptsToProcess&&this.conceptsProcessed===this.conceptsToProcess&&(!0===this.decryptingConcepts?this.finishedMakingPublic():this.ownerCount>0?this.addAndRemoveFromFrameworkObject(this.framework):this.makeCurrentUserFrameworkOwner(this.framework))},confirmMakePublic:function(){this.checkIsPrivate()},confirmMakePrivate:function(){this.checkIsPrivate(),this.resetVariables(),this.getCurrentOwnersAndReaders()},ownerCount:function(){this.ownerCount>1&&(this.cantRemoveCurrentUserAsOwner=!0)}}},c=i,d=(r("8138"),r("2877")),l=Object(d["a"])(c,n,o,!1,null,null,null);t["default"]=l.exports},cce9:function(e,t,r){}}]);
//# sourceMappingURL=chunk-288a96c8.3e409aa6.js.map