(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-701cdf0d"],{"38e5":function(e,t,i){"use strict";i("f44a")},9418:function(e,t,i){"use strict";i.r(t);i("99af"),i("fb6a"),i("4de4"),i("d3b7");var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"lode__hierarchy",class:{"is-dragging":e.dragging}},[t("div",{staticClass:"hierarchy-buttons"},[t("div",{staticClass:"columns is-gapless is-paddingless is-mobile is-marginless is-paddingless"},[t("div",{staticClass:"column is-narrow"},[e.expanded&&e.hierarchyEnabled?t("div",{staticClass:"icon is-vcentered",on:{click:function(t){e.expanded=!1}}},[t("i",{staticClass:"fa fa-caret-down has-text-primary is-size-2"})]):!e.expanded&&e.hierarchyEnabled?t("div",{staticClass:"icon is-vcentered",on:{click:function(t){e.expanded=!0}}},[t("i",{staticClass:"fa fa-caret-right has-text-primary is-size-2"})]):t("div",{staticClass:"icon is-vcentered"},[t("i",{staticClass:"fa fa-circle is-size-7 has-text-light"})]),e.selectButtonText?t("div",{staticClass:"button is-outlined is-primary",on:{click:function(t){return e.$emit("select-button-click",e.selectedArray)}}},[e._v(" "+e._s(e.selectButtonText)+" ")]):e._e()]),t("div",{staticClass:"column is-narrow"},[e.canEdit&&"importPreview"!==e.view&&"importLight"!==e.view&&"crosswalk"!==e.view&&e.hierarchyEnabled||e.queryParams.select||"competencySearch"===e.view?t("div",{staticClass:"pl-2 check-radio-all-column"},[t("div",{staticClass:"field"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.selectAll,expression:"selectAll"}],staticClass:"is-checkradio",attrs:{id:"selectAllCheckbox",type:"checkbox",name:"selectAllCheckbox"},domProps:{checked:Array.isArray(e.selectAll)?e._i(e.selectAll,null)>-1:e.selectAll},on:{change:function(t){var i=e.selectAll,r=t.target,n=!!r.checked;if(Array.isArray(i)){var s=null,a=e._i(i,s);r.checked?a<0&&(e.selectAll=i.concat([s])):a>-1&&(e.selectAll=i.slice(0,a).concat(i.slice(a+1)))}else e.selectAll=n}}}),t("label",{attrs:{for:"selectAllCheckbox"}})])]):e._e()]),"crosswalk"===e.view?t("div",{staticClass:"crosswalk-buttons column is-fullwidth"},[t("div",{staticClass:"buttons is-right"},[t("div",{staticClass:"button is-small is-outlined is-primary",class:{"is-focused":"showAligned"===e.filter},attrs:{title:"show aligned only"},on:{click:function(t){return e.filterHierarchy("showAligned")}}},[e._m(0)]),t("div",{staticClass:"button is-small is-outlined is-primary",class:{"is-focused":"showUnaligned"===e.filter},attrs:{title:"show unaligned only"},on:{click:function(t){return e.filterHierarchy("showUnaligned")}}},[e._m(1)]),t("div",{staticClass:"button is-outlined is-small is-primary",class:{"is-focused":"showAll"===e.filter},attrs:{title:"show all"},on:{click:function(t){return e.filterHierarchy("showAll")}}},[e._m(2)]),"crosswalkSource"===e.subview&&0===e.alignmentsToSave.length?t("button",{staticClass:"button is-small is-outlined is-dark",attrs:{title:"change source"},on:{click:e.changeFrameworkSource}},[e._m(3)]):"crosswalkTarget"===e.subview&&0===e.alignmentsToSave.length?t("button",{staticClass:"button is-small is-outlined is-dark",attrs:{title:"change target"},on:{click:e.changeFrameworkTarget}},[e._m(4)]):e._e()])]):e._e(),"crosswalk"!==e.view&&"competencySearch"!==e.view?t("div",{staticClass:"column is-narrow"},[t("div",{staticClass:"buttons"},[e.multipleSelected&&"import"!==e.view&&e.canEdit?t("div",{staticClass:"button is-outlined is-primary",on:{click:function(t){return e.$emit("edit-multiple-event")}}},[e._m(5),t("span",[e._v(" Edit multiple ")])]):e._e(),e.addingNode||!e.canEdit||e.multipleSelected?e._e():t("div",{staticClass:"button is-outlined is-primary",on:{click:function(t){e.addingNode=!0}}},[e._m(6),t("span",[e._v(" "+e._s(e.addCompetencyOrChildText)+" ")])]),!e.addingNode&&e.canEdit&&!e.multipleSelected&&e.canCopyOrCut?t("div",{staticClass:"button is-outlined is-danger",on:{click:e.deleteSelected}},[e._m(7),t("span",[e._v(" delete item ")])]):e._e(),e.addingNode?t("div",{staticClass:"button is-outlined is-dark",on:{click:function(t){e.addingNode=!1}}},[e._m(8),t("span",[e._v("cancel")])]):e._e(),e.addingNode?t("div",{staticClass:"button is-outlined is-primary",class:{"is-loading":e.loading},on:{click:e.onClickCreateNew}},[e._m(9),t("span",[e._v(" create new ")])]):e._e(),e.addingNode?t("div",{staticClass:"button is-outlined is-primary",on:{click:e.clickToSearch}},[e._m(10),t("span",[e._v("search")])]):e._e(),"framework"!==e.view&&"concept"!==e.view||!e.hierarchyEnabled?e._e():t("div",{staticClass:"button is-outlined",class:e.canCopyOrCut?"is-primary":"is-disabled",attrs:{disabled:!e.canCopyOrCut,title:"Copy competency"},on:{click:e.copyClick}},[e._m(11)]),"framework"!==e.view&&"concept"!==e.view||!e.hierarchyEnabled?e._e():t("div",{staticClass:"button is-outlined",class:e.canCopyOrCut?"is-primary":"is-disabled",attrs:{title:"Cut competency",disabled:!e.canCopyOrCut},on:{click:e.cutClick}},[e._m(12)]),"framework"!==e.view&&"concept"!==e.view||!e.hierarchyEnabled?e._e():t("div",{staticClass:"button is-outlined",class:e.canPaste?"is-primary":"is-disabled",attrs:{disabled:!e.canPaste,title:"Paste competency"},on:{click:e.pasteClick}},[e._m(13)]),"framework"!==e.view&&"concept"!==e.view||!e.hierarchyEnabled?e._e():t("div",{staticClass:"button is-outlined",class:e.clipboardContainsItem?"is-danger":"is-disabled",attrs:{disabled:!e.clipboardContainsItem,title:"Clear clipboard"},on:{click:e.clearClipboard}},[e._m(14)])])]):e._e(),"importPreview"===e.view||"importLight"===e.view?t("div",{staticClass:"column"},[t("div",{staticClass:"buttons is-right"},[t("div",{staticClass:"buttons is-small is-right"},[t("div",{staticClass:"button is-light is-small is-pulled-right is-dark is-outlined",on:{click:e.cancelImport}},[t("span",[e._v(" Cancel ")]),e._m(15)]),"importLight"===e.view&&("text"!==e.importType||"text"===e.importType&&"Competency detected"===e.importStatus)?t("div",{staticClass:"button is-small is-dark is-outlined is-pulled-right",on:{click:function(t){return e.showModal("export")}}},[t("span",[e._v(" Export ")]),e._m(16)]):e._e(),"importLight"===e.view&&("text"!==e.importType||"text"===e.importType&&"Competency detected"===e.importStatus)?t("div",{staticClass:"button is-small is-dark is-outlined is-pulled-right",on:{click:function(t){return e.$store.dispatch("app/clearImport")}}},[t("span",[e._v(" import again ")]),e._m(17)]):e._e(),"importLight"===e.view&&("text"!==e.importType||"text"===e.importType&&"Competency detected"===e.importStatus)?t("div",{staticClass:"button is-small is-dark is-outlined is-pulled-right",on:{click:e.openFramework}},[t("span",[e._v("view in editor")]),e._m(18)]):e._e(),"importPreview"===e.view?t("div",{staticClass:"button is-small is-primary is-outlined is-pulled-right",on:{click:function(t){return e.$store.commit("app/importTransition","light")}}},[t("span",[e._v(" done editing ")]),e._m(19)]):e._e(),"importLight"===e.view&&("text"!==e.importType||"text"===e.importType&&"Competency detected"===e.importStatus)?t("router-link",{staticClass:"button is-small is-primary is-outlined is -pulled-right",attrs:{to:{path:"/frameworks",query:e.queryParams}}},[t("span",[e._v(" Done ")]),t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-home"})])]):e._e()],1)])]):e._e()]),e.canEditAssertions&&e.managingAssertions?t("div",{staticClass:"columns"},[t("div",{staticClass:"column is-narrow assertion-subject-select"},[t("span",[e._v("Manage Assertions for: ")]),e.selectedSubject?t("button",{staticClass:"button is-outlined is-primary assertion-subject-select-button",on:{click:e.openSelectSubjectModal}},[e._v(" "+e._s(e.selectedSubject)+" ")]):e._e()])]):e._e()]),e.hierarchy?[t("draggable",e._b({staticClass:"lode__hierarchy-ul",class:e.scrolled?"ul-list-scrolled":"",attrs:{tag:"ul",disabled:!0!==e.canEdit||!e.isDraggable||!e.hierarchyEnabled,group:{name:"test"},handle:".handle"},on:{start:e.beginDrag,end:e.endDrag},model:{value:e.hierarchy,callback:function(t){e.hierarchy=t},expression:"hierarchy"}},"draggable",e.dragOptions,!1),e._l(e.hierarchy,(function(i,r){return t("HierarchyNode",{key:i.obj.id,staticClass:"lode__hierarchy-li",attrs:{depth:1,view:e.view,subview:e.subview,obj:i.obj,dragging:e.dragging,canEdit:e.canEdit,hasChild:i.children,profile:e.profile,highlightList:e.highlightList,selectAll:e.selectAll,newFramework:e.newFramework,index:r,parentStructure:e.hierarchy,parent:e.container,frameworkEditable:e.canEdit,filter:e.filter,selectedArray:e.selectedArray,properties:e.properties,expandAll:1==e.expanded,shiftKey:e.shiftKey,arrowKey:e.arrowKey,largeNumberOfItems:e.hasLargeNumberOfItems,hierarchyEnabled:e.hierarchyEnabled,containerSubType:e.container.subType,canEditAssertions:e.canEditAssertions,propagateParentChecked:"false"},on:{"create-new-node-event":e.onCreateNewNode,"mounting-node":e.handleMountingNode,"begin-drag":e.beginDrag,move:e.move,select:e.select,add:e.add,"remove-object":e.removeObject,"draggable-check":e.onDraggableCheck}})})),1)]:e._e(),t("modal-template",{attrs:{active:e.showSelectSubjectModal}},[t("template",{slot:"modal-header"},[t("p",{staticClass:"is-size-3 modal-card-title has-text-white"},[e._v(" Select Subject ")])]),t("template",{slot:"modal-body"},[t("div",{staticClass:"field"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.personFilter,expression:"personFilter"}],staticClass:"input",attrs:{type:"text",placeholder:"search for person..."},domProps:{value:e.personFilter},on:{input:function(t){t.target.composing||(e.personFilter=t.target.value)}}})]),0===e.filteredAvailablePersons.length&&""===e.personFilter?t("div",[t("i",{staticClass:"fa fa-info-circle"}),e._v(" No users found ")]):e._e(),e.filteredAvailablePersons.length>0?t("div",[t("h4",{staticClass:"header is-size-3"},[e._v(" Available users ")]),t("div",{staticClass:"table-container"},[t("table",{staticClass:"table is-hoverable is-fullwidth"},[t("thead",[t("tr",[t("th",{attrs:{title:"Add as member"}},[t("i",{staticClass:"fa fa-user"})]),t("th",{attrs:{title:"Add as manager"}},[t("i",{staticClass:"fa fa-user-shield"})])])]),t("tbody",e._l(e.filteredAvailablePersons,(function(i,r){return t("tr",{key:r,staticStyle:{cursor:"pointer"},on:{click:function(t){return e.setSubject(i.owner[0])}}},[t("td",[e._v(" "+e._s(i.getName())+" ")]),t("td",[e._v(" "+e._s(i.email)+" ")])])})),0)])])]):e._e()]),t("template",{slot:"modal-foot"},[t("div",{staticClass:"button is-outlined is-small",attrs:{title:"Cancel"},on:{click:e.closeSelectSubjectModal}},[t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-times"})]),t("span",[e._v(" cancel ")])])])],2)],2)},n=[function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-link"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-unlink"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-list-alt"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-exchange-alt"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-exchange-alt"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-cog"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-plus-circle"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-plus-circle"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-times"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-plus"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-search"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-copy"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fas handle fa-cut"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-paste"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fas fa-clipboard"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-times-circle"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-download"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-redo-alt"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-edit"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-arrow-right"})])}],s=i("c7eb"),a=i("1da1"),o=(i("3ca3"),i("ddb0"),i("14d9"),i("4e82"),i("a434"),i("b64b"),i("b0c0"),i("ac1f"),i("841c"),i("b047")),c=i.n(o),l=i("872c"),d=i("6ffa4"),h=i("af07"),u={name:"Hierarchy",mixins:[l["a"],d["a"]],props:{scrolled:Boolean,container:Object,containerType:String,containerTypeGet:String,containerNodeProperty:String,containerEdgeProperty:String,nodeType:String,edgeType:String,edgeRelationProperty:String,edgeSourceProperty:String,edgeTargetProperty:String,edgeRelationLiteral:String,viewOnly:Boolean,repo:Object,profile:Object,highlightList:Array,newFramework:Boolean,properties:String,view:{type:String,default:"framework"},subview:{type:String,default:""},canEditAssertions:Boolean},data:function(){return{LARGE_NUMBER_OF_ITEMS:200,filter:"showAll",dragIcon:"fa-arrows-alt",dragOptions:{delay:0,scroll:!0,disabled:!1,emptyInsertThreshold:5,swapThreshold:.25,invertSwap:!0,invertedSwapThreshold:.25,animation:0,ghostClass:"ghost-drag",chosenClass:"chosen-drag",dragClass:"drag",scrollSensitivity:30,scrollSpeed:5,forceFallback:!0},multipleSelected:!1,addingNode:!1,structure:[],once:!0,dragging:!1,controlOnStart:!1,selectAll:!1,selectedArray:[],selectButtonText:null,expanded:!0,showAligned:!1,isDraggable:!0,shiftKey:!1,arrowKey:null,addCompetencyOrChildText:"Add",hierarchy:null,selectedSubject:null,availablePersons:[],personFilter:"",loading:!1}},components:{HierarchyNode:function(){return i.e("chunk-4f0df510").then(i.bind(null,"b709"))},draggable:function(){return i.e("chunk-4a5f46a6").then(i.t.bind(null,"b76a",7))},ModalTemplate:h["a"]},watch:{relations:function(){this.once=!0},competencies:function(){this.once=!0},selectedArray:function(){this.selectedArray.length>1?this.multipleSelected=!0:(this.multipleSelected=!1,this.addingNode=!1),1===this.selectedArray.length?this.addCompetencyOrChildText="Add Child":this.addCompetencyOrChildText="Add",this.$emit("selected-array",this.selectedArray)},addAnother:function(e){e&&(this.onClickCreateNew(),this.$store.commit("editor/addAnother",!1))},once:function(e){e&&this.computeHierarchy()},currentSubject:function(){this.getSubjectInfo()}},computed:{showSelectSubjectModal:function(){return this.$store.getters["app/showModal"]&&"Subject"===this.$store.getters["app/dynamicModalContent"]},hierarchyEnabled:function(){return"Collection"!==this.container.subType},filteredAvailablePersons:function(){var e=this;return this.availablePersons.filter((function(t){return t.getName()&&t.getName().toLowerCase().indexOf(e.personFilter.toLowerCase())>-1||t.email&&t.email.toLowerCase().indexOf(e.personFilter.toLowerCase())>-1}))},relations:function(){return this.container.relation},competencies:function(){return this.container.competency},canCopyOrCut:function(){return!(!this.selectedArray||1!==this.selectedArray.length)},clipboardContainsItem:function(){return null!==this.$store.getters["editor/copyId"]||null!==this.$store.getters["editor/cutId"]},canPaste:function(){return(null!==this.$store.getters["editor/copyId"]||null!==this.$store.getters["editor/cutId"])&&null!==this.$store.getters["editor/nodeInFocus"]},alignmentsToSave:function(){return this.$store.getters["crosswalk/alignmentsToSave"]?this.$store.getters["crosswalk/alignmentsToSave"]:[]},showAddComments:function(){return"true"!==this.$store.getters["editor/queryParams"].concepts&&!0!==this.$store.getters["editor/conceptMode"]&&!0!==this.$store.getters["editor/progressionMode"]&&this.$store.state.app.canAddComments},importType:function(){return this.$store.getters["app/importType"]},importStatus:function(){return this.$store.getters["app/importStatus"]},importTransition:function(){return this.$store.getters["app/importTransition"]},queryParams:function(){return this.$store.getters["editor/queryParams"]},addAnother:function(){return this.$store.getters["editor/addAnother"]},canEdit:function(){return!0!==this.viewOnly&&this.canEditAny(this.container)},hasLargeNumberOfItems:function(){return null!=this.container&&(this.container.competency&&this.container.competency.length>=this.LARGE_NUMBER_OF_ITEMS)},managingAssertions:function(){return this.$store.getters["editor/manageAssertions"]},currentSubject:function(){return this.$store.getters["editor/getSubject"]},editingCompetency:function(){return null!=this.$store.getters["editor/selectedCompetency"]}},mounted:function(){var e=this,t=[];null!=this.container[this.containerNodeProperty]&&(t=t.concat(this.container[this.containerNodeProperty])),null!=this.container[this.containerEdgeProperty]&&(t=t.concat(this.container[this.containerEdgeProperty])),t.length>0?this.repo.multiget(t,(function(t){e.computeHierarchy()}),appError):e.computeHierarchy(),this.queryParams&&(this.queryParams.singleSelect&&(this.selectButtonText=this.queryParams.singleSelect),this.queryParams.select&&""!==this.queryParams.select&&"select"!==this.queryParams.select&&(this.selectButtonText=this.queryParams.select)),this.hasLargeNumberOfItems&&(this.expanded=!1),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup),this.$store.getters["editor/getSubject"]&&this.getSubjectInfo()},beforeDestroy:function(){window.removeEventListener("keyup",this.keyup),window.removeEventListener("keydown",this.keydown)},methods:{clearClipboard:function(){this.$store.commit("editor/copyId",null),this.$store.commit("editor/cutId",null),this.$store.commit("editor/paste",!1)},cutClick:function(){this.selectedArray&&1===this.selectedArray.length&&this.$store.commit("editor/cutId",this.selectedArray[0]),this.$store.commit("editor/copyId",null),this.$store.commit("editor/paste",!1)},copyClick:function(){this.selectedArray&&1===this.selectedArray.length&&this.$store.commit("editor/copyId",this.selectedArray[0]),this.$store.commit("editor/cutId",null),this.$store.commit("editor/paste",!1)},pasteClick:function(){this.$store.commit("editor/paste",!0)},keydown:function(e){this.editingCompetency||(this.canEdit&&(e.shiftKey&&(this.shiftKey=!0),-1!==e.key.indexOf("Arrow")&&e.shiftKey&&(this.arrowKey=e.key),"x"===e.key&&e.ctrlKey&&(this.selectedArray&&1===this.selectedArray.length&&this.$store.commit("editor/cutId",this.selectedArray[0]),this.$store.commit("editor/copyId",null),this.$store.commit("editor/paste",!1)),"c"===e.key&&e.ctrlKey&&(this.selectedArray&&1===this.selectedArray.length&&this.$store.commit("editor/copyId",this.selectedArray[0]),this.$store.commit("editor/cutId",null),this.$store.commit("editor/paste",!1)),"v"===e.key&&e.ctrlKey&&this.$store.commit("editor/paste",!0)),-1===e.key.indexOf("Arrow")||e.shiftKey||e.ctrlKey||("ArrowLeft"===e.key?this.expanded=!1:"ArrowRight"===e.key&&(this.expanded=!0)))},keyup:function(e){e.shiftKey||(this.shiftKey=!1),-1!==e.key.indexOf("Arrow")&&(this.arrowKey=null)},showModal:function(e,t){"export"===e?(this.$store.commit("editor/setItemToExport",this.container),this.$store.commit("app/showModal",{title:"Export Framework",component:"ExportOptionsModal"})):"subject"===e&&this.$store.commit("app/showModal","Subject")},openFramework:function(){var e=Object(a["a"])(Object(s["a"])().mark((function e(){var t;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,EcFramework.get(this.container.shortId());case 2:t=e.sent,this.$store.commit("editor/framework",t),this.$router.push({name:"framework",params:{frameworkId:this.container.id}});case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),changeFrameworkTarget:function(){this.$store.commit("crosswalk/step",1)},changeFrameworkSource:function(){this.$store.commit("crosswalk/step",0)},filterHierarchy:function(e){this.filter=e},onCreateNewNode:function(e,t){this.add(e,t)},handleMountingNode:function(){this.startTime()},startTime:c()((function(){this.$emit("done-loading-nodes")}),100),computeHierarchy:function(){var e=Object(a["a"])(Object(s["a"])().mark((function e(){var t,i,r,n,a,o,c,l,d;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this,i={},r={},null!=this.container){e.next=5;break}return e.abrupt("return",i);case 5:if(null===this.container[this.containerNodeProperty]||void 0===this.container[this.containerNodeProperty]){e.next=28;break}n=0;case 7:if(!(n<this.container[this.containerNodeProperty].length)){e.next=28;break}return e.next=10,window[this.nodeType].get(this.container[this.containerNodeProperty][n]);case 10:if(a=e.sent,null!=a){e.next=24;break}return e.next=14,EcRepository.get(this.container[this.containerNodeProperty][n]);case 14:if(a=e.sent,!a||!a.encryptedType||a.encryptedType.toLowerCase()!==this.containerNodeProperty){e.next=24;break}return o="Ec"+a.encryptedType,c=new window[o],e.t0=c,e.next=21,EcEncryptedValue.fromEncryptedValue(a);case 21:e.t1=e.sent,e.t0.copyFrom.call(e.t0,e.t1),a=c;case 24:null!==a&&(i[this.container[this.containerNodeProperty][n]]=i[a.shortId()]=r[a.shortId()]=a);case 25:n++,e.next=7;break;case 28:if(null==this.container[this.containerEdgeProperty]||void 0===this.container[this.containerEdgeProperty]){e.next=50;break}n=0;case 30:if(!(n<this.container[this.containerEdgeProperty].length)){e.next=50;break}return l=null,e.next=34,window[this.edgeType].get(this.container[this.containerEdgeProperty][n]);case 34:if(l=e.sent,null==l){e.next=46;break}if(l[this.edgeRelationProperty]!==this.edgeRelationLiteral){e.next=44;break}if(null!=i[l[this.edgeTargetProperty]]){e.next=39;break}return e.abrupt("continue",47);case 39:if(null!=i[l[this.edgeSourceProperty]]){e.next=41;break}return e.abrupt("continue",47);case 41:null==i[l[this.edgeTargetProperty]]._children&&(i[l[this.edgeTargetProperty]]._children=[]),i[l[this.edgeTargetProperty]]._children.push(i[l[this.edgeSourceProperty]]),delete r[l[this.edgeSourceProperty]];case 44:e.next=47;break;case 46:appLog("Hierarchy: Could not find edge: "+this.container[this.containerEdgeProperty][n]);case 47:n++,e.next=30;break;case 50:if(null==this.container[this.containerNodeProperty]){e.next=59;break}n=0;case 52:if(!(n<this.container[this.containerNodeProperty].length)){e.next=59;break}if(i[this.container[this.containerNodeProperty][n]]&&null!=i[this.container[this.containerNodeProperty][n]]._children){e.next=55;break}return e.abrupt("continue",56);case 55:i[this.container[this.containerNodeProperty][n]]._children.sort((function(e,i){return t.container[t.containerNodeProperty].indexOf(e.shortId())-t.container[t.containerNodeProperty].indexOf(i.shortId())}));case 56:n++,e.next=52;break;case 59:for(this.structure.splice(0,this.structure.length),d=EcObject.keys(r),n=0;n<d.length;n++)this.structure.push(r[d[n]]);this.structure.sort((function(e,i){return t.container[t.containerNodeProperty].indexOf(e.shortId())-t.container[t.containerNodeProperty].indexOf(i.shortId())})),this.packChildren(this.structure),this.deleteUnderscore(this.structure),this.once=!1,this.hierarchy=this.structure;case 67:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),packChildren:function(e){if(null!=e){for(var t=0;t<e.length;t++)e[t].obj||(e[t]={obj:e[t],children:void 0===e[t]._children?[]:e[t]._children});for(t=0;t<e.length;t++)this.packChildren(e[t].children)}},deleteUnderscore:function(e){if(null!=e)for(var t=0;t<e.length;t++)delete e[t].obj._children,this.deleteUnderscore(e[t].children)},beginDrag:function(e){this.dragging=!0,void 0!==e&&(this.controlOnStart=e.originalEvent.ctrlKey||e.originalEvent.shiftKey)},endDrag:function(e){if("framework_drag"!==e.to.id){appLog(e.oldIndex,e.newIndex);var t=null,i=!1;this.shiftKey&&(this.controlOnStart=!0),e.from.id===e.to.id?e.newIndex+1<this.hierarchy.length?t=this.hierarchy[e.newIndex+1].obj.shortId():e.newIndex===this.hierarchy.length-1&&(i=!0):void 0===e.to.children[e.newIndex]?t=e.to.id:e.newIndex+1<e.to.children.length&&(t=e.to.children[e.newIndex+1].id),this.move(this.structure[e.oldIndex].obj.shortId(),t,e.from.id,e.to.id,!this.controlOnStart,i)}else this.dragging=!1},move:function(){var e=Object(a["a"])(Object(s["a"])().mark((function e(t,i,r,n,a,o){var c,l,d,h,u,p,y,f,m,g,b,w,v,k,C,x;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.once=!0,c=o,l=this,d=l.container[l.containerNodeProperty]?l.container[l.containerNodeProperty].slice():null,h=l.container[l.containerEdgeProperty]?l.container[l.containerEdgeProperty].slice():null,u=[],EcArray.isArray(l.container[l.containerEdgeProperty])||(l.container[l.containerEdgeProperty]=[]),t!==i&&(p=this.container[this.containerNodeProperty].indexOf(t),appLog(p),(null==i||void 0===i)&&r===n&&p>=this.container[this.containerNodeProperty].length-2&&(c=!0),this.container[this.containerNodeProperty].splice(p,1),y=null,y=null==i||void 0===i?-1:this.container[this.containerNodeProperty].indexOf(i),appLog(y),c?this.container[this.containerNodeProperty].push(t):this.container[this.containerNodeProperty].splice(y,0,t)),r===n){e.next=69;break}return e.next=11,window[this.nodeType].get(t);case 11:if(f=e.sent,n!==this.container.id){e.next=23;break}if(!n){e.next=19;break}return e.next=16,window["EcFramework"].get(n);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=null;case 20:m=e.t0,e.next=31;break;case 23:if(!n){e.next=29;break}return e.next=26,window[this.nodeType].get(n);case 26:e.t1=e.sent,e.next=30;break;case 29:e.t1=null;case 30:m=e.t1;case 31:if(!0!==a||t===n){e.next=51;break}g=0;case 33:if(!(g<this.container[this.containerEdgeProperty].length)){e.next=51;break}return e.next=36,window[this.edgeType].get(this.container[this.containerEdgeProperty][g]);case 36:if(b=e.sent,null!=b){e.next=39;break}return e.abrupt("continue",48);case 39:if(b[this.edgeRelationProperty]!==this.edgeRelationLiteral){e.next=48;break}if(null!=b[this.edgeTargetProperty]){e.next=42;break}return e.abrupt("continue",48);case 42:if(null!=b[this.edgeSourceProperty]){e.next=44;break}return e.abrupt("continue",48);case 44:if(b[this.edgeSourceProperty]===t||this.$store.getters["editor/cutId"]&&(!this.$store.getters["editor/cutId"]||b[this.edgeTargetProperty]===t)){e.next=46;break}return e.abrupt("continue",48);case 46:appLog("Identified edge to remove: ",JSON.parse(b.toJson())),this.container[this.containerEdgeProperty].splice(g--,1);case 48:g++,e.next=33;break;case 51:if(null==n||""===n){e.next=69;break}if(b=new window[this.edgeType],null!=EcIdentityManager.default.ids&&EcIdentityManager.default.ids.length>0&&b.addOwner(EcIdentityManager.default.ids[0].ppk.toPk()),this.container.owner&&this.container.owner.length>0)for(w=0;w<this.container.owner.length;w++)v=this.container.owner[w],b.addOwner(EcPk.fromPem(v));if(this.container.reader&&this.container.reader.length>0)for(w=0;w<this.container.reader.length;w++)k=this.container.reader[w],b.addReader(EcPk.fromPem(k));if(null==m||void 0===m||f.shortId()===m.shortId()){e.next=69;break}if(l.queryParams&&l.queryParams.newObjectEndpoint?b.generateShortId(this.queryParams.newObjectEndpoint):b.assignId(l.repo.selectedServer,EcCrypto.md5(f.shortId())+"_"+this.edgeRelationLiteral+"_"+EcCrypto.md5(m.shortId())),b.source=f.shortId(),b.target=m.shortId(),b.relationType=this.edgeRelationLiteral,this.container[this.containerEdgeProperty].push(b.shortId()),u.push(b.shortId()),appLog("Added edge: ",JSON.parse(b.toJson())),!this.$store.state.editor||!0!==this.$store.state.editor.private){e.next=68;break}return e.next=67,EcEncryptedValue.toEncryptedValue(b);case 67:b=e.sent;case 68:this.repo.saveTo(b,appLog,appError);case 69:for(C=this.stripEmptyArrays(this.container),x=[],g=0;g<u.length;g++)x.push({operation:"addNew",id:u[g]});if(x.push({operation:"update",id:l.container.shortId(),fieldChanged:["competency","relation"],initialValue:[d,h],changedValue:[this.container.competency,this.container.relation]}),l.$store.commit("editor/addEditsToUndo",x),C["schema:dateModified"]=(new Date).toISOString(),!this.$store.state.editor||!0!==this.$store.state.editor.private||!0===EcEncryptedValue.encryptOnSaveMap[C.id]){e.next=79;break}return e.next=78,EcEncryptedValue.toEncryptedValue(C);case 78:C=e.sent;case 79:this.repo.saveTo(C,appLog,appError),this.dragging=!1;case 81:case"end":return e.stop()}}),e,this)})));function t(t,i,r,n,s,a){return e.apply(this,arguments)}return t}(),add:function(){var e=Object(a["a"])(Object(s["a"])().mark((function e(t,i){var r,n,a,o,c,l,d,h,u,p,y;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=this,n=new window[this.nodeType],a=this.container.competency?this.container.competency.slice():null,o=this.container.relation?this.container.relation.slice():null,this.queryParams&&null!=this.queryParams.newObjectEndpoint?n.generateShortId(this.queryParams.newObjectEndpoint):n.generateId(this.repo.selectedServer),null!=EcIdentityManager.default.ids&&EcIdentityManager.default.ids.length>0&&n.addOwner(EcIdentityManager.default.ids[0].ppk.toPk()),this.container.owner&&this.container.owner.length>0)for(c=0;c<this.container.owner.length;c++)l=this.container.owner[c],n.addOwner(EcPk.fromPem(l));if(this.container.reader&&this.container.reader.length>0)for(c=0;c<this.container.reader.length;c++)d=this.container.reader[c],n.addReader(EcPk.fromPem(d));if(h=this.nodeType,0===this.nodeType.indexOf("Ec")&&(h=this.nodeType.substring(2)),this.$store.state.editor&&this.$store.state.editor.defaultLanguage?n.name={"@language":this.$store.state.editor.defaultLanguage,"@value":"New "+h}:n.name="New "+h,n["schema:dateCreated"]=(new Date).toISOString(),n["schema:dateModified"]=(new Date).toISOString(),this.container["schema:dateModified"]=(new Date).toISOString(),appLog("Added node: ",JSON.parse(n.toJson())),this.$store.state.editor&&this.$store.commit("editor/newCompetency",n.shortId()),!this.$store.state.editor||!0!==this.$store.state.editor.private){e.next=20;break}return e.next=19,EcEncryptedValue.toEncryptedValue(n);case 19:n=e.sent;case 20:return e.prev=20,e.next=23,this.repo.saveTo(n);case 23:if(EcArray.isArray(r.container[r.containerNodeProperty])||(r.container[r.containerNodeProperty]=[]),null==i||void 0===i?r.container[r.containerNodeProperty].push(n.shortId()):(u=r.container[r.containerNodeProperty].indexOf(i),r.container[r.containerNodeProperty].splice(u+1,0,n.shortId())),r.$store.commit("editor/addEditsToUndo",[{operation:"addNew",id:n.shortId()},{operation:"update",id:r.container.shortId(),fieldChanged:["competency"],initialValue:[a],changedValue:[r.container.competency]}]),t!==r.container.shortId()){e.next=38;break}if(p=r.container,p["schema:dateModified"]=(new Date).toISOString(),!r.$store.state.editor||!0!==r.$store.state.editor.private||!0===EcEncryptedValue.encryptOnSaveMap[r.container.id]){e.next=33;break}return e.next=32,EcEncryptedValue.toEncryptedValue(r.container);case 32:p=e.sent;case 33:return e.next=35,r.repo.saveTo(r.stripEmptyArrays(p));case 35:r.once=!0,e.next=64;break;case 38:if(y=new window[r.edgeType],null!=EcIdentityManager.default.ids&&EcIdentityManager.default.ids.length>0&&y.addOwner(EcIdentityManager.default.ids[0].ppk.toPk()),r.container.owner&&r.container.owner.length>0)for(c=0;c<r.container.owner.length;c++)l=r.container.owner[c],y.addOwner(EcPk.fromPem(l));if(r.container.reader&&r.container.reader.length>0)for(c=0;c<r.container.reader.length;c++)d=r.container.reader[c],y.addReader(EcPk.fromPem(d));if(r.queryParams&&r.queryParams.newObjectEndpoint?y.generateShortId(r.queryParams.newObjectEndpoint):y.assignId(r.repo.selectedServer,EcCrypto.md5(n.shortId())+"_"+r.edgeRelationLiteral+"_"+EcCrypto.md5(t)),y.source=n.shortId(),y.target=t,y.source===y.target){e.next=64;break}if(y.relationType=r.edgeRelationLiteral,EcArray.isArray(r.container[r.containerEdgeProperty])||(r.container[r.containerEdgeProperty]=[]),r.container[r.containerEdgeProperty].push(y.shortId()),appLog("Added edge: ",JSON.parse(y.toJson())),r.$store.commit("editor/addEditsToUndo",[{operation:"addNew",id:n.shortId()},{operation:"update",id:r.container.shortId(),fieldChanged:["competency","relation"],initialValue:[a,o],changedValue:[r.container.competency,r.container.relation]}]),p=r.container,p["schema:dateModified"]=(new Date).toISOString(),!r.$store.state.editor||!0!==r.$store.state.editor.private){e.next=61;break}return e.next=56,EcEncryptedValue.toEncryptedValue(y);case 56:if(y=e.sent,!0===EcEncryptedValue.encryptOnSaveMap[r.container.id]){e.next=61;break}return e.next=60,EcEncryptedValue.toEncryptedValue(r.container);case 60:p=e.sent;case 61:return e.next=63,r.repo.multiput([y,r.stripEmptyArrays(p)]);case 63:r.once=!0;case 64:e.next=69;break;case 66:e.prev=66,e.t0=e["catch"](20),appError(e.t0);case 69:case"end":return e.stop()}}),e,this,[[20,66]])})));function t(t,i){return e.apply(this,arguments)}return t}(),stripEmptyArrays:function(e){if(EcArray.isArray(e)){if(0===e.length)return null;for(var t=0;t<e.length;t++)e[t]=this.stripEmptyArrays(e[t]),null==e[t]&&e.splice(t--,1)}else if(EcObject.isObject(e))for(var i in e){var r=this.stripEmptyArrays(e[i]);null==r&&delete e[i]}return e},select:function(e,t){t?EcArray.setAdd(this.selectedArray,e):EcArray.setRemove(this.selectedArray,e)},removeObject:function(e){this.$emit("remove-object",e)},onDraggableCheck:function(e){this.isDraggable=e},clickToSearch:function(){var e=Object(a["a"])(Object(s["a"])().mark((function e(){var t,i;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=null,!this.selectedArray||1!==this.selectedArray.length){e.next=5;break}return e.next=4,EcRepository.get(this.selectedArray[0]);case 4:t=e.sent;case 5:this.$store.commit("editor/selectedCompetency",t),i={selectedCompetency:t,searchType:"Competency",copyOrLink:!0,component:"SearchModal"},this.$emit("search-things",i),this.$store.commit("lode/competencySearchModalOpen",!0),this.$store.commit("lode/searchType","Competency"),this.$store.commit("lode/copyOrLink",!0),this.$store.commit("lode/includeRelations","Collection"!==this.container.subType);case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),cancelImport:function(){this.deleteObject(this.container),this.$store.dispatch("app/clearImport")},onClickCreateNew:function(){var e=Object(a["a"])(Object(s["a"])().mark((function e(){var t;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.container.shortId(),1===this.selectedArray.length&&(t=this.selectedArray[0]),this.loading=!0,e.prev=3,e.next=6,this.add(t,null);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](3),appError(e.t0);case 11:this.loading=!1,this.addingNode=!1;case 13:case"end":return e.stop()}}),e,this,[[3,8]])})));function t(){return e.apply(this,arguments)}return t}(),deleteSelected:function(){var e=Object(a["a"])(Object(s["a"])().mark((function e(){var t;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,EcRepository.get(this.selectedArray[0]);case 2:t=e.sent,this.deleteObject(t),this.selectedArray.splice(0,this.selectedArray.length);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),setSubject:function(e){this.$store.commit("editor/setSubject",e),this.closeSelectSubjectModal()},openSelectSubjectModal:function(){var e=Object(a["a"])(Object(s["a"])().mark((function e(){var t;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,EcPerson.search(window.repo,"*",null,null,{size:1e4});case 2:t=e.sent,this.availablePersons=t,this.showModal("subject");case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),closeSelectSubjectModal:function(){this.$store.commit("app/closeModal")},getSubjectInfo:function(){var e=this;EcPerson.getByPk(window.repo,EcPk.fromPem(this.$store.getters["editor/getSubject"])).then((function(t){var i=t.name;EcIdentityManager.default.ids[0].ppk.toPk().toPem()===t.owner[0]&&(i="Myself"),e.selectedSubject=i}))}}},p=u,y=(i("38e5"),i("2877")),f=Object(y["a"])(p,r,n,!1,null,null,null);t["default"]=f.exports},f44a:function(e,t,i){}}]);
//# sourceMappingURL=chunk-701cdf0d.e320d13d.js.map