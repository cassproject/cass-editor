(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-51369fc1","chunk-74a95bb3"],{"24ea":function(e,t,r){"use strict";var n=r("a348"),a=r.n(n);a.a},"27c7":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"lode__hierarchy",class:{"is-dragging":e.dragging}},[r("div",{staticClass:"hierarchy-buttons columns is-gapless is-paddingless is-mobile is-marginless is-paddingless"},[e.canEdit&&"import"!==e.view||e.queryParams.select?r("div",{staticClass:"column is-narrow",attrs:{id:"check-radio-all-column"}},[r("div",{staticClass:"field"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.selectAll,expression:"selectAll"}],staticClass:"is-checkradio",attrs:{id:"selectAllCheckbox",type:"checkbox",name:"selectAllCheckbox"},domProps:{checked:Array.isArray(e.selectAll)?e._i(e.selectAll,null)>-1:e.selectAll},on:{change:function(t){var r=e.selectAll,n=t.target,a=!!n.checked;if(Array.isArray(r)){var i=null,s=e._i(r,i);n.checked?s<0&&(e.selectAll=r.concat([i])):s>-1&&(e.selectAll=r.slice(0,s).concat(r.slice(s+1)))}else e.selectAll=a}}}),r("label",{attrs:{for:"selectAllCheckbox"}})])]):e._e(),r("div",{staticClass:"column is-narrow"},[e.expanded?r("div",{staticClass:"icon is-vcentered",on:{click:function(t){e.expanded=!1}}},[r("i",{staticClass:"fa fa-caret-down has-text-primary is-size-2"})]):e.expanded?r("div",{staticClass:"icon is-vcentered"},[r("i",{staticClass:"fa fa-circle is-size-6 has-text-light"})]):r("div",{staticClass:"icon is-vcentered",on:{click:function(t){e.expanded=!0}}},[r("i",{staticClass:"fa fa-caret-right has-text-primary is-size-2"})]),e.selectButtonText?r("div",{staticClass:"button is-outlined is-primary",on:{click:function(t){return e.$emit("select-button-click",e.selectedArray)}}},[e._v(" "+e._s(e.selectButtonText)+" ")]):e._e()]),r("div",{staticClass:"column is-narrow"},[r("div",{staticClass:"buttons"},[e.multipleSelected&&!e.addingNode&&"import"!==e.view&&e.canEdit?r("div",{staticClass:"button is-outlined is-primary",on:{click:function(t){return e.$emit("edit-multiple-event")}}},[e._m(0),r("span",[e._v(" Edit multiple ")])]):e._e(),e.addingNode||!e.canEdit||e.multipleSelected?e._e():r("div",{staticClass:"button is-outlined is-primary",on:{click:function(t){e.addingNode=!0}}},[e._m(1),r("span",[e._v(" "+e._s(e.addProgressionModelOrLevelText)+" ")])]),!e.addingNode&&e.canEdit&&!e.multipleSelected&&e.canCopyOrCut?r("div",{staticClass:"button is-outlined is-danger",on:{click:e.deleteSelected}},[e._m(2),r("span",[e._v(" delete item ")])]):e._e(),e.addingNode?r("div",{staticClass:"button is-outlined is-dark ",on:{click:function(t){e.addingNode=!1}}},[e._m(3),r("span",[e._v("cancel")])]):e._e(),e.addingNode?r("div",{staticClass:"button is-outlined is-primary ",class:{"is-loading":e.loading},on:{click:e.onClickCreateNew}},[e._m(4),r("span",[e._v(" create new ")])]):e._e(),"framework"===e.view||"concept"===e.view?r("div",{staticClass:"button is-outlined",class:e.canCopyOrCut?"is-primary":"is-disabled",attrs:{title:"Cut competency",disabled:!e.canCopyOrCut},on:{click:e.cutClick}},[e._m(5)]):e._e(),"framework"===e.view||"concept"===e.view?r("div",{staticClass:"button is-outlined ",class:e.canPaste?"is-primary":"is-disabled",attrs:{disabled:!e.canPaste,title:"Paste competency"},on:{click:e.pasteClick}},[e._m(6)]):e._e(),"concept"===e.view?r("div",{staticClass:"button is-outlined is-primary ",attrs:{title:"Reorder by Precedence"},on:{click:function(t){return e.computeHierarchy(!0)}}},[r("span",[e._v(" reorder by precedence ")])]):e._e(),"concept"===e.view?r("div",{staticClass:"button is-outlined is-primary ",attrs:{title:"Set Precedence"},on:{click:e.setPrecedence}},[r("span",[e._v(" set precedence by order ")])]):e._e()])]),"import"===e.view?r("div",{staticClass:"column"},[r("div",{staticClass:"buttons is-right"},[r("div",{staticClass:"buttons is-right"},[r("div",{staticClass:" button is-light is-pulled-right is-dark is-outlined",on:{click:e.cancelImport}},[r("span",[e._v(" Cancel ")]),e._m(7)]),r("div",{staticClass:"button is-dark is-outlined is-pulled-right",on:{click:function(t){return e.$store.dispatch("app/clearImport")}}},[r("span",[e._v(" import again ")]),e._m(8)]),r("div",{staticClass:"button is-dark is-outlined is-pulled-right",on:{click:e.openFramework}},[r("span",[e._v("view in editor")]),e._m(9)]),r("router-link",{staticClass:"button is-primary is-outlined is -pulled-right",attrs:{to:{path:"/progressionLevels",query:e.queryParams}}},[r("span",[e._v(" Done ")]),r("span",{staticClass:"icon"},[r("i",{staticClass:"fa fa-home"})])])],1)])]):e._e()]),e.hierarchy?[r("draggable",e._b({staticClass:"lode__hierarchy-ul",attrs:{tag:"ul",disabled:!0!==e.canEdit||!e.isDraggable,group:{name:"test"},handle:".handle"},on:{start:e.beginDrag,end:e.endDrag},model:{value:e.hierarchy,callback:function(t){e.hierarchy=t},expression:"hierarchy"}},"draggable",e.dragOptions,!1),e._l(e.hierarchy,(function(t,n){return r("HierarchyNode",{key:t.obj.id,staticClass:"lode__hierarchy-li",attrs:{depth:1,view:e.view,subview:e.subview,obj:t.obj,dragging:e.dragging,canEdit:e.canEdit,hasChild:t.children,profile:e.profile,highlightList:e.highlightList,selectAll:e.selectAll,newFramework:e.newFramework,index:n,frameworkEditable:e.canEdit,selectedArray:e.selectedArray,parentStructure:e.hierarchy,parent:e.container,properties:e.properties,expandAll:1==e.expanded,parentChecked:!1,shiftKey:e.shiftKey,arrowKey:e.arrowKey},on:{"create-new-node-event":e.onCreateNewNode,"mounting-node":e.handleMountingNode,add:e.add,"begin-drag":e.beginDrag,move:e.move,select:e.select,"draggable-check":e.onDraggableCheck}})})),1)]:e._e()],2)},i=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("span",{staticClass:"icon"},[r("i",{staticClass:"fa fa-cog"})])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("span",{staticClass:"icon"},[r("i",{staticClass:"fa fa-plus-circle"})])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("span",{staticClass:"icon"},[r("i",{staticClass:"fa fa-plus-circle"})])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("span",{staticClass:"icon"},[r("i",{staticClass:"fa fa-times"})])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("span",{staticClass:"icon"},[r("i",{staticClass:"fa fa-plus"})])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("span",{staticClass:"icon"},[r("i",{staticClass:"fas handle fa-cut"})])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("span",{staticClass:"icon"},[r("i",{staticClass:"fa fa-paste"})])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("span",{staticClass:"icon"},[r("i",{staticClass:"fa fa-times-circle"})])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("span",{staticClass:"icon"},[r("i",{staticClass:"fa fa-redo-alt"})])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("span",{staticClass:"icon"},[r("i",{staticClass:"fa fa-edit"})])}],s=(n("99af"),n("c740"),n("fb6a"),n("a434"),n("d3b7"),n("25f0"),n("96cf"),n("c964")),c=n("872c"),o=n("6ffa4"),d={name:"ProgressionHierarchy",props:{container:Object,containerType:String,repo:Object,profile:Object,highlightList:Array,selectMode:Boolean,selectAll:Boolean,containerTypeGet:String,viewOnly:Boolean,newFramework:Boolean,properties:String,view:{type:String,default:"framework"},subview:{type:String,default:""},doneDragging:{type:Boolean,default:!1}},data:function(){return{structure:[],once:!0,dragging:!1,controlOnStart:!1,filter:"showAll",dragIcon:"fa-arrows-alt",dragOptions:{delay:100,disabled:!1,ghostClass:"ghost-drag",chosenClass:"chosen-drag",dragClass:"drag",scrollSensitivity:200,forceFallback:!0},multipleSelected:!1,addingNode:!1,selectedArray:[],selectButtonText:null,expanded:!0,isDraggable:!0,shiftKey:!1,arrowKey:null,addProgressionModelOrLevelText:"Add Level",loading:!1}},components:{HierarchyNode:function(){return n.e("chunk-b9f1694a").then(n.bind(null,"b709"))},draggable:function(){return n.e("chunk-4a5f46a6").then(n.t.bind(null,"b76a",7))}},mixins:[c["a"],o["a"]],computed:{canCopyOrCut:function(){return!(!this.selectedArray||1!==this.selectedArray.length)},canPaste:function(){return(null!==this.$store.getters["editor/copyId"]||null!==this.$store.getters["editor/cutId"])&&null!==this.$store.getters["editor/nodeInFocus"]},queryParams:function(){return this.$store.getters["editor/queryParams"]},addAnother:function(){return this.$store.getters["editor/addAnother"]},hierarchy:function(){var e=this;if(null==this.container)return null;if(!this.once)return this.structure;appLog("Computing hierarchy.");var t=[];return null!=this.container["skos:hasTopConcept"]&&(t=t.concat(this.container["skos:hasTopConcept"])),t.length>0?this.repo.multiget(t,(function(t){e.computeHierarchy(!1)}),appError):e.computeHierarchy(!1),this.structure},canEdit:function(){return!0!==this.viewOnly&&this.canEditAny(this.container)},recomputeHierarchy:function(){return this.$store.getters["editor/recomputeHierarchy"]},framework:function(){return this.$store.getters["editor/framework"]}},watch:{container:{handler:function(){this.once=!0},deep:!0},selectedArray:function(){this.selectedArray.length>1?this.multipleSelected=!0:this.multipleSelected=!1,1===this.selectedArray.length?this.addProgressionModelOrLevelText="Add Level":this.addProgressionMaddProgressionModelOrLevelTextodelOrChildText="Add Progression Model",this.$emit("selected-array",this.selectedArray)},recomputeHierarchy:function(){this.recomputeHierarchy&&(this.once=!0,this.$store.commit("editor/recomputeHierarchy",!1))},doneDragging:function(){this.doneDragging&&(this.dragging=!1)},addAnother:function(e){e&&(this.onClickCreateNew(),this.$store.commit("editor/addAnother",!1))}},mounted:function(){this.queryParams&&(this.queryParams.singleSelect&&(this.selectButtonText=this.queryParams.singleSelect),this.queryParams.select&&""!==this.queryParams.select&&"select"!==this.queryParams.select&&(this.selectButtonText=this.queryParams.select)),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup)},beforeDestroy:function(){window.removeEventListener("keyup",this.keyup),window.removeEventListener("keydown",this.keydown)},methods:{cutClick:function(){this.selectedArray&&1===this.selectedArray.length&&this.$store.commit("editor/cutId",this.selectedArray[0]),this.$store.commit("editor/copyId",null),this.$store.commit("editor/paste",!1)},copyClick:function(){this.selectedArray&&1===this.selectedArray.length&&this.$store.commit("editor/copyId",this.selectedArray[0]),this.$store.commit("editor/cutId",null),this.$store.commit("editor/paste",!1)},pasteClick:function(){this.$store.commit("editor/paste",!0)},keydown:function(e){this.canEdit&&(e.shiftKey&&(this.shiftKey=!0),-1!==e.key.indexOf("Arrow")&&e.shiftKey&&(this.arrowKey=e.key),"x"===e.key&&e.ctrlKey&&(this.selectedArray&&1===this.selectedArray.length&&this.$store.commit("editor/cutId",this.selectedArray[0]),this.$store.commit("editor/copyId",null),this.$store.commit("editor/paste",!1)),"c"===e.key&&e.ctrlKey&&(this.selectedArray&&1===this.selectedArray.length&&this.$store.commit("editor/copyId",this.selectedArray[0]),this.$store.commit("editor/cutId",null),this.$store.commit("editor/paste",!1)),"v"===e.key&&e.ctrlKey&&this.$store.commit("editor/paste",!0))},keyup:function(e){e.shiftKey||(this.shiftKey=!1),-1!==e.key.indexOf("Arrow")&&(this.arrowKey=null)},onCreateNewNode:function(e,t){this.add(e,t)},handleMountingNode:function(){this.startTime()},startTime:function(){var e=this;setTimeout((function(){e.$emit("done-loading-nodes")}),1e3)},removePrecedence:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(n){var a,i,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=[],null!=t.container){e.next=3;break}return e.abrupt("return",r);case 3:if(null===t.container["skos:hasTopConcept"]||void 0===t.container["skos:hasTopConcept"]){e.next=27;break}if(!t.container["ceterms:precedes"]&&!t.container["ceterms:precededBy"]){e.next=9;break}return t.container["ceterms:precedes"]&&delete t.container["ceterms:precedes"],t.container["ceterms:precededBy"]&&delete t.container["ceterms:precededBy"],e.next=9,t.saveObject(t.container);case 9:i=0;case 10:if(!(i<t.container["skos:hasTopConcept"].length)){e.next=27;break}return e.next=13,EcConcept.get(t.container["skos:hasTopConcept"][i]);case 13:if(s=e.sent,!s){e.next=24;break}if(!s["ceterms:precedes"]&&!s["ceterms:precededBy"]){e.next=20;break}return s["ceterms:precedes"]&&delete s["ceterms:precedes"],s["ceterms:precededBy"]&&delete s["ceterms:precededBy"],e.next=20,t.saveObject(s);case 20:if(a.push({obj:s,children:[]}),!s["skos:narrower"]){e.next=24;break}return e.next=24,t.addChildren(a,s,i,!0);case 24:i++,e.next=10;break;case 27:t.structure=a,n();case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}(),setPrecedence:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.removePrecedence();case 2:return t=this.structure,e.next=5,this.setPrecedes(t);case 5:return e.next=7,this.setPrecededBy(t);case 7:this.structure=t;case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),computeHierarchy:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){var n,a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=[],null!=this.container){e.next=3;break}return e.abrupt("return",r);case 3:if(null===this.container["skos:hasTopConcept"]||void 0===this.container["skos:hasTopConcept"]){e.next=17;break}a=0;case 5:if(!(a<this.container["skos:hasTopConcept"].length)){e.next=17;break}return e.next=8,EcConcept.get(this.container["skos:hasTopConcept"][a]);case 8:if(i=e.sent,!i){e.next=14;break}if(n.push({obj:i,children:[]}),!i["skos:narrower"]){e.next=14;break}return e.next=14,this.addChildren(n,i,a,!1);case 14:a++,e.next=5;break;case 17:if(!t){e.next=22;break}return e.next=20,this.reorder(n,"ceterms:precedes");case 20:return e.next=22,this.reorder(n,"ceterms:precededBy");case 22:this.structure=n,this.once=!1;case 24:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),printPrettyStructure:function(e){for(var t="[",r=0;r<e.length;r++)if(e[r].obj&&(t+=e[r].obj["skos:prefLabel"]["@value"]+(r!==e.length-1||e[r].children&&e[r].children.length>0?", ":"")),e[r].children.length>0){for(var n=0;n<e[r].children.length;n++)if(e[r].children[n]){var a=e[r].children;if(t+=(0===n?"(":"")+a[n].obj["skos:prefLabel"]["@value"]+(n===e[r].children.length-1?")":", "),t+=n===e[r].children.length-1?r===e.length-1?"]":", ":"",a[n].children.length>0)for(var i=0;i<a[n].children.length;i++)a[n].children[i]&&(t+=(0===i?"(":"")+a[n].children[i].obj["skos:prefLabel"]["@value"]+(i===a[n].children.length-1?")":", "),t+=i===a[n].children.length-1?n===a.length-1?"]":", ":"")}}else t+=r===e.length-1?"]":"";return t},addChildren:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,r,n,a){var i=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(s){var c,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:c=0;case 1:if(!(c<r["skos:narrower"].length)){e.next=17;break}return e.next=4,EcConcept.get(r["skos:narrower"][c]);case 4:if(o=e.sent,!a||!o["ceterms:precedes"]&&!o["ceterms:precededBy"]){e.next=10;break}return o["ceterms:precedes"]&&delete o["ceterms:precedes"],o["ceterms:precededBy"]&&delete o["ceterms:precededBy"],e.next=10,i.saveObject(o);case 10:if(t[n].children.push({obj:o,children:[]}),!o||!o["skos:narrower"]){e.next=14;break}return e.next=14,i.addChildren(t[n].children,o,c,a);case 14:c++,e.next=1;break;case 17:s();case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));function t(t,r,n,a){return e.apply(this,arguments)}return t}(),reorder:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,r){var n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(a){var i,s,c,o,d,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=!0,s=0,null!=t){e.next=4;break}return e.abrupt("return");case 4:if(null===t||!t.length){e.next=33;break}case 5:if(!(i&&s<100)){e.next=33;break}i=!1,c=void 0,c="ceterms:precedes"===r?0:t.length-1,o=t[c];case 10:if(!o){e.next=31;break}if(d=t[c].obj,!d){e.next=29;break}if(!t[c].children){e.next=19;break}return e.next=16,n.reorderChildren(t,t[c].children,r);case 16:if(!e.sent){e.next=19;break}s++,i=!0;case 19:if(!d[r]){e.next=28;break}return e.next=22,EcConcept.get(d[r]);case 22:return u=e.sent,e.next=25,n.setProrgressionOrder(t,d,u,r);case 25:if(!e.sent){e.next=28;break}s++,i=!0;case 28:"ceterms:precedes"===r?c<t.length-1?(c++,o=t[c]):o=void 0:c>0?(c--,o=t[c]):o=void 0;case 29:e.next=10;break;case 31:e.next=5;break;case 33:a();case 34:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));function t(t,r){return e.apply(this,arguments)}return t}(),reorderChildren:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,r,n){var a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(i){var s,c,o,d,u,l,p;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:s=!1,c=!0,o=0;case 3:if(!(c&&o<100)){e.next=33;break}c=!1,d=void 0,d="ceterms:precedes"===n?0:r.length-1,u=r[d];case 8:if(!u){e.next=31;break}if(l=r[d].obj,!l){e.next=28;break}if(!l["skos:narrower"]){e.next=18;break}return e.next=14,a.reorderChildren(t,r[d].children,n);case 14:if(!e.sent){e.next=18;break}s=!0,o++,c=!0;case 18:if(!l[n]){e.next=28;break}return e.next=21,EcConcept.get(l[n]);case 21:return p=e.sent,e.next=24,a.setProrgressionOrder(t,l,p,n);case 24:if(!e.sent){e.next=28;break}s=!0,o++,c=!0;case 28:"ceterms:precedes"===n?d<r.length-1?(d++,u=r[d]):u=void 0:d>0?(d--,u=r[d]):u=void 0,e.next=8;break;case 31:e.next=3;break;case 33:i(s);case 34:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));function t(t,r,n){return e.apply(this,arguments)}return t}(),setProrgressionOrder:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,r,n,a){var i,s,c,o,d,u,l,p;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.findSiblingOfNode(r,n);case 2:if(i=e.sent,null===i){e.next=37;break}return e.next=6,this.findSubStructure(t,r);case 6:if(s=e.sent,s){e.next=10;break}return appLog("Error: No parent structure found"),e.abrupt("return",!1);case 10:return e.next=12,s.findIndex((function(e){return EcRemoteLinkedData.trimVersionFromUrl(e.obj?e.obj.id:e.id)===EcRemoteLinkedData.trimVersionFromUrl(r.id)}));case 12:return c=e.sent,e.next=15,s.findIndex((function(e){return EcRemoteLinkedData.trimVersionFromUrl(e.obj?e.obj.id:e.id)===EcRemoteLinkedData.trimVersionFromUrl(i.id)}));case 15:if(o=e.sent,n={obj:s[o].obj,children:s[o].children},"ceterms:precedes"!==a){e.next=27;break}if(c+1!==o){e.next=20;break}return e.abrupt("return",!1);case 20:return s.splice(o,1),e.next=23,s.findIndex((function(e){return EcRemoteLinkedData.trimVersionFromUrl(e.obj?e.obj.id:e.id)===EcRemoteLinkedData.trimVersionFromUrl(r.id)}));case 23:c=e.sent,s.splice(c+1,0,n),e.next=34;break;case 27:if(o+1!==c){e.next=29;break}return e.abrupt("return",!1);case 29:return s.splice(o,1),e.next=32,s.findIndex((function(e){return EcRemoteLinkedData.trimVersionFromUrl(e.obj?e.obj.id:e.id)===EcRemoteLinkedData.trimVersionFromUrl(r.id)}));case 32:c=e.sent,s.splice(c,0,n);case 34:return e.abrupt("return",!0);case 37:return e.next=39,this.findSiblingOfNode(n,r);case 39:if(i=e.sent,null===i){e.next=77;break}return e.next=43,this.findSubStructure(t,n);case 43:if(d=e.sent,d){e.next=47;break}return appLog("Error: No parent structure found"),e.abrupt("return",!1);case 47:return e.next=49,d.findIndex((function(e){return EcRemoteLinkedData.trimVersionFromUrl(e.obj?e.obj.id:e.id)===EcRemoteLinkedData.trimVersionFromUrl(i.id)}));case 49:return u=e.sent,e.next=52,d.findIndex((function(e){return EcRemoteLinkedData.trimVersionFromUrl(e.obj?e.obj.id:e.id)===EcRemoteLinkedData.trimVersionFromUrl(n.id)}));case 52:if(l=e.sent,!(u<0||u>=d.length||l<0||l>=d.length)){e.next=56;break}return appLog("Node index not found"),e.abrupt("return",!1);case 56:if(n={obj:d[l].obj,children:d[l].children},"ceterms:precedes"!==a){e.next=67;break}if(u+1!==l){e.next=60;break}return e.abrupt("return",!1);case 60:return d.splice(l,1),e.next=63,d.findIndex((function(e){return EcRemoteLinkedData.trimVersionFromUrl(e.obj?e.obj.id:e.id)===EcRemoteLinkedData.trimVersionFromUrl(i.id)}));case 63:u=e.sent,d.splice(u+1,0,n),e.next=74;break;case 67:if(l+1!==u){e.next=69;break}return e.abrupt("return",!1);case 69:return d.splice(l,1),e.next=72,d.findIndex((function(e){return EcRemoteLinkedData.trimVersionFromUrl(e.obj?e.obj.id:e.id)===EcRemoteLinkedData.trimVersionFromUrl(i.id)}));case 72:u=e.sent,d.splice(u,0,n);case 74:return e.abrupt("return",!0);case 77:if(!r["skos:broader"]){e.next=84;break}return e.next=80,EcConcept.get(EcRemoteLinkedData.trimVersionFromUrl(r["skos:broader"]).toString());case 80:return p=e.sent,e.abrupt("return",this.setProrgressionOrder(t,p,n,a));case 84:return appLog("Error: No common ancestry found"),e.abrupt("return",!1);case 86:case"end":return e.stop()}}),e,this)})));function t(t,r,n,a){return e.apply(this,arguments)}return t}(),findSiblingOfNode:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,r){var n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(a){var i,s,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=null,s=null,t["skos:broader"]&&(i=EcRemoteLinkedData.trimVersionFromUrl(t["skos:broader"])),r["skos:broader"]&&(s=EcRemoteLinkedData.trimVersionFromUrl(r["skos:broader"])),!s||!i||s.toString()!==i.toString()){e.next=8;break}a(r),e.next=24;break;case 8:if(t["skos:broader"]||r["skos:broader"]){e.next=12;break}a(r),e.next=24;break;case 12:if(r["skos:broader"]){e.next=16;break}a(null),e.next=24;break;case 16:return e.next=18,EcConcept.get(s.toString());case 18:return c=e.sent,e.t0=a,e.next=22,n.findSiblingOfNode(t,c);case 22:e.t1=e.sent,(0,e.t0)(e.t1);case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));function t(t,r){return e.apply(this,arguments)}return t}(),findSubStructure:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,r){var n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(a){var i,s,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r["skos:broader"]){e.next=3;break}return a(t),e.abrupt("return");case 3:i=null,i=r["skos:broader"].length&&r["skos:broader"].length>0?r["skos:broader"][0]:r["skos:broader"],s=0;case 6:if(!(s<t.length)){e.next=22;break}if(!t[s].children){e.next=19;break}if(EcRemoteLinkedData.trimVersionFromUrl(t[s].obj.id)!==i){e.next=13;break}return a(t[s].children),e.abrupt("return");case 13:return e.next=15,n.findSubStructure(t[s].children,r);case 15:if(c=e.sent,!c){e.next=19;break}return a(c),e.abrupt("return");case 19:s++,e.next=6;break;case 22:a(null);case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));function t(t,r){return e.apply(this,arguments)}return t}(),beginDrag:function(e){this.dragging=!0,void 0!==e&&(this.controlOnStart=e.originalEvent.ctrlKey||e.originalEvent.shiftKey)},endDrag:function(e){if("framework_drag"!==e.to.id){appLog(e.oldIndex,e.newIndex);var t=null,r=!1;this.shiftKey&&(this.controlOnStart=!0),e.from.id===e.to.id?e.newIndex+1<this.hierarchy.length?t=this.hierarchy[e.newIndex+1].obj.shortId():e.newIndex===this.hierarchy.length-1&&(r=!0):void 0===e.to.children[e.newIndex]?t=e.to.id:e.newIndex+1<e.to.children.length&&(t=e.to.children[e.newIndex+1].id),this.move(this.hierarchy[e.oldIndex].obj.shortId(),t,e.from.id,e.to.id,!this.controlOnStart,r)}else this.dragging=!1},setPrecedes:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(n){var a,i,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:(null===t||t.length<=0)&&n(!1),a=0;case 2:if(!(a<t.length)){e.next=38;break}if(!t[a]){e.next=35;break}if(!(t[a].children&&t[a].children.length>0)){e.next=13;break}if(!t[a].obj["ceterms:precedes"]){e.next=9;break}return delete t[a].obj["ceterms:precedes"],e.next=9,r.saveObject(t[a].obj);case 9:return e.next=11,r.setChildrenPrecedes(t,t[a].children);case 11:e.next=35;break;case 13:if(a!==t.length-1){e.next=22;break}return e.next=16,r.findPrecedes(t,EcRemoteLinkedData.trimVersionFromUrl(t[a].obj.id));case 16:return i=e.sent,t[a].obj["ceterms:precedes"]=EcRemoteLinkedData.trimVersionFromUrl(i),e.next=20,r.saveObject(t[a].obj);case 20:e.next=35;break;case 22:if(!(t[a+1].children&&t[a+1].children.length>0)){e.next=32;break}return e.next=25,r.findChildrenPrecedes(t[a+1].children,t[a].obj.id,!0);case 25:if(s=e.sent,null===s){e.next=30;break}return t[a].obj["ceterms:precedes"]=EcRemoteLinkedData.trimVersionFromUrl(s),e.next=30,r.saveObject(t[a].obj);case 30:e.next=35;break;case 32:return t[a].obj["ceterms:precedes"]=EcRemoteLinkedData.trimVersionFromUrl(t[a+1].obj.id),e.next=35,r.saveObject(t[a].obj);case 35:a++,e.next=2;break;case 38:n(!0);case 39:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),setChildrenPrecedes:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,r){var n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(a){var i,s,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:i=0;case 1:if(!(i<r.length)){e.next=38;break}if(!r[i]){e.next=35;break}if(!(r[i].children&&r[i].children.length>0)){e.next=12;break}if(!r[i].obj["ceterms:precedes"]){e.next=8;break}return delete r[i].obj["ceterms:precedes"],e.next=8,n.saveObject(r[i].obj);case 8:return e.next=10,n.setChildrenPrecedes(t,r[i].children);case 10:e.next=35;break;case 12:if(i!==r.length-1){e.next=22;break}return e.next=15,n.findPrecedes(t,EcRemoteLinkedData.trimVersionFromUrl(r[i].obj.id));case 15:if(s=e.sent,null===s){e.next=20;break}return r[i].obj["ceterms:precedes"]=EcRemoteLinkedData.trimVersionFromUrl(s),e.next=20,n.saveObject(r[i].obj);case 20:e.next=35;break;case 22:if(!(r[i+1].children&&r[i+1].children.length>0)){e.next=32;break}return e.next=25,n.findChildrenPrecedes(r[i+1].children,r[i].obj.id,!0);case 25:if(c=e.sent,null===c){e.next=30;break}return r[i].obj["ceterms:precedes"]=EcRemoteLinkedData.trimVersionFromUrl(c),e.next=30,n.saveObject(r[i].obj);case 30:e.next=35;break;case 32:return r[i].obj["ceterms:precedes"]=EcRemoteLinkedData.trimVersionFromUrl(r[i+1].obj.id),e.next=35,n.saveObject(r[i].obj);case 35:i++,e.next=1;break;case 38:a();case 39:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));function t(t,r){return e.apply(this,arguments)}return t}(),findPrecedes:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,r){var n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(a){var i,s,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=!1,null!==t){e.next=3;break}return e.abrupt("return",null);case 3:s=0;case 4:if(!(s<t.length)){e.next=20;break}if(i||EcRemoteLinkedData.trimVersionFromUrl(t[s].obj.id)!==r){e.next=9;break}i=!0,e.next=17;break;case 9:if(!(t[s].children&&t[s].children.length>0)){e.next=16;break}return e.next=12,n.findChildrenPrecedes(t[s].children,r,i);case 12:c=e.sent,c&&(c===r?i=!0:a(c)),e.next=17;break;case 16:i&&a(EcRemoteLinkedData.trimVersionFromUrl(t[s].obj.id));case 17:s++,e.next=4;break;case 20:a(null);case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));function t(t,r){return e.apply(this,arguments)}return t}(),findChildrenPrecedes:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,r,n){var a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(i){var s,c,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(s=n,null!==t){e.next=3;break}return e.abrupt("return",null);case 3:c=0;case 4:if(!(c<t.length)){e.next=20;break}if(s||EcRemoteLinkedData.trimVersionFromUrl(t[c].obj.id)!==r){e.next=9;break}s=!0,e.next=17;break;case 9:if(!(t[c].children&&t[c].children.length>0)){e.next=16;break}return e.next=12,a.findChildrenPrecedes(t[c].children,r,n);case 12:o=e.sent,o&&(o===r?s=!0:i(o)),e.next=17;break;case 16:s&&i(EcRemoteLinkedData.trimVersionFromUrl(t[c].obj.id));case 17:c++,e.next=4;break;case 20:i(s?r:null);case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));function t(t,r,n){return e.apply(this,arguments)}return t}(),setPrecededBy:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(n){var a,i,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:(null===t||t.length<=0)&&n(!1),a=t.length-1;case 2:if(!(a>=0)){e.next=39;break}if(!t[a]){e.next=36;break}if(!(t[a].children&&t[a].children.length>0)){e.next=13;break}if(!t[a].obj["ceterms:precededBy"]){e.next=9;break}return delete t[a].obj["ceterms:precededBy"],e.next=9,r.saveObject(t[a].obj);case 9:return e.next=11,r.setChildrenPrecededBy(t,t[a].children,a);case 11:e.next=36;break;case 13:if(0!==a){e.next=23;break}return e.next=16,r.findPrecededBy(t,EcRemoteLinkedData.trimVersionFromUrl(t[a].obj.id));case 16:if(i=e.sent,null===i){e.next=21;break}return t[a].obj["ceterms:precededBy"]=EcRemoteLinkedData.trimVersionFromUrl(i),e.next=21,r.saveObject(t[a].obj);case 21:e.next=36;break;case 23:if(!(t[a-1].children&&t[a-1].children.length>0)){e.next=33;break}return e.next=26,r.findChildrenPrecededBy(t[a-1].children,t[a].obj.id,!0);case 26:if(s=e.sent,null===s){e.next=31;break}return t[a].obj["ceterms:precededBy"]=EcRemoteLinkedData.trimVersionFromUrl(s),e.next=31,r.saveObject(t[a].obj);case 31:e.next=36;break;case 33:return t[a].obj["ceterms:precededBy"]=EcRemoteLinkedData.trimVersionFromUrl(t[a-1].obj.id),e.next=36,r.saveObject(t[a].obj);case 36:a--,e.next=2;break;case 39:n(!0);case 40:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),setChildrenPrecededBy:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,r){var n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(a){var i,s,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:i=r.length-1;case 1:if(!(i>=0)){e.next=38;break}if(!r[i]){e.next=35;break}if(!(r[i].children&&r[i].children.length>0)){e.next=12;break}if(!r[i].obj["ceterms:precededBy"]){e.next=8;break}return delete r[i].obj["ceterms:precededBy"],e.next=8,n.saveObject(r[i].obj);case 8:return e.next=10,n.setChildrenPrecededBy(t,r[i].children);case 10:e.next=35;break;case 12:if(0!==i){e.next=22;break}return e.next=15,n.findPrecededBy(t,EcRemoteLinkedData.trimVersionFromUrl(r[i].obj.id));case 15:if(s=e.sent,null===s){e.next=20;break}return r[i].obj["ceterms:precededBy"]=EcRemoteLinkedData.trimVersionFromUrl(s),e.next=20,n.saveObject(r[i].obj);case 20:e.next=35;break;case 22:if(!(r[i-1].children&&r[i-1].children.length>0)){e.next=32;break}return e.next=25,n.findChildrenPrecededBy(r[i-1].children,r[i].obj.id,!0);case 25:if(c=e.sent,null===c){e.next=30;break}return r[i].obj["ceterms:precededBy"]=EcRemoteLinkedData.trimVersionFromUrl(c),e.next=30,n.saveObject(r[i].obj);case 30:e.next=35;break;case 32:return r[i].obj["ceterms:precededBy"]=EcRemoteLinkedData.trimVersionFromUrl(r[i-1].obj.id),e.next=35,n.saveObject(r[i].obj);case 35:i--,e.next=1;break;case 38:a();case 39:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));function t(t,r){return e.apply(this,arguments)}return t}(),findPrecededBy:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,r){var n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(a){var i,s,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=!1,null!==t){e.next=3;break}return e.abrupt("return",null);case 3:s=t.length-1;case 4:if(!(s>=0)){e.next=20;break}if(i||EcRemoteLinkedData.trimVersionFromUrl(t[s].obj.id)!==r){e.next=9;break}i=!0,e.next=17;break;case 9:if(!(t[s].children&&t[s].children.length>0)){e.next=16;break}return e.next=12,n.findChildrenPrecededBy(t[s].children,r,i);case 12:c=e.sent,c&&(c===r?i=!0:a(c)),e.next=17;break;case 16:i&&a(EcRemoteLinkedData.trimVersionFromUrl(t[s].obj.id));case 17:s--,e.next=4;break;case 20:a(null);case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));function t(t,r){return e.apply(this,arguments)}return t}(),findChildrenPrecededBy:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,r,n){var a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(i){var s,c,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(s=n,null!==t){e.next=3;break}return e.abrupt("return",null);case 3:c=t.length-1;case 4:if(!(c>=0)){e.next=20;break}if(s||EcRemoteLinkedData.trimVersionFromUrl(t[c].obj.id)!==r){e.next=9;break}s=!0,e.next=17;break;case 9:if(!(t[c].children&&t[c].children.length>0)){e.next=16;break}return e.next=12,a.findChildrenPrecededBy(t[c].children,r,n);case 12:o=e.sent,o&&(o===r?s=!0:i(o)),e.next=17;break;case 16:s&&i(EcRemoteLinkedData.trimVersionFromUrl(t[c].obj.id));case 17:c--,e.next=4;break;case 20:i(s?r:null);case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));function t(t,r,n){return e.apply(this,arguments)}return t}(),saveObject:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r.repo.saveTo(t,(function(){n()}),appError);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),move:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,r,n,a,i,c){var o,d,u,l,p,h,m,f,b,k,g,x,v,y,w,E,C;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.once=!0,o=this,n!==a){e.next=26;break}if(!a){e.next=9;break}return e.next=6,EcRepository.get(a);case 6:e.t0=e.sent,e.next=10;break;case 9:e.t0=this.container;case 10:if(d=e.t0,u="skos:narrower","ConceptScheme"===d.type&&(d=this.container,u="skos:hasTopConcept"),l=d[u]?d[u].slice():null,p=d[u].indexOf(t),d[u].splice(p,1),null==r||void 0===r?(EcArray.isArray(d[u])||(d[u]=[]),d[u].push(t)):c?d[u].push(t):(h=d[u].indexOf(r),d[u].splice(h,0,t)),o.$store.commit("editor/addEditsToUndo",[{operation:"update",id:d.shortId(),fieldChanged:[u],initialValue:[l]}]),d["schema:dateModified"]=(new Date).toISOString(),!0!==this.$store.state.editor.private||!0===EcEncryptedValue.encryptOnSaveMap[d.id]){e.next=23;break}return e.next=22,EcEncryptedValue.toEncryptedValue(d);case 22:d=e.sent;case 23:this.repo.saveTo(d,(function(){o.computeHierarchy(!1)}),appError),e.next=64;break;case 26:return e.next=28,EcConcept.get(t);case 28:if(m=e.sent,!n){e.next=35;break}return e.next=32,EcRepository.get(n);case 32:e.t1=e.sent,e.next=36;break;case 35:e.t1=this.container;case 36:if(f=e.t1,b="skos:narrower",k="skos:broader",!a){e.next=45;break}return e.next=42,EcRepository.get(a);case 42:e.t2=e.sent,e.next=46;break;case 45:e.t2=this.container;case 46:if(g=e.t2,x="skos:narrower",v="skos:broader","ConceptScheme"===f.type&&(f=this.container,b="skos:hasTopConcept",k="skos:topConceptOf"),"ConceptScheme"===g.type&&(g=this.container,x="skos:hasTopConcept",v="skos:topConceptOf"),p=f[b].indexOf(t),y=f[b].slice(),w=m[k]?m[k].slice():null,E=g[x]?g[x].slice():null,C=m[v]?m[v].slice():null,i&&f[b].splice(p,1),n&&m[k]?(i&&EcArray.setRemove(m[k],n),0===m[k].length&&delete m[k]):delete m[k],f["schema:dateModified"]=(new Date).toISOString(),!0!==this.$store.state.editor.private||!0===EcEncryptedValue.encryptOnSaveMap[f.id]){e.next=63;break}return e.next=62,EcEncryptedValue.toEncryptedValue(f);case 62:f=e.sent;case 63:this.repo.saveTo(f,Object(s["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(null==r||void 0===r?(EcArray.isArray(g[x])||(g[x]=[]),g[x].push(t)):(n=g[x].indexOf(r),g[x].splice(n,0,t)),"ConceptScheme"===g.type?m[v]=a:(EcArray.isArray(m[v])||(m[v]=[]),a&&m[v].push(a)),o.$store.commit("editor/addEditsToUndo",[{operation:"update",id:f.shortId(),fieldChanged:[b],initialValue:[y]},{operation:"update",id:g.shortId(),fieldChanged:[x],initialValue:[E]},{operation:"update",id:m.shortId(),fieldChanged:[k,v],initialValue:[w,C]}]),g["schema:dateModified"]=(new Date).toISOString(),m["schema:dateModified"]=(new Date).toISOString(),!0!==o.$store.state.editor.private||!0===EcEncryptedValue.encryptOnSaveMap[g.id]){e.next=9;break}return e.next=8,EcEncryptedValue.toEncryptedValue(g);case 8:g=e.sent;case 9:if(!0!==o.$store.state.editor.private||!0===EcEncryptedValue.encryptOnSaveMap[m.id]){e.next=13;break}return e.next=12,EcEncryptedValue.toEncryptedValue(m);case 12:m=e.sent;case 13:o.repo.saveTo(g,(function(){o.repo.saveTo(m,appLog,appError),o.computeHierarchy(!1)}),appLog);case 14:case"end":return e.stop()}}),e)}))),appError);case 64:this.dragging=!1;case 65:case"end":return e.stop()}}),e,this)})));function t(t,r,n,a,i,s){return e.apply(this,arguments)}return t}(),add:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,n){var a,i,s,c,o,d,u,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=this,i=new EcConcept,this.queryParams.newObjectEndpoint?i.generateShortId(this.queryParams.newObjectEndpoint):i.generateId(this.repo.selectedServer),i["subType"]="Progression",i["schema:dateCreated"]=(new Date).toISOString(),i["schema:dateModified"]=(new Date).toISOString(),null!=EcIdentityManager.default.ids&&EcIdentityManager.default.ids.length>0&&i.addOwner(EcIdentityManager.default.ids[0].ppk.toPk()),this.container.owner&&this.container.owner.length>0)for(s=0;s<this.container.owner.length;s++)c=this.container.owner[s],i.addOwner(EcPk.fromPem(c));if(this.container.reader&&this.container.reader.length>0)for(s=0;s<this.container.reader.length;s++)o=this.container.reader[s],r.addReader(EcPk.fromPem(o));if(this.setDefaultLanguage(),i["skos:prefLabel"]={"@language":this.$store.state.editor.defaultLanguage,"@value":"New Progression Level"},i["ceasn:inProgressionModel"]=this.container.shortId(),t!==this.container.shortId()){e.next=39;break}if(d=this.container["skos:hasTopConcept"]?this.container["skos:hasTopConcept"].slice():null,EcArray.isArray(this.container["skos:hasTopConcept"])||(this.container["skos:hasTopConcept"]=[]),null==n||void 0===n?this.container["skos:hasTopConcept"].push(i.shortId()):(u=this.container["skos:hasTopConcept"].indexOf(n),this.container["skos:hasTopConcept"].splice(u+1,0,i.shortId())),i["skos:topConceptOf"]=this.container.shortId(),a.$store.commit("editor/addEditsToUndo",[{operation:"addNew",id:i.shortId()},{operation:"update",id:this.container.shortId(),fieldChanged:["skos:hasTopConcept"],initialValue:[d]}]),this.container["schema:dateModified"]=(new Date).toISOString(),i["schema:dateModified"]=(new Date).toISOString(),!0!==this.$store.state.editor.private){e.next=28;break}return e.next=23,EcEncryptedValue.toEncryptedValue(i);case 23:if(i=e.sent,!0===EcEncryptedValue.encryptOnSaveMap[a.container.id]){e.next=28;break}return e.next=27,EcEncryptedValue.toEncryptedValue(a.container);case 27:a.container=e.sent;case 28:return e.prev=28,e.next=31,this.repo.multiput([i,a.container]);case 31:a.once=!0,e.next=37;break;case 34:e.prev=34,e.t0=e["catch"](28),appError(e.t0);case 37:e.next=71;break;case 39:return i["skos:broader"]=[t],e.next=42,EcConcept.get(t);case 42:if(l=e.sent,d=l["skos:narrower"]?l["skos:narrower"].slice():null,EcArray.isArray(l["skos:narrower"])||(l["skos:narrower"]=[]),null==n||void 0===n?l["skos:narrower"].push(i.shortId()):(u=l["skos:narrower"].indexOf(n),l["skos:narrower"].splice(u+1,0,i.shortId())),a.$store.commit("editor/addEditsToUndo",[{operation:"addNew",id:i.shortId()},{operation:"update",id:l.shortId(),fieldChanged:["skos:narrower"],initialValue:[d]}]),this.container["schema:dateModified"]=(new Date).toISOString(),i["schema:dateModified"]=(new Date).toISOString(),l["schema:dateModified"]=(new Date).toISOString(),!0!==this.$store.state.editor.private){e.next=62;break}return e.next=53,EcEncryptedValue.toEncryptedValue(i);case 53:if(i=e.sent,!0===EcEncryptedValue.encryptOnSaveMap[l.id]){e.next=58;break}return e.next=57,EcEncryptedValue.toEncryptedValue(l);case 57:l=e.sent;case 58:if(!0===EcEncryptedValue.encryptOnSaveMap[a.container.id]){e.next=62;break}return e.next=61,EcEncryptedValue.toEncryptedValue(a.container);case 61:a.container=e.sent;case 62:return e.prev=62,e.next=65,this.repo.multiput([i,l,a.container]);case 65:a.once=!0,e.next=71;break;case 68:e.prev=68,e.t1=e["catch"](62),appError(e.t1);case 71:this.$store.commit("editor/newCompetency",i.shortId()),appLog("Added node: ",JSON.parse(i.toJson()));case 73:case"end":return e.stop()}}),e,this,[[28,34],[62,68]])})));function t(t,r){return e.apply(this,arguments)}return t}(),select:function(e,t){t?EcArray.setAdd(this.selectedArray,e):EcArray.setRemove(this.selectedArray,e)},onDraggableCheck:function(e){this.isDraggable=e},cancelImport:function(){this.deleteObject(this.container),this.$store.dispatch("app/clearImport")},openFramework:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,EcConceptScheme.get(this.container.shortId());case 2:t=e.sent,this.$store.commit("editor/framework",t),this.$router.push({name:"progressionModel",params:{frameworkId:this.container.id}});case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),onClickCreateNew:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.container.shortId(),1===this.selectedArray.length&&(t=this.selectedArray[0]),this.loading=!0,e.prev=3,e.next=6,this.add(t,null);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](3),appError(e.t0);case 11:this.loading=!1,this.addingNode=!1;case 13:case"end":return e.stop()}}),e,this,[[3,8]])})));function t(){return e.apply(this,arguments)}return t}(),deleteSelected:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,EcRepository.get(this.selectedArray[0]);case 2:t=e.sent,this.deleteLevel(t),this.selectedArray.splice(0,this.selectedArray.length);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),deleteLevel:function(e){appLog("deleting "+e.id),this.deleteLevelInner(e),this.framework["schema:dateModified"]=(new Date).toISOString(),this.$store.commit("editor/selectedCompetency",null)},deleteLevelInner:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){var r,n,a,i,s,c,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=this,n=[],null==t["skos:broader"]){e.next=28;break}a=0;case 4:if(!(a<t["skos:broader"].length)){e.next=28;break}return e.prev=5,e.next=8,EcConcept.get(t["skos:broader"][a]);case 8:if(i=e.sent,s=i["skos:narrower"].slice(),EcArray.setRemove(i["skos:narrower"],t.shortId()),i["schema:dateModified"]=(new Date).toISOString(),n.push({operation:"update",id:i.shortId(),fieldChanged:["skos:narrower"],initialValue:[s]}),!0!==r.$store.state.editor.private||!0===EcEncryptedValue.encryptOnSaveMap[i.id]){e.next=17;break}return e.next=16,EcEncryptedValue.toEncryptedValue(i);case 16:i=e.sent;case 17:return e.next=19,repo.saveTo(i);case 19:r.$store.commit("editor/framework",r.framework),e.next=25;break;case 22:e.prev=22,e.t0=e["catch"](5),appError(e.t0);case 25:a++,e.next=4;break;case 28:if(null==t["skos:narrower"]){e.next=44;break}a=0;case 30:if(!(a<t["skos:narrower"].length)){e.next=44;break}return e.prev=31,e.next=34,EcConcept.get(t["skos:narrower"][a]);case 34:c=e.sent,r.deleteLevelInner(c),e.next=41;break;case 38:e.prev=38,e.t1=e["catch"](31),appError(e.t1);case 41:a++,e.next=30;break;case 44:if(null==t["skos:topConceptOf"]){e.next=63;break}if(e.prev=45,s=this.framework["skos:hasTopConcept"].slice(),EcArray.setRemove(this.framework["skos:hasTopConcept"],t.shortId()),n.push({operation:"update",id:this.framework.shortId(),fieldChanged:["skos:hasTopConcept"],initialValue:[s]}),o=this.framework,o["schema:dateModified"]=(new Date).toISOString(),!0!==this.$store.state.editor.private||!0===EcEncryptedValue.encryptOnSaveMap[o.id]){e.next=55;break}return e.next=54,EcEncryptedValue.toEncryptedValue(o);case 54:o=e.sent;case 55:return e.next=57,repo.saveTo(o);case 57:r.$store.commit("editor/framework",r.framework),e.next=63;break;case 60:e.prev=60,e.t2=e["catch"](45),appError(e.t2);case 63:this.spitEvent("levelDeleted",t.shortId(),"editFrameworkPage"),n.push({operation:"delete",obj:t}),repo.deleteRegistered(t,(function(){r.$store.commit("editor/framework",r.framework),r.$store.commit("editor/addEditsToUndo",JSON.parse(JSON.stringify(n))),n.splice(0,n.length)}),appError);case 66:case"end":return e.stop()}}),e,this,[[5,22],[31,38],[45,60]])})));function t(t){return e.apply(this,arguments)}return t}()}},u=d,l=(n("24ea"),n("2877")),p=Object(l["a"])(u,a,i,!1,null,null,null);t["default"]=p.exports},"6ffa4":function(e,t,r){"use strict";r("fb6a"),r("96cf");var n=r("c964"),a=r("872c");t["a"]={mixins:[a["a"]],methods:{removeObject:function(e){appLog("removing "+e.id);var t=this,r=this.$store.getters["editor/framework"],a=r.competency?r.competency.slice():null,i=r.relation?r.relation.slice():null,s=r.level?r.level.slice():null;r["schema:dateModified"]=(new Date).toISOString(),r.removeCompetency(e.shortId(),Object(n["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.framework,t.$store.commit("editor/addEditsToUndo",[{operation:"update",id:n.shortId(),fieldChanged:["competency","relation","level"],initialValue:[a,i,s]}]),!0!==t.$store.state.editor.private||!0===EcEncryptedValue.encryptOnSaveMap[f.id]){e.next=6;break}return e.next=5,EcEncryptedValue.toEncryptedValue(n);case 5:n=e.sent;case 6:window.repo.saveTo(n,(function(){t.$store.commit("editor/framework",r)}),appError);case 7:case"end":return e.stop()}}),e)}))),appLog)},deleteObject:function(e){appLog("deleting "+e.id);var t=this,r=this.$store.getters["editor/framework"];if(e.shortId()===r.shortId())window.repo.deleteRegistered(r,(function(e){if(t.spitEvent("frameworkDeleted",r.shortId(),"editFrameworkSection"),null!=r.competency)for(var n=0;n<r.competency.length;n++)t.conditionalDelete(r.competency[n]);if(null!=r.relation)for(n=0;n<r.relation.length;n++)t.conditionalDelete(r.relation[n]);if(null!=r.level)for(n=0;n<r.level.length;n++)t.conditionalDelete(r.level[n]);t.$store.commit("editor/framework",null),t.importType?t.$store.commit("app/importFramework",null):t.$router.push({name:"frameworks"})}),appLog);else{var a=r.competency?r.competency.slice():null,i=r.relation?r.relation.slice():null,s=r.level?r.level.slice():null;this.$store.commit("editor/selectedCompetency",e),r["schema:dateModified"]=(new Date).toISOString(),r.removeCompetency(e.shortId(),Object(n["a"])(regeneratorRuntime.mark((function n(){var c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r.removeLevel(e.shortId()),t.$store.commit("editor/addEditsToUndo",[{operation:"delete",obj:e},{operation:"update",id:r.shortId(),fieldChanged:["competency","relation","level"],initialValue:[a,i,s],changedValue:[r.competency,r.relation,r.level]}]),t.conditionalDelete(e.shortId()),t.spitEvent("competencyDeleted",e.shortId(),"editFrameworkSection"),t.$store.commit("editor/selectedCompetency",null),c=r,!0!==t.$store.state.editor.private||!0===EcEncryptedValue.encryptOnSaveMap[r.id]){n.next=10;break}return n.next=9,EcEncryptedValue.toEncryptedValue(r);case 9:c=n.sent;case 10:window.repo.saveTo(c,(function(){t.$store.commit("editor/framework",r)}),appError);case 11:case"end":return n.stop()}}),n)}))),appLog)}}}}},a348:function(e,t,r){},c740:function(e,t,r){"use strict";var n=r("23e7"),a=r("b727").findIndex,i=r("44d2"),s="findIndex",c=!0;s in[]&&Array(1)[s]((function(){c=!1})),n({target:"Array",proto:!0,forced:c},{findIndex:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),i(s)}}]);
//# sourceMappingURL=chunk-51369fc1.f11b33df.js.map