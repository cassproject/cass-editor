(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4f8e6938","chunk-74a95bb3"],{"031c":function(e,t,r){"use strict";r("ce3b")},"25d8":function(e,t,n){"use strict";n.r(t);n("99af"),n("fb6a");var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"lode__hierarchy",class:{"is-dragging":e.dragging}},[t("div",{staticClass:"hierarchy-buttons columns is-gapless is-paddingless is-mobile is-marginless is-paddingless"},[e.canEdit&&"import"!==e.view||e.queryParams.select?t("div",{staticClass:"column is-narrow",attrs:{id:"check-radio-all-column"}},[t("div",{staticClass:"field"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.selectAll,expression:"selectAll"}],staticClass:"is-checkradio",attrs:{id:"selectAllCheckbox",type:"checkbox",name:"selectAllCheckbox"},domProps:{checked:Array.isArray(e.selectAll)?e._i(e.selectAll,null)>-1:e.selectAll},on:{change:function(t){var r=e.selectAll,n=t.target,i=!!n.checked;if(Array.isArray(r)){var a=null,s=e._i(r,a);n.checked?s<0&&(e.selectAll=r.concat([a])):s>-1&&(e.selectAll=r.slice(0,s).concat(r.slice(s+1)))}else e.selectAll=i}}}),t("label",{attrs:{for:"selectAllCheckbox"}})])]):e._e(),t("div",{staticClass:"column is-narrow"},[e.expanded?t("div",{staticClass:"icon is-vcentered",on:{click:function(t){e.expanded=!1}}},[t("i",{staticClass:"fa fa-caret-down has-text-primary is-size-2"})]):e.expanded?t("div",{staticClass:"icon is-vcentered"},[t("i",{staticClass:"fa fa-circle is-size-6 has-text-light"})]):t("div",{staticClass:"icon is-vcentered",on:{click:function(t){e.expanded=!0}}},[t("i",{staticClass:"fa fa-caret-right has-text-primary is-size-2"})]),e.selectButtonText?t("div",{staticClass:"button is-outlined is-primary",on:{click:function(t){return e.$emit("select-button-click",e.selectedArray)}}},[e._v(" "+e._s(e.selectButtonText)+" ")]):e._e()]),t("div",{staticClass:"column is-narrow"},[t("div",{staticClass:"buttons"},[e.multipleSelected&&!e.addingNode&&"import"!==e.view&&e.canEdit?t("div",{staticClass:"button is-outlined is-primary",on:{click:function(t){return e.$emit("edit-multiple-event")}}},[e._m(0),t("span",[e._v(" Edit multiple ")])]):e._e(),e.addingNode||!e.canEdit||e.multipleSelected?e._e():t("div",{staticClass:"button is-outlined is-primary",on:{click:function(t){e.addingNode=!0}}},[e._m(1),t("span",[e._v(" "+e._s(e.addConceptOrChildText)+" ")])]),!e.addingNode&&e.canEdit&&!e.multipleSelected&&e.canCopyOrCut?t("div",{staticClass:"button is-outlined is-danger",on:{click:e.deleteSelected}},[e._m(2),t("span",[e._v(" delete item ")])]):e._e(),e.addingNode?t("div",{staticClass:"button is-outlined is-dark",on:{click:function(t){e.addingNode=!1}}},[e._m(3),t("span",[e._v("cancel")])]):e._e(),e.addingNode?t("div",{staticClass:"button is-outlined is-primary",class:{"is-loading":e.loading},on:{click:e.onClickCreateNew}},[e._m(4),t("span",[e._v(" create new ")])]):e._e(),"framework"===e.view||"concept"===e.view?t("div",{staticClass:"button is-outlined",class:e.canCopyOrCut?"is-primary":"is-disabled",attrs:{disabled:!e.canCopyOrCut,title:"Copy concept"},on:{click:e.copyClick}},[e._m(5)]):e._e(),"framework"===e.view||"concept"===e.view?t("div",{staticClass:"button is-outlined",class:e.canCopyOrCut?"is-primary":"is-disabled",attrs:{title:"Cut concept",disabled:!e.canCopyOrCut},on:{click:e.cutClick}},[e._m(6)]):e._e(),"framework"===e.view||"concept"===e.view?t("div",{staticClass:"button is-outlined",class:e.canPaste?"is-primary":"is-disabled",attrs:{disabled:!e.canPaste,title:"Paste concept"},on:{click:e.pasteClick}},[e._m(7)]):e._e()])]),"import"===e.view?t("div",{staticClass:"column"},[t("div",{staticClass:"buttons is-right"},[t("div",{staticClass:"buttons is-right"},[t("div",{staticClass:"button is-light is-pulled-right is-dark is-outlined",on:{click:e.cancelImport}},[t("span",[e._v(" Cancel ")]),e._m(8)]),t("div",{staticClass:"button is-dark is-outlined is-pulled-right",on:{click:function(t){return e.$store.dispatch("app/clearImport")}}},[t("span",[e._v(" import again ")]),e._m(9)]),t("div",{staticClass:"button is-dark is-outlined is-pulled-right",on:{click:e.openFramework}},[t("span",[e._v("view in editor")]),e._m(10)]),t("router-link",{staticClass:"button is-primary is-outlined is -pulled-right",attrs:{to:{path:"/concepts",query:e.queryParams}}},[t("span",[e._v(" Done ")]),t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-home"})])])],1)])]):e._e()]),e.hierarchy?[t("draggable",e._b({staticClass:"lode__hierarchy-ul",attrs:{tag:"ul",disabled:!0!==e.canEdit||!e.isDraggable,group:{name:"test"},handle:".handle"},on:{start:e.beginDrag,end:e.endDrag},model:{value:e.hierarchy,callback:function(t){e.hierarchy=t},expression:"hierarchy"}},"draggable",e.dragOptions,!1),e._l(e.hierarchy,(function(r,n){return t("HierarchyNode",{key:r.obj.id,staticClass:"lode__hierarchy-li",attrs:{depth:1,view:e.view,subview:e.subview,obj:r.obj,dragging:e.dragging,canEdit:e.canEdit,hasChild:r.children,profile:e.profile,highlightList:e.highlightList,selectAll:e.selectAll,newFramework:e.newFramework,index:n,frameworkEditable:e.canEdit,selectedArray:e.selectedArray,parentStructure:e.hierarchy,parent:e.container,properties:e.properties,expandAll:1==e.expanded,propagateParentChecked:"false",shiftKey:e.shiftKey,arrowKey:e.arrowKey,largeNumberOfItems:e.hasLargeNumberOfItems},on:{"create-new-node-event":e.onCreateNewNode,"mounting-node":e.handleMountingNode,add:e.add,"begin-drag":e.beginDrag,move:e.move,select:e.select,"draggable-check":e.onDraggableCheck}})})),1)]:e._e()],2)},a=[function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-cog"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-plus-circle"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-plus-circle"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-times"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-plus"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-copy"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fas handle fa-cut"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-paste"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-times-circle"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-redo-alt"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"icon"},[t("i",{staticClass:"fa fa-edit"})])}],s=n("c7eb"),o=n("1da1"),c=(n("d3b7"),n("3ca3"),n("ddb0"),n("ac1f"),n("841c"),n("14d9"),n("a434"),n("b64b"),n("e9c4"),n("872c")),d=n("6ffa4"),l={name:"ConceptHierarchy",props:{container:Object,containerType:String,repo:Object,profile:Object,highlightList:Array,selectMode:Boolean,selectAll:Boolean,containerTypeGet:String,viewOnly:Boolean,newFramework:Boolean,properties:String,view:{type:String,default:"framework"},subview:{type:String,default:""},doneDragging:{type:Boolean,default:!1}},data:function(){return{structure:[],once:!0,dragging:!1,controlOnStart:!1,filter:"showAll",dragIcon:"fa-arrows-alt",dragOptions:{delay:100,disabled:!1,ghostClass:"ghost-drag",chosenClass:"chosen-drag",dragClass:"drag",scrollSensitivity:200,forceFallback:!0},multipleSelected:!1,addingNode:!1,selectedArray:[],selectButtonText:null,expanded:!0,hasLargeNumberOfItems:!1,isDraggable:!0,shiftKey:!1,arrowKey:null,addConceptOrChildText:"Add Concept",loading:!1}},components:{HierarchyNode:function(){return n.e("chunk-4cf587c0").then(n.bind(null,"b709"))},draggable:function(){return n.e("chunk-4a5f46a6").then(n.t.bind(null,"b76a",7))}},mixins:[c["a"],d["a"]],computed:{canCopyOrCut:function(){return!(!this.selectedArray||1!==this.selectedArray.length)},canPaste:function(){return(null!==this.$store.getters["editor/copyId"]||null!==this.$store.getters["editor/cutId"])&&null!==this.$store.getters["editor/nodeInFocus"]},queryParams:function(){return this.$store.getters["editor/queryParams"]},addAnother:function(){return this.$store.getters["editor/addAnother"]},hierarchy:function(){var e=this;if(null==this.container)return null;if(!this.once)return this.structure;appLog("Computing hierarchy.");var t=[];return null!=this.container["skos:hasTopConcept"]&&(t=t.concat(this.container["skos:hasTopConcept"])),t.length>0?null!=this.container["skos:hasTopConcept"]?EcConcept.search(this.repo,'skos\\:inScheme:"'+this.container.shortId()+'"',(function(r){r.length>200&&(e.hasLargeNumberOfItems=!0),e.hasLargeNumberOfItems&&(e.expanded=!1),e.repo.multiget(t,(function(t){e.computeHierarchy()}),appError)}),null,{size:1e4}):this.repo.multiget(t,(function(t){e.computeHierarchy()}),appError):e.computeHierarchy(),this.structure},canEdit:function(){return!0!==this.viewOnly&&this.canEditAny(this.container)},recomputeHierarchy:function(){return this.$store.getters["editor/recomputeHierarchy"]},framework:function(){return this.$store.getters["editor/framework"]}},watch:{container:{handler:function(){this.once=!0},deep:!0},selectedArray:function(){this.selectedArray.length>1?this.multipleSelected=!0:this.multipleSelected=!1,1===this.selectedArray.length?this.addConceptOrChildText="Add Child":this.addConceptOrChildText="Add Concept",this.$emit("selected-array",this.selectedArray)},recomputeHierarchy:function(){this.recomputeHierarchy&&(this.once=!0,this.$store.commit("editor/recomputeHierarchy",!1))},doneDragging:function(){this.doneDragging&&(this.dragging=!1)},addAnother:function(e){e&&(this.onClickCreateNew(),this.$store.commit("editor/addAnother",!1))}},mounted:function(){this.queryParams&&(this.queryParams.singleSelect&&(this.selectButtonText=this.queryParams.singleSelect),this.queryParams.select&&""!==this.queryParams.select&&"select"!==this.queryParams.select&&(this.selectButtonText=this.queryParams.select)),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup)},beforeDestroy:function(){window.removeEventListener("keyup",this.keyup),window.removeEventListener("keydown",this.keydown)},methods:{cutClick:function(){this.selectedArray&&1===this.selectedArray.length&&this.$store.commit("editor/cutId",this.selectedArray[0]),this.$store.commit("editor/copyId",null),this.$store.commit("editor/paste",!1)},copyClick:function(){this.selectedArray&&1===this.selectedArray.length&&this.$store.commit("editor/copyId",this.selectedArray[0]),this.$store.commit("editor/cutId",null),this.$store.commit("editor/paste",!1)},pasteClick:function(){this.$store.commit("editor/paste",!0)},keydown:function(e){this.canEdit&&(e.shiftKey&&(this.shiftKey=!0),-1!==e.key.indexOf("Arrow")&&e.shiftKey&&(this.arrowKey=e.key),"x"===e.key&&e.ctrlKey&&(this.selectedArray&&1===this.selectedArray.length&&this.$store.commit("editor/cutId",this.selectedArray[0]),this.$store.commit("editor/copyId",null),this.$store.commit("editor/paste",!1)),"c"===e.key&&e.ctrlKey&&(this.selectedArray&&1===this.selectedArray.length&&this.$store.commit("editor/copyId",this.selectedArray[0]),this.$store.commit("editor/cutId",null),this.$store.commit("editor/paste",!1)),"v"===e.key&&e.ctrlKey&&this.$store.commit("editor/paste",!0))},keyup:function(e){e.shiftKey||(this.shiftKey=!1),-1!==e.key.indexOf("Arrow")&&(this.arrowKey=null)},onCreateNewNode:function(e,t){this.add(e,t)},handleMountingNode:function(){this.startTime()},startTime:function(){var e=this;setTimeout((function(){e.$emit("done-loading-nodes")}),1e3)},computeHierarchy:function(){var e=Object(o["a"])(Object(s["a"])().mark((function e(){var t,n,i;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=[],null!=this.container){e.next=3;break}return e.abrupt("return",r);case 3:if(null===this.container["skos:hasTopConcept"]||void 0===this.container["skos:hasTopConcept"]){e.next=13;break}n=0;case 5:if(!(n<this.container["skos:hasTopConcept"].length)){e.next=13;break}return e.next=8,EcConcept.get(this.container["skos:hasTopConcept"][n]);case 8:i=e.sent,i&&(t.push({obj:i,children:[]}),i["skos:narrower"]&&this.addChildren(t,i,n));case 10:n++,e.next=5;break;case 13:this.structure=t,this.once=!1;case 15:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),addChildren:function(){var e=Object(o["a"])(Object(s["a"])().mark((function e(t,r,n){var i,a;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:i=0;case 1:if(!(i<r["skos:narrower"].length)){e.next=10;break}return e.next=4,EcConcept.get(r["skos:narrower"][i]);case 4:a=e.sent,t[n].children.push({obj:a,children:[]}),a&&a["skos:narrower"]&&this.addChildren(t[n].children,a,i);case 7:i++,e.next=1;break;case 10:case"end":return e.stop()}}),e,this)})));function t(t,r,n){return e.apply(this,arguments)}return t}(),beginDrag:function(e){this.dragging=!0,void 0!==e&&(this.controlOnStart=e.originalEvent.ctrlKey||e.originalEvent.shiftKey)},endDrag:function(e){if("framework_drag"!==e.to.id){appLog(e.oldIndex,e.newIndex);var t=null,r=!1;this.shiftKey&&(this.controlOnStart=!0),e.from.id===e.to.id?e.newIndex+1<this.hierarchy.length?t=this.hierarchy[e.newIndex+1].obj.shortId():e.newIndex===this.hierarchy.length-1&&(r=!0):void 0===e.to.children[e.newIndex]?t=e.to.id:e.newIndex+1<e.to.children.length&&(t=e.to.children[e.newIndex+1].id),this.move(this.hierarchy[e.oldIndex].obj.shortId(),t,e.from.id,e.to.id,!this.controlOnStart,r)}else this.dragging=!1},move:function(){var e=Object(o["a"])(Object(s["a"])().mark((function e(t,r,n,i,a,c){var d,l,p,h,u,f,m,y,g,k,v,w,b,C,E,x,O;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.once=!0,d=this,n!==i){e.next=26;break}if(!i){e.next=9;break}return e.next=6,EcRepository.get(i);case 6:e.t0=e.sent,e.next=10;break;case 9:e.t0=this.container;case 10:if(l=e.t0,p="skos:narrower","ConceptScheme"===l.type&&(l=this.container,p="skos:hasTopConcept"),h=l[p]?l[p].slice():null,u=l[p].indexOf(t),l[p].splice(u,1),null==r||void 0===r?(EcArray.isArray(l[p])||(l[p]=[]),l[p].push(t)):c?l[p].push(t):(f=l[p].indexOf(r),l[p].splice(f,0,t)),d.$store.commit("editor/addEditsToUndo",[{operation:"update",id:l.shortId(),fieldChanged:[p],initialValue:[h]}]),l["schema:dateModified"]=(new Date).toISOString(),!0!==this.$store.state.editor.private||!0===EcEncryptedValue.encryptOnSaveMap[l.id]){e.next=23;break}return e.next=22,EcEncryptedValue.toEncryptedValue(l);case 22:l=e.sent;case 23:this.repo.saveTo(l,(function(){d.computeHierarchy()}),appError),e.next=64;break;case 26:return e.next=28,EcConcept.get(t);case 28:if(m=e.sent,!n){e.next=35;break}return e.next=32,EcRepository.get(n);case 32:e.t1=e.sent,e.next=36;break;case 35:e.t1=this.container;case 36:if(y=e.t1,g="skos:narrower",k="skos:broader",!i){e.next=45;break}return e.next=42,EcRepository.get(i);case 42:e.t2=e.sent,e.next=46;break;case 45:e.t2=this.container;case 46:if(v=e.t2,w="skos:narrower",b="skos:broader","ConceptScheme"===y.type&&(y=this.container,g="skos:hasTopConcept",k="skos:topConceptOf"),"ConceptScheme"===v.type&&(v=this.container,w="skos:hasTopConcept",b="skos:topConceptOf"),u=y[g].indexOf(t),C=y[g].slice(),E=m[k]?m[k].slice():null,x=v[w]?v[w].slice():null,O=m[b]?m[b].slice():null,a&&y[g].splice(u,1),n&&m[k]?(a&&EcArray.setRemove(m[k],n),0===m[k].length&&delete m[k]):delete m[k],y["schema:dateModified"]=(new Date).toISOString(),!0!==this.$store.state.editor.private||!0===EcEncryptedValue.encryptOnSaveMap[y.id]){e.next=63;break}return e.next=62,EcEncryptedValue.toEncryptedValue(y);case 62:y=e.sent;case 63:this.repo.saveTo(y,Object(o["a"])(Object(s["a"])().mark((function e(){var n;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(null==r||void 0===r?(EcArray.isArray(v[w])||(v[w]=[]),v[w].push(t)):(n=v[w].indexOf(r),v[w].splice(n,0,t)),"ConceptScheme"===v.type?m[b]=i:(EcArray.isArray(m[b])||(m[b]=[]),i&&m[b].push(i)),d.$store.commit("editor/addEditsToUndo",[{operation:"update",id:y.shortId(),fieldChanged:[g],initialValue:[C]},{operation:"update",id:v.shortId(),fieldChanged:[w],initialValue:[x]},{operation:"update",id:m.shortId(),fieldChanged:[k,b],initialValue:[E,O]}]),v["schema:dateModified"]=(new Date).toISOString(),m["schema:dateModified"]=(new Date).toISOString(),!0!==d.$store.state.editor.private||!0===EcEncryptedValue.encryptOnSaveMap[v.id]){e.next=9;break}return e.next=8,EcEncryptedValue.toEncryptedValue(v);case 8:v=e.sent;case 9:if(!0!==d.$store.state.editor.private||!0===EcEncryptedValue.encryptOnSaveMap[m.id]){e.next=13;break}return e.next=12,EcEncryptedValue.toEncryptedValue(m);case 12:m=e.sent;case 13:d.repo.saveTo(v,(function(){d.repo.saveTo(m,appLog,appError),d.computeHierarchy()}),appLog);case 14:case"end":return e.stop()}}),e)}))),appError);case 64:this.dragging=!1;case 65:case"end":return e.stop()}}),e,this)})));function t(t,r,n,i,a,s){return e.apply(this,arguments)}return t}(),add:function(){var e=Object(o["a"])(Object(s["a"])().mark((function e(t,n){var i,a,o,c,d,l,p,h;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=this,a=new EcConcept,this.queryParams.newObjectEndpoint?a.generateShortId(this.queryParams.newObjectEndpoint):a.generateId(this.repo.selectedServer),a["schema:dateCreated"]=(new Date).toISOString(),a["schema:dateModified"]=(new Date).toISOString(),null!=EcIdentityManager.default.ids&&EcIdentityManager.default.ids.length>0&&a.addOwner(EcIdentityManager.default.ids[0].ppk.toPk()),this.container.owner&&this.container.owner.length>0)for(o=0;o<this.container.owner.length;o++)c=this.container.owner[o],a.addOwner(EcPk.fromPem(c));if(this.container.reader&&this.container.reader.length>0)for(o=0;o<this.container.reader.length;o++)d=this.container.reader[o],r.addReader(EcPk.fromPem(d));if(this.setDefaultLanguage(),a["skos:prefLabel"]={"@language":this.$store.state.editor.defaultLanguage,"@value":"New Concept"},a["skos:inScheme"]=this.container.shortId(),t!==this.container.shortId()){e.next=38;break}if(l=this.container["skos:hasTopConcept"]?this.container["skos:hasTopConcept"].slice():null,EcArray.isArray(this.container["skos:hasTopConcept"])||(this.container["skos:hasTopConcept"]=[]),null==n||void 0===n?this.container["skos:hasTopConcept"].push(a.shortId()):(p=this.container["skos:hasTopConcept"].indexOf(n),this.container["skos:hasTopConcept"].splice(p+1,0,a.shortId())),a["skos:topConceptOf"]=this.container.shortId(),i.$store.commit("editor/addEditsToUndo",[{operation:"addNew",id:a.shortId()},{operation:"update",id:this.container.shortId(),fieldChanged:["skos:hasTopConcept"],initialValue:[l]}]),this.container["schema:dateModified"]=(new Date).toISOString(),a["schema:dateModified"]=(new Date).toISOString(),!0!==this.$store.state.editor.private){e.next=27;break}return e.next=22,EcEncryptedValue.toEncryptedValue(a);case 22:if(a=e.sent,!0===EcEncryptedValue.encryptOnSaveMap[i.container.id]){e.next=27;break}return e.next=26,EcEncryptedValue.toEncryptedValue(i.container);case 26:i.container=e.sent;case 27:return e.prev=27,e.next=30,this.repo.multiput([a,i.container]);case 30:i.once=!0,e.next=36;break;case 33:e.prev=33,e.t0=e["catch"](27),appError(e.t0);case 36:e.next=70;break;case 38:return a["skos:broader"]=[t],e.next=41,EcConcept.get(t);case 41:if(h=e.sent,l=h["skos:narrower"]?h["skos:narrower"].slice():null,EcArray.isArray(h["skos:narrower"])||(h["skos:narrower"]=[]),null==n||void 0===n?h["skos:narrower"].push(a.shortId()):(p=h["skos:narrower"].indexOf(n),h["skos:narrower"].splice(p+1,0,a.shortId())),i.$store.commit("editor/addEditsToUndo",[{operation:"addNew",id:a.shortId()},{operation:"update",id:h.shortId(),fieldChanged:["skos:narrower"],initialValue:[l]}]),this.container["schema:dateModified"]=(new Date).toISOString(),a["schema:dateModified"]=(new Date).toISOString(),h["schema:dateModified"]=(new Date).toISOString(),!0!==this.$store.state.editor.private){e.next=61;break}return e.next=52,EcEncryptedValue.toEncryptedValue(a);case 52:if(a=e.sent,!0===EcEncryptedValue.encryptOnSaveMap[h.id]){e.next=57;break}return e.next=56,EcEncryptedValue.toEncryptedValue(h);case 56:h=e.sent;case 57:if(!0===EcEncryptedValue.encryptOnSaveMap[i.container.id]){e.next=61;break}return e.next=60,EcEncryptedValue.toEncryptedValue(i.container);case 60:i.container=e.sent;case 61:return e.prev=61,e.next=64,this.repo.multiput([a,h,i.container]);case 64:i.once=!0,e.next=70;break;case 67:e.prev=67,e.t1=e["catch"](61),appError(e.t1);case 70:this.$store.commit("editor/newCompetency",a.shortId()),appLog("Added node: ",JSON.parse(a.toJson()));case 72:case"end":return e.stop()}}),e,this,[[27,33],[61,67]])})));function t(t,r){return e.apply(this,arguments)}return t}(),select:function(e,t){t?EcArray.setAdd(this.selectedArray,e):EcArray.setRemove(this.selectedArray,e)},onDraggableCheck:function(e){this.isDraggable=e},cancelImport:function(){this.deleteObject(this.container),this.$store.dispatch("app/clearImport")},openFramework:function(){var e=Object(o["a"])(Object(s["a"])().mark((function e(){var t;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,EcConceptScheme.get(this.container.shortId());case 2:t=e.sent,this.$store.commit("editor/framework",t),this.$router.push({name:"conceptScheme",params:{frameworkId:this.container.id}});case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),onClickCreateNew:function(){var e=Object(o["a"])(Object(s["a"])().mark((function e(){var t;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.container.shortId(),1===this.selectedArray.length&&(t=this.selectedArray[0]),this.loading=!0,e.prev=3,e.next=6,this.add(t,null);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](3),appError(e.t0);case 11:this.loading=!1,this.addingNode=!1;case 13:case"end":return e.stop()}}),e,this,[[3,8]])})));function t(){return e.apply(this,arguments)}return t}(),deleteSelected:function(){var e=Object(o["a"])(Object(s["a"])().mark((function e(){var t;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,EcRepository.get(this.selectedArray[0]);case 2:t=e.sent,this.deleteConcept(t),this.selectedArray.splice(0,this.selectedArray.length);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),deleteConcept:function(e){appLog("deleting "+e.id),this.deleteConceptInner(e),this.framework["schema:dateModified"]=(new Date).toISOString(),this.$store.commit("editor/selectedCompetency",null)},deleteConceptInner:function(){var e=Object(o["a"])(Object(s["a"])().mark((function e(t){var r,n,i,a,o,c,d;return Object(s["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=this,n=[],null==t["skos:broader"]){e.next=28;break}i=0;case 4:if(!(i<t["skos:broader"].length)){e.next=28;break}return e.prev=5,e.next=8,EcConcept.get(t["skos:broader"][i]);case 8:if(a=e.sent,o=a["skos:narrower"].slice(),EcArray.setRemove(a["skos:narrower"],t.shortId()),a["schema:dateModified"]=(new Date).toISOString(),n.push({operation:"update",id:a.shortId(),fieldChanged:["skos:narrower"],initialValue:[o]}),!0!==r.$store.state.editor.private||!0===EcEncryptedValue.encryptOnSaveMap[a.id]){e.next=17;break}return e.next=16,EcEncryptedValue.toEncryptedValue(a);case 16:a=e.sent;case 17:return e.next=19,repo.saveTo(a);case 19:r.$store.commit("editor/framework",r.framework),e.next=25;break;case 22:e.prev=22,e.t0=e["catch"](5),appError(e.t0);case 25:i++,e.next=4;break;case 28:if(null==t["skos:narrower"]){e.next=44;break}i=0;case 30:if(!(i<t["skos:narrower"].length)){e.next=44;break}return e.prev=31,e.next=34,EcConcept.get(t["skos:narrower"][i]);case 34:c=e.sent,r.deleteConceptInner(c),e.next=41;break;case 38:e.prev=38,e.t1=e["catch"](31),appError(e.t1);case 41:i++,e.next=30;break;case 44:if(null==t["skos:topConceptOf"]){e.next=63;break}if(e.prev=45,o=this.framework["skos:hasTopConcept"].slice(),EcArray.setRemove(this.framework["skos:hasTopConcept"],t.shortId()),n.push({operation:"update",id:this.framework.shortId(),fieldChanged:["skos:hasTopConcept"],initialValue:[o]}),d=this.framework,d["schema:dateModified"]=(new Date).toISOString(),!0!==this.$store.state.editor.private||!0===EcEncryptedValue.encryptOnSaveMap[d.id]){e.next=55;break}return e.next=54,EcEncryptedValue.toEncryptedValue(d);case 54:d=e.sent;case 55:return e.next=57,repo.saveTo(d);case 57:r.$store.commit("editor/framework",r.framework),e.next=63;break;case 60:e.prev=60,e.t2=e["catch"](45),appError(e.t2);case 63:this.spitEvent("conceptDeleted",t.shortId(),"editFrameworkPage"),n.push({operation:"delete",obj:t}),repo.deleteRegistered(t,(function(){r.$store.commit("editor/framework",r.framework),r.$store.commit("editor/addEditsToUndo",JSON.parse(JSON.stringify(n))),n.splice(0,n.length)}),appError);case 66:case"end":return e.stop()}}),e,this,[[5,22],[31,38],[45,60]])})));function t(t){return e.apply(this,arguments)}return t}()}},p=l,h=(n("031c"),n("2877")),u=Object(h["a"])(p,i,a,!1,null,null,null);t["default"]=u.exports},"6ffa4":function(e,t,r){"use strict";r("fb6a"),r("14d9");var n=r("c7eb"),i=r("1da1"),a=r("872c");t["a"]={mixins:[a["a"]],methods:{removeObject:function(e){appLog("removing "+e.id);var t=this,r=this.$store.getters["editor/framework"],a=r.competency?r.competency.slice():null,s=r.relation?r.relation.slice():null,o=r.level?r.level.slice():null;r["schema:dateModified"]=(new Date).toISOString(),r.removeCompetency(e.shortId(),Object(i["a"])(Object(n["a"])().mark((function e(){var i;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=t.framework,t.$store.commit("editor/addEditsToUndo",[{operation:"update",id:i.shortId(),fieldChanged:["competency","relation","level"],initialValue:[a,s,o]}]),!0!==t.$store.state.editor.private||!0===EcEncryptedValue.encryptOnSaveMap[f.id]){e.next=6;break}return e.next=5,EcEncryptedValue.toEncryptedValue(i);case 5:i=e.sent;case 6:window.repo.saveTo(i,(function(){t.$store.commit("editor/framework",r)}),appError);case 7:case"end":return e.stop()}}),e)}))),appLog)},deleteObject:function(e){appLog("deleting "+e.id);var t=this,r=this.$store.getters["editor/framework"];if(e.shortId()===r.shortId())window.repo.deleteRegistered(r,(function(e){if(t.spitEvent("frameworkDeleted",r.shortId(),"editFrameworkSection"),null!=r.competency)for(var n=0;n<r.competency.length;n++)t.conditionalDelete(r.competency[n]);if(null!=r.relation)for(n=0;n<r.relation.length;n++)t.conditionalDelete(r.relation[n]);if(null!=r.level)for(n=0;n<r.level.length;n++)t.conditionalDelete(r.level[n]);t.$store.commit("editor/framework",null),t.importType?t.$store.commit("app/importFramework",null):t.$router.push({name:"frameworks"})}),appLog);else{var a=r.competency?r.competency.slice():null,s=r.relation?r.relation.slice():null,o=r.level?r.level.slice():null;this.$store.commit("editor/selectedCompetency",e),r["schema:dateModified"]=(new Date).toISOString(),r.removeCompetency(e.shortId(),Object(i["a"])(Object(n["a"])().mark((function i(){var c;return Object(n["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r.removeLevel(e.shortId()),t.$store.commit("editor/addEditsToUndo",[{operation:"delete",obj:e},{operation:"update",id:r.shortId(),fieldChanged:["competency","relation","level"],initialValue:[a,s,o],changedValue:[r.competency,r.relation,r.level]}]),t.conditionalDelete(e.shortId()),t.spitEvent("competencyDeleted",e.shortId(),"editFrameworkSection"),t.$store.commit("editor/selectedCompetency",null),c=r,!0!==t.$store.state.editor.private||!0===EcEncryptedValue.encryptOnSaveMap[r.id]){n.next=10;break}return n.next=9,EcEncryptedValue.toEncryptedValue(r);case 9:c=n.sent;case 10:window.repo.saveTo(c,(function(){t.$store.commit("editor/framework",r)}),appError);case 11:case"end":return n.stop()}}),i)}))),appLog)}}}}},ce3b:function(e,t,r){}}]);
//# sourceMappingURL=chunk-4f8e6938.96c22c9e.js.map