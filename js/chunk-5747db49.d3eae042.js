(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5747db49","chunk-83807946","chunk-83807946"],{"2f8b":function(t,e,s){},"4d343":function(t,e,s){"use strict";s.r(e);s("b64b");var a=function(){var t=this,e=t._self._c;return e("modal-template",{attrs:{active:!0,type:"primary"},on:{close:function(e){t.closeModal,t.$emit("close")}}},[e("template",{slot:"modal-header"},[e("span",{staticClass:"title has-text-white"},[t._v("Share Assertions")])]),t.isProcessing?e("template",{slot:"modal-body"},[e("h2",{staticClass:"header has-text-centered"},[t._v(" Processing request... ")]),e("div",{staticClass:"section has-background-white has-text-centered"},[e("span",{staticClass:"icon is-large"},[e("i",{staticClass:"fa fa-spinner fa-2x fa-pulse"})])])]):t.isDone?e("template",{slot:"modal-body"},[e("div",{staticClass:"section has-background-white has-text-centered"},[e("p",[e("strong",[t._v("Success!")])])])]):e("template",{slot:"modal-body"},[e("div",{staticClass:"assertion-share-container"},[e("div",{staticClass:"assertion-share-block"},[e("h4",{staticClass:"header is-size-3"},[t._v(" Share assertions about: ")]),e("div",{staticClass:"field"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.subjectFilter,expression:"subjectFilter"}],staticClass:"input",attrs:{"data-id":"share-assertions-subject-search",type:"text",placeholder:"search for person..."},domProps:{value:t.subjectFilter},on:{input:function(e){e.target.composing||(t.subjectFilter=e.target.value)}}})]),0===t.filteredAvailableSubjects.length&&""===t.subjectFilter?e("div",[e("i",{staticClass:"fa fa-info-circle"}),t._v(" No users found ")]):t._e(),t.filteredAvailableSubjects.length>0?e("div",[e("div",{staticClass:"table-container"},[e("table",{staticClass:"table is-hoverable is-fullwidth"},[e("thead",[e("tr",[e("th",{attrs:{title:"Select"}},[e("input",{attrs:{"data-id":"share-assertions-select-all-subjects",type:"checkbox"},on:{change:t.selectAllSubjects}})]),e("th",{attrs:{title:"Add as member"}},[e("i",{staticClass:"fa fa-user"})]),e("th",{attrs:{title:"Add as manager"}},[e("i",{staticClass:"fa fa-user-shield"})])])]),e("tbody",t._l(t.filteredAvailableSubjects,(function(s,a){return e("tr",{key:a,staticStyle:{cursor:"pointer"},attrs:{"data-id":"share-assertions-subject-option"},on:{click:function(e){return t.setSubject(s.owner[0])}}},[e("td",[e("input",{attrs:{type:"checkbox"},domProps:{checked:t.shareSubjects[s.owner[0]]},on:{click:function(e){return e.stopPropagation(),t.setSubject(s.owner[0])}}})]),e("td",[t._v(" "+t._s(s.getName())+" ")]),e("td",[t._v(" "+t._s(s.email)+" ")])])})),0)])])]):t._e()]),e("div",{staticClass:"assertion-share-icon"}),e("div",{staticClass:"assertion-share-block"},[e("h4",{staticClass:"header is-size-3"},[t._v(" Send to: ")]),e("div",{staticClass:"field"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.targetFilter,expression:"targetFilter"}],staticClass:"input",attrs:{"data-id":"share-assertions-target-search",type:"text",placeholder:"search for person..."},domProps:{value:t.targetFilter},on:{input:function(e){e.target.composing||(t.targetFilter=e.target.value)}}})]),0===t.filteredAvailableTargets.length&&""===t.targetFilter?e("div",[e("i",{staticClass:"fa fa-info-circle"}),t._v(" No users found ")]):t._e(),t.filteredAvailableTargets.length>0?e("div",[e("div",{staticClass:"table-container"},[e("table",{staticClass:"table is-hoverable is-fullwidth"},[e("thead",[e("tr",[e("th",{attrs:{title:"Select"}},[e("input",{attrs:{"data-id":"share-assertions-select-all-targets",type:"checkbox"},on:{change:t.selectAllTargets}})]),e("th",{attrs:{title:"Add as member"}},[e("i",{staticClass:"fa fa-user"})]),e("th",{attrs:{title:"Add as manager"}},[e("i",{staticClass:"fa fa-user-shield"})])])]),e("tbody",t._l(t.filteredAvailableTargets,(function(s,a){return e("tr",{key:a,staticStyle:{cursor:"pointer"},attrs:{"data-id":"share-assertions-target-option"},on:{click:function(e){return t.setTarget(s.owner[0])}}},[e("td",[e("input",{attrs:{type:"checkbox"},domProps:{checked:t.shareTargets[s.owner[0]]},on:{click:function(e){return e.stopPropagation(),t.setTarget(s.owner[0])}}})]),e("td",[t._v(" "+t._s(s.getName())+" ")]),e("td",[t._v(" "+t._s(s.email)+" ")])])})),0)])])]):t._e()])]),e("div",{staticClass:"assertion-share-count-container"},[e("div",{staticClass:"assertion-share-count"},[e("strong",[t._v(t._s(Object.keys(t.shareSubjects).length)+" selected")])]),e("div",{staticClass:"assertion-share-count"},[e("strong",[t._v(t._s(Object.keys(t.shareTargets).length)+" selected")])])])]),e("template",{slot:"modal-foot"},[e("div",{staticClass:"buttons is-spaced"},[e("button",{staticClass:"button is-secondary is-outlined",attrs:{disabled:t.isProcessing},on:{click:function(e){return t.$store.commit("app/closeModal")}}},[e("span",[t._v("Cancel")]),e("span",{staticClass:"icon"},[e("i",{staticClass:"fa fa-times-circle"})])]),t.isDone?e("button",{staticClass:"button is-primary is-outlined",attrs:{"data-id":"share-more-assertions-button"},on:{click:function(e){t.isDone=!1}}},[t._v(" Share More ")]):e("button",{staticClass:"button is-primary is-outlined",attrs:{"data-id":"share-assertions-button",disabled:t.isProcessing||t.notSelected},on:{click:t.shareAssertions}},[e("span",[t._v("Share")]),e("span",{staticClass:"icon"},[e("i",{staticClass:"fa fa-share"})])])])])],2)},r=[],i=s("2909"),n=s("b85c"),c=s("c7eb"),o=s("1da1"),l=(s("4de4"),s("d3b7"),s("ac1f"),s("841c"),s("99af"),s("14d9"),s("caad"),s("2532"),s("af07")),d={name:"ShareAssertionsModal",props:{isActive:Boolean},components:{ModalTemplate:l["a"]},data:function(){return{isProcessing:!1,shareSubjects:{},shareTargets:{},availablePersons:[],subjectFilter:"",targetFilter:"",isDone:!1}},computed:{filteredAvailableSubjects:function(){var t=this;return this.availablePersons.filter((function(e){return e.getName()&&e.getName().toLowerCase().indexOf(t.subjectFilter.toLowerCase())>-1||e.email&&e.email.toLowerCase().indexOf(t.subjectFilter.toLowerCase())>-1}))},filteredAvailableTargets:function(){var t=this,e=EcIdentityManager.default.ids[0].ppk.toPk().toPem();return this.availablePersons.filter((function(s){return e!==s.owner[0]&&(s.getName()&&s.getName().toLowerCase().indexOf(t.targetFilter.toLowerCase())>-1||s.email&&s.email.toLowerCase().indexOf(t.targetFilter.toLowerCase())>-1)}))},notSelected:function(){return 0===Object.keys(this.shareSubjects).length||0===Object.keys(this.shareTargets).length}},mounted:function(){var t=Object(o["a"])(Object(c["a"])().mark((function t(){var e=this;return Object(c["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:EcPerson.search(window.repo,"*",null,null,{size:1e4}).then((function(t){e.availablePersons=t}));case 1:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}(),methods:{selectAllSubjects:function(t){var e=t.target.checked;if(e){var s,a=Object(n["a"])(this.filteredAvailableSubjects);try{for(a.s();!(s=a.n()).done;){var r=s.value;this.$set(this.shareSubjects,r.owner[0],1)}}catch(i){a.e(i)}finally{a.f()}}else this.shareSubjects={}},selectAllTargets:function(t){var e=t.target.checked;if(e){var s,a=Object(n["a"])(this.filteredAvailableTargets);try{for(a.s();!(s=a.n()).done;){var r=s.value;this.$set(this.shareTargets,r.owner[0],1)}}catch(i){a.e(i)}finally{a.f()}}else this.shareTargets={}},setSubject:function(t){this.shareSubjects[t]?this.$delete(this.shareSubjects,t):this.$set(this.shareSubjects,t,1)},setTarget:function(t){this.shareTargets[t]?this.$delete(this.shareTargets,t):this.$set(this.shareTargets,t,1)},shareAssertions:function(){var t=this;this.isProcessing=!0;for(var e="",s=Object.keys(this.shareSubjects),a=0;a<s.length;a++)e+='\\*reader:"'.concat(s[a],'"'),a!==s.length-1&&(e+=" OR ");var r=function(){var t=Object(o["a"])(Object(c["a"])().mark((function t(s,a){var n=this;return Object(c["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,l){EcAssertion.search(window.repo,'\\*owner:"'.concat(n.$store.getters["editor/getMe"],'" AND (').concat(e,")"),function(){var e=Object(o["a"])(Object(c["a"])().mark((function e(n){var o;return Object(c["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if((o=assertions).push.apply(o,Object(i["a"])(n)),s+=a,!(n.length>0)){e.next=5;break}return e.next=5,r(s,a);case 5:t();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l,{size:a,start:s})})));case 1:case"end":return t.stop()}}),t)})));return function(e,s){return t.apply(this,arguments)}}();r(0,5e3).then((function(){var e=new EcAsyncHelper;e.each(assertions,(function(t,e){null!=t.assertionDateDecrypted?e():t.getAssertionDateAsync((function(s){t.assertionDateDecrypted=s,e()}),e)}),(function(e){var a=new EcAsyncHelper;a.each(e,(function(e,a){e.getSubjectAsync((function(r){s.includes(r.toPem())?e.getAgentAsync(function(){var s=Object(o["a"])(Object(c["a"])().mark((function s(r){var i,n,o;return Object(c["a"])().wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(t.$store.getters["editor/getMe"]!==r.toPem()){s.next=14;break}i=0,n=Object.keys(t.shareTargets);case 2:if(!(i<n.length)){s.next=9;break}return o=n[i],s.next=6,e.addReader(EcPk.fromPem(o));case 6:i++,s.next=2;break;case 9:return s.next=11,EcRepository.save(e);case 11:a(),s.next=15;break;case 14:a();case 15:case"end":return s.stop()}}),s)})));return function(t){return s.apply(this,arguments)}}(),appError):a()}),appError)}),(function(){t.isProcessing=!1,t.isDone=!0}))}))})).catch(appError)}},watch:{}},u=d,h=(s("c654"),s("2877")),f=Object(h["a"])(u,a,r,!1,null,null,null);e["default"]=f.exports},"840c":function(t,e,s){"use strict";s("2f8b")},"984b":function(t,e,s){},ae6d:function(t,e,s){},af07:function(t,e,s){"use strict";var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"modal cass-editor___modal",class:[{"is-active":t.active},"is-"+t.size,"cass-editor__modal--"+t.content],attrs:{id:"cass-modal"}},[e("div",{staticClass:"modal-background"}),e("div",{staticClass:"modal-card",class:"cass-editor__modal-card--"+t.size},[e("header",{staticClass:"modal-card-head is-size-4 has-text-weight-bold",class:["has-background-"+t.type,"has-text-"+t.fontColor]},[e("p",{staticClass:"modal-card-title"},[t._t("modal-header")],2),t.canClose?e("button",{staticClass:"delete",attrs:{"aria-label":"close"},on:{click:function(e){t.$store.commit("app/closeModal"),t.$emit("close")}}}):t._e()]),e("div",{staticClass:"modal-card-body has-text-dark"},[t._t("modal-body")],2),e("footer",{staticClass:"modal-card-foot has-background-white"},[t._t("modal-foot")],2)])])},r=[],i=(s("984b"),{name:"ModalTemplate",props:{canClose:{type:Boolean,default:!0},active:{type:Boolean,default:!1},type:{default:"primary",type:String},fontColor:{type:String,default:"white"},size:{type:String,default:"medium"},content:{defualt:"default",type:String}},data:function(){return{}},computed:{}}),n=i,c=(s("840c"),s("2877")),o=Object(c["a"])(n,a,r,!1,null,null,null);e["a"]=o.exports},c654:function(t,e,s){"use strict";s("ae6d")}}]);
//# sourceMappingURL=chunk-5747db49.d3eae042.js.map