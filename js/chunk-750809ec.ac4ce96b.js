(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-750809ec"],{"3ba8":function(t,e,r){"use strict";var n=r("a89b"),s=r.n(n);s.a},"6d79":function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));r("caad"),r("d3b7"),r("ac1f"),r("25f0"),r("2532"),r("841c");var n=r("54f8"),s={name:"cassUtil",data:function(){return{}},methods:{getOrganizationByEcPk:function(t,e,r){var s=t.toPem(),a={size:1e4};EcOrganization.search(window.repo,"",(function(t){var a,i=Object(n["a"])(t);try{for(i.s();!(a=i.n()).done;){var o=a.value;try{var c,d=o.getOrgKeys(),l=Object(n["a"])(d);try{for(l.s();!(c=l.n()).done;){var u=c.value;if(u&&u.toPk().toPem().equals(s))return void e(o)}}catch(h){l.e(h)}finally{l.f()}}catch(f){r(f.toString())}}}catch(h){i.e(h)}finally{i.f()}e(null)}),(function(t){r(t)}),a)},getOrganizationEcPk:function(t){try{return t.getCurrentOrgKey().toPk()}catch(e){return null}},getPersonEcPk:function(t){var e=this.generateProbablePersonFingerprintFromShortId(t.shortId());if(t.owner){var r,s=Object(n["a"])(t.owner);try{for(s.s();!(r=s.n()).done;){var a=r.value,i=EcPk.fromPem(a);if(e.equals(i.fingerprint()))return i}}catch(o){s.e(o)}finally{s.f()}}return null},addAllOwnersFromObjectToObject:function(t,e){if(t&&t.owner){var r,s=Object(n["a"])(t.owner);try{for(s.s();!(r=s.n()).done;){var a=r.value,i=EcPk.fromPem(a);e.addOwner(i)}}catch(o){s.e(o)}finally{s.f()}}},setDefaultBrowserConfigId:function(t){localStorage.setItem("cassAuthoringToolDefaultBrowserConfigId",t)},removeDefaultBrowserConfig:function(){localStorage.removeItem("cassAuthoringToolDefaultBrowserConfigId")},getDefaultBrowserConfigId:function(){return localStorage.getItem("cassAuthoringToolDefaultBrowserConfigId")},getBooleanValue:function(t){return"boolean"===typeof t?t:"string"===typeof t&&!!t.equalsIgnoreCase("true")},addAllIdentityPksAsOwners:function(t){if(EcIdentityManager&&EcIdentityManager.ids&&EcIdentityManager.ids.length>0)for(var e=0;e<EcIdentityManager.ids.length;e++)t.addOwner(EcIdentityManager.ids[e].ppk.toPk())},isObjectOwnerless:function(t){return!t.owner||0===t.owner.length},doesAnyIdentityOwnObject:function(t){if(!EcIdentityManager||!EcIdentityManager.ids||EcIdentityManager.ids.length<=0)return!1;for(var e=0;e<EcIdentityManager.ids.length;e++)if(t.hasOwner(EcIdentityManager.ids[e].ppk.toPk()))return!0;return!1},generateProbablePersonFingerprintFromShortId:function(t){return t.substring(t.lastIndexOf("/")+1)},isPersonIdAnObjectOwner:function(t,e){if(!e.owner||0===e.owner.length)return!1;var r,s=this.generateProbablePersonFingerprintFromShortId(t),a=Object(n["a"])(e.owner);try{for(a.s();!(r=a.n()).done;){var i=r.value,o=EcPk.fromPem(i).fingerprint();if(o.equals(s))return!0}}catch(c){a.e(c)}finally{a.f()}return!1},isPersonIdAnObjectReader:function(t,e){if(!e.reader||0===e.reader.length)return!1;var r,s=this.generateProbablePersonFingerprintFromShortId(t),a=Object(n["a"])(e.reader);try{for(a.s();!(r=a.n()).done;){var i=r.value,o=EcPk.fromPem(i).fingerprint();if(o.equals(s))return!0}}catch(c){a.e(c)}finally{a.f()}return!1},areAnyIdentitiesThisPerson:function(t){var e=t.getFingerprint();if(EcIdentityManager&&EcIdentityManager.ids&&EcIdentityManager.ids.length>0)for(var r=0;r<EcIdentityManager.ids.length;r++)if(EcIdentityManager.ids[r].ppk.toPk().fingerprint().equals(e))return!0;return!1},isPersonalIdentityAnObjectOwner:function(t){if(!t.owner||0===t.owner.length)return!1;var e=this.getPersonalIdentityPk().toPem();return t.owner.includes(e)},getPersonalIdentityPk:function(){return EcIdentityManager&&EcIdentityManager.ids&&EcIdentityManager.ids.length>0?EcIdentityManager.ids[0].ppk.toPk():null},buildEcAlignmentsFromRemoteLinkedData:function(t){var e,r=[],s=Object(n["a"])(t);try{for(s.s();!(e=s.n()).done;){var a=e.value,i=new EcAlignment;i.copyFrom(a),r.push(i)}}catch(o){s.e(o)}finally{s.f()}return r}},computed:{amLoggedIn:function(){return!!(EcIdentityManager&&EcIdentityManager.ids&&EcIdentityManager.ids.length>0)}}}},a89b:function(t,e,r){},e672:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"framework-editor-toolbar"}},[r("div",{staticClass:"container"},[r("div",{staticClass:"columns is-mobile"},[r("div",{staticClass:"column is-narrow"},[r("div",{staticClass:"buttons"},[r("div",{staticClass:"button is-text has-text-dark ",class:"primary"===t.activeView?"has-text-primary":"has-text-dark",attrs:{title:"View only primary properties"},on:{click:function(e){return t.changeProperties("primary")}}},[t._m(0),r("span",{staticClass:"is-hidden-touch"},[t._v(t._s(t.ceasnDataFields?"Low Detail":"Primary"))]),r("span",{staticClass:"is-hidden-desktop"},[t._v("1st")])]),r("div",{staticClass:"button is-text ",class:"secondary"===t.activeView?"has-text-primary":"has-text-dark",attrs:{title:"View primary and secondary properties"},on:{click:function(e){return t.changeProperties("secondary")}}},["primary"===t.activeView?r("span",{staticClass:"icon"},[r("i",{staticClass:"fas fa-square"})]):r("span",{staticClass:"icon"},[r("i",{staticClass:"fas fa-check-square"})]),r("span",{staticClass:"is-hidden-touch"},[t._v(t._s(t.ceasnDataFields?"Moderate Detail":"Secondary"))]),r("span",{staticClass:"is-hidden-desktop"},[t._v("2nd")])]),r("div",{staticClass:"button is-text ",class:"tertiary"===t.activeView?"has-text-primary":"has-text-dark",attrs:{title:"View all properties"},on:{click:function(e){return t.changeProperties("tertiary")}}},["tertiary"===t.activeView?r("span",{staticClass:"icon"},[r("i",{staticClass:"fas fa-check-square"})]):r("span",{staticClass:"icon"},[r("i",{staticClass:"fas fa-square"})]),r("span",{staticClass:"is-hidden-touch"},[t._v(t._s(t.ceasnDataFields?"High Detail":"Tertiary"))]),r("span",{staticClass:"is-hidden-desktop"},[t._v("3rd")])])])]),t._m(1),t.showAddComments||t.showViewComments?r("div",{staticClass:"column is-narrow"},[r("div",{staticClass:"buttons"},[t.showViewComments?r("div",{staticClass:"button is-text  has-text-dark",attrs:{title:"View all comments"},on:{click:function(e){return t.$store.commit("app/showRightAside","Comments")}}},[t._m(2)]):t._e()])]):t._e(),t.showAddComments||t.showViewComments?r("div",{staticClass:"column is-narrow"},[r("div",{staticClass:"vl"})]):t._e(),t.canEditFramework?r("div",{staticClass:"column is-narrow"},[r("div",{staticClass:"buttons"},[r("div",{staticClass:"button  is-text has-text-dark",attrs:{title:"Undo recent change"},on:{click:t.onClickUndo}},[t._m(3)])])]):t._e(),t.canEditFramework?r("div",{staticClass:"column is-narrow"},[r("div",{staticClass:"vl"})]):t._e(),t.canExport?r("div",{staticClass:"column is-narrow"},[r("div",{staticClass:"button is-text has-text-dark ",class:{"is-disabled":!t.canExport},attrs:{title:"Export framework"},on:{click:function(e){return t.handleExportClick()}}},[t._m(4)])]):r("div",{staticClass:"column is-narrow"},[r("div",{staticClass:"button is-text has-text-dark ",class:{"is-disabled":!t.canExport},attrs:{title:"Export unavailable",disabled:"true"}},[t._m(5)])]),t.showUserManagementIcon?r("div",{staticClass:"column is-narrow"},[t.loggedIn?r("div",{staticClass:"button is-text has-text-dark ",attrs:{title:"Manage users"},on:{click:function(e){t.showManageUsersModal(),t.showShareDropdown=!1}}},[t._m(6)]):t.shareEnabled?r("div",{staticClass:"button is-text has-text-dark ",attrs:{title:"Get shareable link"},on:{click:function(e){t.showManageUsersModal(),t.showShareDropdown=!1}}},[t._m(7)]):t._e()]):t._e(),t.configurationsEnabled?r("div",{staticClass:"column is-narrow"},[t.canEditFramework&&!t.conceptMode?r("div",{staticClass:"button  is-text has-text-dark is-pulled-right",attrs:{title:"Framework configuration"},on:{click:function(e){t.showManageConfigurationModal(),t.showShareDropdown=!1}}},[t._m(8),r("span",{staticClass:"is-hidden-touch"},[t._v(t._s(t.defaultFrameworkConfigName))])]):t._e()]):t._e(),t.directoryId?r("div",{staticClass:"column is-narrow",on:{click:t.goToDirectory}},[r("div",{staticClass:"button is-text has-text-dark"},[t._v(" Go to directory ")])]):t._e()])])])},s=[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("span",{staticClass:"icon"},[r("i",{staticClass:"fas fa-check-square"})])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"column is-narrow"},[r("div",{staticClass:"vl"})])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("span",{staticClass:"icon"},[r("i",{staticClass:"fas fa-comments"})])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("span",{staticClass:"icon"},[r("i",{staticClass:"fas fa-undo-alt "})])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("span",{staticClass:"icon"},[r("i",{staticClass:"fas fa-file-export"})])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("span",{staticClass:"icon"},[r("i",{staticClass:"fas fa-file-export"})])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("span",{staticClass:"icon"},[r("i",{staticClass:"fas fa-users"})])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("span",{staticClass:"icon"},[r("i",{staticClass:"fas fa-share"})])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("span",{staticClass:"icon"},[r("i",{staticClass:"fas fa-cog"})])}],a=(r("b0c0"),r("ac1f"),r("5319"),r("2ca0"),r("6d79")),i={name:"EditorToolbar",mixins:[a["a"]],props:{properties:{type:String,default:"primary"}},data:function(){return{showPropertyViewDropDown:!1,showShareDropdown:!1,activeView:"primary",repo:window.repo,editsFinishedCounter:0,totalEditsCounter:0,defaultFrameworkConfigName:null,privateFramework:!1}},methods:{closeViewDropDown:function(){this.showPropertyViewDropDown&&(this.showPropertyViewDropDown=!1)},closeShareDropDown:function(){this.showShareDropdown&&(this.showShareDropdown=!1)},handleExportClick:function(){this.canExport&&(this.$emit("show-export-modal"),this.showShareDropdown=!1)},handleClickAddComment:function(){this.$store.commit("editor/setAddCommentAboutId",this.$store.getters["editor/framework"].shortId()),this.$store.commit("editor/setAddCommentType","new"),this.$store.commit("app/showModal",{component:"AddComment"})},showExportModal:function(){this.$store.commit("app/showModal","Export")},showManageUsersModal:function(){this.$store.commit("app/showModal",{component:"Share"})},showManageConfigurationModal:function(){this.$store.commit("app/showModal",{component:"FrameworkConfiguration"})},changeProperties:function(t){var e=this.properties,r=t;"secondary"===r&&"secondary"===e?r="primary":"tertiary"===r&&"tertiary"===e&&(r="secondary"),this.$emit("change-properties",r),this.showPropertyViewDropDown=!1,this.activeView=r},onClickUndo:function(){var t=this;this.$Progress.start(),this.$store.dispatch("editor/lastEditToUndo").then((function(e){if(e){EcArray.isArray(e)||(e=[e]),t.totalEditsCounter+=e.length;for(var r=0;r<e.length;r++){var n=e[r].operation;"addNew"===n?t.undoAdd(e[r].id):"delete"===n?t.undoDelete(e[r].obj):"update"===n&&t.undoUpdate(e[r])}}t.$store.commit("editor/setLastEditToUndo",null)}))},undoAdd:function(t){var e=this;this.repo.deleteRegistered(EcRepository.getBlocking(t),(function(){e.editsFinishedCounter++}),(function(t){appLog(t),e.editsFinishedCounter++,e.$Progress.fail()}))},undoDelete:function(t){var e=t,r=this;"Concept"===t.type&&(e=new EcConcept,e.copyFrom(t)),this.repo.saveTo(e,(function(){r.editsFinishedCounter++,r.$Progress.finish()}),(function(t){appLog(t),r.editsFinishedCounter++,r.$Progress.fail()}))},undoUpdate:function(t){var e=this;EcRepository.get(t.id,(function(r){if(t.expandedProperty)return e.undoUpdateWithExpandedProperty(t,r);for(var n=0;n<t.fieldChanged.length;n++)r[t.fieldChanged[n]]=t.initialValue[n];e.repo.saveTo(r,(function(){e.editsFinishedCounter++,e.$Progress.finish()}),(function(){e.editsFinishedCounter++,e.$Progress.fail()})),e.$store.commit("editor/changedObject",r.shortId())}),(function(t){appError(t),e.editsFinishedCounter++,e.$Progress.fail()}))},undoUpdateWithExpandedProperty:function(t,e){var r=this;this.expand(e,(function(e){for(var n=0;n<t.fieldChanged.length;n++)e[t.fieldChanged[n]]=t.initialValue[n],0===e[t.fieldChanged[n]].length&&delete e[t.fieldChanged[n]],r.saveExpanded(e)}))},expand:function(t,e){var r=JSON.parse(t.toJson());null!=r["@context"]&&r["@context"].startsWith("http://")&&(r["@context"]=r["@context"].replace("http://","https://")),null!=r["@context"]&&-1!==r["@context"].indexOf("skos")&&(r["@context"]="https://schema.cassproject.org/0.4/skos/"),jsonld.expand(r,(function(t,r){e(null==t?r[0]:null)}))},saveExpanded:function(t){var e=this,r="https://schema.cassproject.org/0.4";-1!==t["@type"][0].toLowerCase().indexOf("concept")&&(r="https://schema.cassproject.org/0.4/skos"),jsonld.compact(t,this.$store.state.lode.rawSchemata[r],(function(t,n){if(null!=t&&appError(t),n){var s=new EcRemoteLinkedData;s.copyFrom(n),s.context=r,delete s["@context"],s=e.turnFieldsBackIntoArrays(s),s["schema:dateModified"]=(new Date).toISOString(),e.$store.state.editor&&!0===e.$store.state.editor.private&&!0!==EcEncryptedValue.encryptOnSaveMap[s.id]&&(s=EcEncryptedValue.toEncryptedValue(s)),e.repo.saveTo(s,(function(){e.editsFinishedCounter++}),(function(t){appError(t),e.editsFinishedCounter++}))}}))},turnFieldsBackIntoArrays:function(t){for(var e=["owner","reader","signature","competency","level","relation","skos:hasTopConcept","skos:narrower","skos:broader","skos:broadMatch","skos:closeMatch","skos:exactMatch","skos:narrowMatch","skos:related"],r=0;r<e.length;r++){var n=e[r];t[n]&&!EcArray.isArray(t[n])&&(t[n]=[t[n]])}return t},getConfigurationName:function(){if(this.$store.getters["editor/framework"].configuration){var t=EcRepository.getBlocking(this.$store.getters["editor/framework"].configuration);this.defaultFrameworkConfigName=t?t.name:"No configuration"}else this.defaultFrameworkConfigName="No configuration"},goToDirectory:function(){var t=this;EcDirectory.get(this.directoryId,(function(e){t.$store.commit("app/selectDirectory",e),t.$router.push({name:"directory"})}),appError)},checkIsPrivate:function(){var t=this.framework;delete EcRepository.cache[t.shortId()];var e=this;EcRepository.get(t.shortId(),(function(t){"EncryptedValue"===t.type?e.privateFramework=!0:e.privateFramework=!1}),(function(t){appError(t)}))}},computed:{showAddComments:function(){return!0!==this.$store.getters["editor/conceptMode"]&&this.$store.state.app.canAddComments},showViewComments:function(){return!0!==this.$store.getters["editor/conceptMode"]&&this.$store.state.app.canViewComments},framework:function(){return this.$store.state.editor.framework},queryParams:function(){return this.$store.getters["editor/queryParams"]},ceasnDataFields:function(){return"true"===this.queryParams.ceasnDataFields},canEditFramework:function(){return(!this.queryParams||"true"!==this.queryParams.view)&&!!this.framework.canEditAny(EcIdentityManager.getMyPks())},loggedIn:function(){return!!(EcIdentityManager.ids&&EcIdentityManager.ids.length>0)},configuration:function(){return this.$store.getters["editor/framework"].configuration},conceptMode:function(){return this.$store.getters["editor/conceptMode"]},canExport:function(){return!this.$store.state.editor.private&&(!(this.framework.reader&&this.framework.reader.length>0)&&!this.privateFramework)},configurationsEnabled:function(){return this.$store.state.featuresEnabled.configurationsEnabled},shareEnabled:function(){return this.$store.state.featuresEnabled.shareEnabled},userManagementEnabled:function(){return this.$store.state.featuresEnabled.userManagementEnabled},showUserManagementIcon:function(){return!(!this.shareEnabled&&!this.canEditFramework)&&!(!this.shareEnabled&&!this.userManagementEnabled)},directoryId:function(){return this.framework.directory}},watch:{editsFinishedCounter:function(){if(this.editsFinishedCounter&&this.editsFinishedCounter===this.totalEditsCounter){this.editsFinishedCounter=0,this.totalEditsCounter=0;var t=this.$store.getters["editor/framework"];this.$store.commit("editor/framework",EcRepository.getBlocking(t.shortId())),this.$store.commit("editor/recomputeHierarchy",!0),this.$store.commit("editor/refreshAlignments",!0)}},configuration:function(){this.getConfigurationName()}},mounted:function(){this.$store.getters["editor/setPropertyLevel"]&&(this.changeProperties(this.$store.getters["editor/setPropertyLevel"]),this.$store.commit("editor/setPropertyLevel",null)),this.checkIsPrivate(),this.getConfigurationName()}},o=i,c=(r("3ba8"),r("2877")),d=Object(c["a"])(o,n,s,!1,null,null,null);e["default"]=d.exports}}]);
//# sourceMappingURL=chunk-750809ec.ac4ce96b.js.map