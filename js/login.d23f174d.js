(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["login"],{"2b0ea":function(e,t,i){"use strict";var a=i("5672"),s=i.n(a);s.a},"2b89":function(e,t,i){"use strict";var a=i("85f1"),s=i.n(a);s.a},"50b5":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"section is-large",attrs:{id:"createAccount"}},[i("div",{staticClass:"modal",class:[{"is-active":e.createAccountBusy}]},[i("div",{staticClass:"modal-background"}),e._m(0)]),e.createAccountBusy||e.userCreated||e.createUserServerError?e._e():i("div",{staticClass:"modal is-active"},[i("div",{staticClass:"modal-card"},[e._m(1),i("section",{staticClass:"modal-card-body"},[i("div",{staticClass:"section"},[i("div",{staticClass:"field"},[i("div",{staticClass:"control"},[i("label",{staticClass:"label"},[e._v("first name")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.inputFirstName,expression:"inputFirstName"}],staticClass:"input",attrs:{type:"text "},domProps:{value:e.inputFirstName},on:{input:function(t){t.target.composing||(e.inputFirstName=t.target.value)}}})])]),i("div",{staticClass:"field"},[i("div",{staticClass:"control"},[i("label",{staticClass:"label"},[e._v("last name")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.inputLastName,expression:"inputLastName"}],staticClass:"input",attrs:{type:"text "},domProps:{value:e.inputLastName},on:{input:function(t){t.target.composing||(e.inputLastName=t.target.value)}}})])]),i("div",{staticClass:"field"},[i("div",{staticClass:"control"},[i("label",{staticClass:"label"},[e._v("email")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.inputEmail,expression:"inputEmail"}],staticClass:"input",attrs:{type:"text "},domProps:{value:e.inputEmail},on:{input:function(t){t.target.composing||(e.inputEmail=t.target.value)}}})])]),i("div",{staticClass:"field"},[i("div",{staticClass:"control"},[i("label",{staticClass:"label"},[e._v("username")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.inputUserName,expression:"inputUserName"}],staticClass:"input",attrs:{type:"text"},domProps:{value:e.inputUserName},on:{input:function(t){t.target.composing||(e.inputUserName=t.target.value)}}})])]),i("div",{staticClass:"field is-grouped"},[i("div",{staticClass:"control is-expanded"},[i("label",{staticClass:"label"},[e._v("password")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.inputPassword,expression:"inputPassword"}],staticClass:"input",attrs:{type:"password"},domProps:{value:e.inputPassword},on:{input:function(t){t.target.composing||(e.inputPassword=t.target.value)}}})]),i("div",{staticClass:"control is-expanded"},[i("label",{staticClass:"label"},[e._v("confirm password")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.inputPasswordConfirm,expression:"inputPasswordConfirm"}],staticClass:"input",attrs:{type:"password"},domProps:{value:e.inputPasswordConfirm},on:{input:function(t){t.target.composing||(e.inputPasswordConfirm=t.target.value)}}})])])]),e.createAccountInvalid?i("div",{staticClass:"field has-text-danger"},[i("div",{staticClass:"label has-text-danger"},[e._v(" Please correct the following errors: ")]),e.usernameInvalid?i("div",{staticClass:"is-size-6"},[e._v(" Username is required ")]):e._e(),e.passwordInvalid?i("div",{staticClass:"is-size-6"},[e._v(" Password is required ")]):e._e(),e.passwordMismatch?i("div",{staticClass:"is-size-6"},[e._v(" Passwords do not match ")]):e._e(),e.firstNameInvalid?i("div",{staticClass:"is-size-6"},[e._v(" First Name is required ")]):e._e(),e.lastNameInvalid?i("div",{staticClass:"is-size-6"},[e._v(" Last Name is required ")]):e._e(),e.emailInvalid?i("div",{staticClass:"is-size-6"},[e._v(" Valid email is required ")]):e._e(),e.emailUnavailable?i("div",{staticClass:"is-size-6"},[e._v(" That email is unavailable ")]):e._e(),e.usernameUnavailable?i("div",{staticClass:"is-size-6"},[e._v(" That username is unavailable ")]):e._e()]):e._e()]),i("footer",{staticClass:"modal-card-foot has-background-white"},[i("div",{staticClass:"buttons is-spaced"},[i("div",{staticClass:"button is-dark is-outlined",on:{click:e.goToLogin}},[e._m(2),i("span",[e._v("cancel")])]),i("div",{staticClass:"button is-dark is-primary",on:{click:e.attemptAccountCreate}},[e._m(3),i("span",[e._v("create")])])])])])]),!e.createAccountBusy&&e.userCreated?i("div",{staticClass:"modal is-active"},[i("div",{staticClass:"modal-card"},[e._m(4),e._m(5),i("footer",{staticClass:"modal-card-foot has-background-white"},[i("div",{staticClass:"buttons is-spaced"},[i("div",{staticClass:"button is-dark is-outlined",on:{click:e.goToLogin}},[e._m(6),i("span",[e._v("ok")])])])])])]):e._e(),!e.createAccountBusy&&e.createUserServerError?i("div",{staticClass:"modal is-active"},[i("div",{staticClass:"modal-card"},[e._m(7),e._m(8),i("footer",{staticClass:"modal-card-foot has-background-white"},[i("div",{staticClass:"buttons is-spaced"},[i("div",{staticClass:"button is-dark is-outlined",on:{click:e.goToLogin}},[e._m(9),i("span",[e._v("ok")])])])])])]):e._e()])},s=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"modal-content has-text-centered"},[i("span",{staticClass:"icon is-large has-text-center has-text-link"},[i("i",{staticClass:"fas fa-2x fa-spinner is-info fa-pulse"})])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("header",{staticClass:"modal-card-head has-text-centered has-background-primary"},[i("h3",{staticClass:"modal-card-title is-size-2 has-text-centered has-text-white"},[e._v(" Create CaSS Account ")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"icon"},[i("i",{staticClass:"fa fa-times"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"icon"},[i("i",{staticClass:"fa fa-sign-in-alt"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("header",{staticClass:"modal-card-head has-text-centered has-background-success"},[i("h3",{staticClass:"modal-card-title is-size-2 has-text-centered has-text-white"},[e._v(" Account Created ")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal-card-body"},[i("p",[e._v("Your account has been successfully created. Please return to the login screen.")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"icon"},[i("i",{staticClass:"fa fa-times"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("header",{staticClass:"modal-card-head has-text-centered has-background-danger"},[i("h3",{staticClass:"modal-card-title is-size-2 has-text-centered has-text-white"},[e._v(" Could Not Create Account ")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"modal-card-body"},[i("p",[e._v("There was an error when attempting to create your account. Please contact the system administrator.")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"icon"},[i("i",{staticClass:"fa fa-times"})])}],n=(i("498a"),i("54f8")),r=i("f3d2"),o={name:"CreateAccount",mixins:[r["a"]],data:function(){return{PERSON_SEARCH_SIZE:1e4,createAccountBusy:!1,createAccountInvalid:!1,inputFirstName:"",inputLastName:"",inputUserName:"",inputEmail:"",inputPassword:"",inputPasswordConfirm:"",usernameInvalid:!1,usernameUnavailable:!1,passwordInvalid:!1,passwordMismatch:!1,firstNameInvalid:!1,lastNameInvalid:!1,emailInvalid:!1,emailUnavailable:!1,ecRemoteIdentMgr:null,userCreated:!1,createUserServerError:!1}},methods:{setAllNewAccountValidationsChecksToValid:function(){this.createAccountInvalid=!1,this.usernameInvalid=!1,this.usernameUnavailable=!1,this.passwordInvalid=!1,this.passwordMismatch=!1,this.firstNameInvalid=!1,this.lastNameInvalid=!1,this.emailInvalid=!1,this.emailUnavailable=!1},isValidEmail:function(e){var t=/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/gim;return!!t.test(e)},validateNewAccountData:function(){this.inputUserName&&!this.inputUserName.trim().equals("")||(this.createAccountInvalid=!0,this.usernameInvalid=!0),!this.inputPassword||this.inputPassword.trim().equals("")||!this.inputPasswordConfirm||this.inputPasswordConfirm.trim().equals("")?(this.createAccountInvalid=!0,this.passwordInvalid=!0):this.inputPassword.equals(this.inputPasswordConfirm)||(this.createAccountInvalid=!0,this.passwordMismatch=!0),this.inputFirstName&&!this.inputFirstName.trim().equals("")||(this.createAccountInvalid=!0,this.firstNameInvalid=!0),this.inputLastName&&!this.inputLastName.trim().equals("")||(this.createAccountInvalid=!0,this.lastNameInvalid=!0),this.inputEmail&&!this.inputEmail.trim().equals("")&&this.isValidEmail(this.inputEmail)||(this.createAccountInvalid=!0,this.emailInvalid=!0)},checkCreateUserRequestStatus:function(e){409===e.status?(this.createAccountInvalid=!0,this.usernameUnavailable=!0,this.createUserServerError=!1,this.userCreated=!1):503===e.status?(this.createUserServerError=!0,this.userCreated=!1):200===e.status?(this.createUserServerError=!1,this.userCreated=!0):appLog("Unexpected create user response status: "+e.status),this.createAccountBusy=!1},buildUserInfoObject:function(){var e={};return e.firstName=this.inputFirstName,e.lastName=this.inputLastName,e.username=this.inputUserName,e.password=this.inputPassword,e.email=this.inputEmail,e},performAccountCreation:function(){this.performCreateUser(this.buildUserInfoObject(),this.checkCreateUserRequestStatus)},handleCheckUsernameFetchIdentitySuccess:function(e){this.createAccountInvalid=!0,this.usernameUnavailable=!0,this.createAccountBusy=!1,EcIdentityManager.clearIdentities(),EcIdentityManager.clearContacts()},handleCheckUsernameFetchIdentityFailure:function(e){e&&e.toLowerCase().trim().equals("user does not exist.")?this.performAccountCreation():(this.createAccountInvalid=!0,this.usernameUnavailable=!0,this.createAccountBusy=!1,EcIdentityManager.clearIdentities(),EcIdentityManager.clearContacts())},handleCheckUsernameConfigureFromServerSuccess:function(e){appLog("Fetching identity for username check..."),this.ecRemoteIdentMgr.startLogin(this.inputUserName,this.inputPassword),this.ecRemoteIdentMgr.fetch(this.handleCheckUsernameFetchIdentitySuccess,this.handleCheckUsernameFetchIdentityFailure)},handleCheckUsernameConfigureFromServerFail:function(e){this.createAccountBusy=!1,appLog("New account configure from server for username check failure: "+msg)},checkForExistingUsername:function(){appLog("Check if new account username already exists"),this.ecRemoteIdentMgr=new EcRemoteIdentityManager,this.ecRemoteIdentMgr.server=window.repo.selectedServer,this.ecRemoteIdentMgr.configureFromServer(this.handleCheckUsernameConfigureFromServerSuccess,this.handleCheckUsernameConfigureFromServerFail)},searchPersonsForNewAccountSuccess:function(e){appLog("New account person search success: "),appLog(e);var t,i=!1,a=Object(n["a"])(e);try{for(a.s();!(t=a.n()).done;){var s=t.value,r=new EcPerson;if(r.copyFrom(s),this.inputEmail.equalsIgnoreCase(r.email)){i=!0;break}}}catch(o){a.e(o)}finally{a.f()}i?(this.createAccountInvalid=!0,this.emailUnavailable=!0,this.createAccountBusy=!1):this.checkForExistingUsername()},searchPersonsForNewAccountFailure:function(e){this.checkForExistingUsername()},verifyEmailAddressForNewAccountAndGo:function(){this.createAccountBusy=!0;var e={};e.size=this.PERSON_SEARCH_SIZE,window.repo.searchWithParams('@type:Person AND email:"'+this.inputEmail+'"',e,null,this.searchPersonsForNewAccountSuccess,this.searchPersonsForNewAccountFailure)},attemptAccountCreate:function(){this.setAllNewAccountValidationsChecksToValid(),this.validateNewAccountData(),this.createAccountInvalid||this.verifyEmailAddressForNewAccountAndGo()},goToLogin:function(){this.createAccountBusy=!1,this.$router.push({path:"/login"})}},mounted:function(){}},c=o,l=(i("2b0ea"),i("2877")),d=Object(l["a"])(c,a,s,!1,null,"52a40bfd",null);t["default"]=d.exports},5672:function(e,t,i){},"85f1":function(e,t,i){},"9db1":function(e,t,i){"use strict";var a=i("eeb4"),s=i.n(a);s.a},d492:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"section is-large",attrs:{id:"login"}},[i("div",{staticClass:"modal",class:[{"is-active":e.loginBusy}]},[i("div",{staticClass:"modal-background"}),e._m(0)]),e.loginBusy?e._e():i("div",{staticClass:"modal is-active"},[i("div",{staticClass:"modal-card"},[e.loginBusy?e._e():i("header",{staticClass:"modal-card-head has-text-centered has-background-primary"},[e.amJustLoggingIn?i("h3",{staticClass:"modal-card-title is-size-2 has-text-centered has-text-white"},[e._v(" Login to CaSS Authoring Tool ")]):e._e(),e.amCreatingAccount?i("h3",{staticClass:"modal-card-title is-size-2 has-text-centered has-text-white"},[e._v(" Create CaSS Authoring Tool User ")]):e._e(),e.amCreatingLinkedPerson?i("h4",{staticClass:"title is-size-2 has-text-centered has-text-white"},[e._v(" Link User Information ")]):e._e()]),i("section",{staticClass:"modal-card-body"},[e.amCreatingAccount||e.amCreatingLinkedPerson?i("div",{staticClass:"section"},[e.amCreatingLinkedPerson?i("p",[e._v(" No matching user record could be found that matched your login information. Please provide the following: ")]):e._e()]):e._e(),e.amJustLoggingIn?i("div",{staticClass:"section"},[i("div",{staticClass:"field"},[i("div",{staticClass:"control"},[i("label",{staticClass:"label"},[e._v("Username")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],staticClass:"input",attrs:{type:"text",placeholder:"username"},domProps:{value:e.username},on:{input:function(t){t.target.composing||(e.username=t.target.value)}}})])]),i("div",{staticClass:"field"},[i("div",{staticClass:"control"},[i("label",{staticClass:"label"},[e._v("Password")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:"input",attrs:{type:"password",placeholder:"password"},domProps:{value:e.password},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.attemptCassLogin(t)},input:function(t){t.target.composing||(e.password=t.target.value)}}})])])]):e._e(),i("div",{staticClass:"section"},[e.amCreatingAccount||e.amCreatingLinkedPerson?i("div",{staticClass:"field"},[i("div",{staticClass:"control"},[i("label",{staticClass:"label"},[e._v("name")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.createLinkPersonName,expression:"createLinkPersonName"}],staticClass:"input",attrs:{type:"text "},domProps:{value:e.createLinkPersonName},on:{input:function(t){t.target.composing||(e.createLinkPersonName=t.target.value)}}})])]):e._e(),e.amCreatingAccount||e.amCreatingLinkedPerson?i("div",{staticClass:"field"},[i("div",{staticClass:"control"},[i("label",{staticClass:"label"},[e._v("email")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.createLinkPersonEmail,expression:"createLinkPersonEmail"}],staticClass:"input",attrs:{type:"text "},domProps:{value:e.createLinkPersonEmail},on:{input:function(t){t.target.composing||(e.createLinkPersonEmail=t.target.value)}}})])]):e._e(),e.amCreatingAccount?i("div",{staticClass:"field"},[i("div",{staticClass:"control"},[i("label",{staticClass:"label"},[e._v("username")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.createAccountUsername,expression:"createAccountUsername"}],staticClass:"input",attrs:{type:"text"},domProps:{value:e.createAccountUsername},on:{input:function(t){t.target.composing||(e.createAccountUsername=t.target.value)}}})])]):e._e(),e.amCreatingAccount?i("div",{staticClass:"field is-grouped"},[i("div",{staticClass:"control is-expanded"},[i("label",{staticClass:"label"},[e._v("password")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.createAccountPassword,expression:"createAccountPassword"}],staticClass:"input",attrs:{type:"password"},domProps:{value:e.createAccountPassword},on:{input:function(t){t.target.composing||(e.createAccountPassword=t.target.value)}}})]),i("div",{staticClass:"control is-expanded"},[i("label",{staticClass:"label"},[e._v("Confirm password")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.createAccountPasswordRetype,expression:"createAccountPasswordRetype"}],staticClass:"input",attrs:{type:"password"},domProps:{value:e.createAccountPasswordRetype},on:{input:function(t){t.target.composing||(e.createAccountPasswordRetype=t.target.value)}}})])]):e._e()]),e.createAccountOrLinkPersonDataInvalid?i("div",{staticClass:"field has-text-danger"},[i("div",{staticClass:"label has-text-danger"},[e._v(" Please correct the following errors: ")]),e.createAccountUsernameInvalid?i("div",{staticClass:"is-size-6"},[e._v(" Username is required ")]):e._e(),e.createAccountPasswordInvalid?i("div",{staticClass:"is-size-6"},[e._v(" Password is required ")]):e._e(),e.createAccountPasswordMismatch?i("div",{staticClass:"is-size-6"},[e._v(" Passwords do not match ")]):e._e(),e.createLinkPersonNameInvalid?i("div",{staticClass:"is-size-6"},[e._v(" Name is required ")]):e._e(),e.createLinkPersonEmailInvalid?i("div",{staticClass:"is-size-6"},[e._v(" Valid email is required ")]):e._e(),e.createLinkPersonEmailExists?i("div",{staticClass:"is-size-6"},[e._v(" That email is already in use ")]):e._e(),e.createAccountUsernameUnavailable?i("div",{staticClass:"is-size-6"},[e._v(" That username is unavailable ")]):e._e()]):e._e(),e.identityFetchFailed||e.configRetrieveFailed||e.loginParamsInvalid?i("div",{staticClass:"section"},[e.identityFetchFailed?i("div",[i("p",[i("b",[e._v("Login failed: "+e._s(e.identityFailMsg))])])]):e._e(),e.configRetrieveFailed?i("div",[i("p",[i("b",[e._v("Could not retrieve configuration from selected server: "+e._s(e.configFailMsg))])])]):e._e(),e.loginParamsInvalid?i("div",[e._m(1)]):e._e()]):e._e()]),i("footer",{staticClass:"modal-card-foot has-background-white"},[i("div",{staticClass:"buttons is-spaced"},[e.amCreatingLinkedPerson||e.amCreatingAccount?i("div",{staticClass:"button is-dark is-outlined",on:{click:function(t){return e.setDataToBaseLogin(!0)}}},[e._m(2),i("span",[e._v("cancel")])]):e._e(),e.amJustLoggingIn?[e.apiLoginEnabled?e._e():i("div",{staticClass:"button is-outlined is-dark",on:{click:e.showCreateAccount}},[e._m(3),i("span",[e._v("create account")])]),i("div",{staticClass:"button is-outlined is-primary",on:{click:e.attemptCassLogin}},[e._m(4),i("span",[e._v("login")])])]:e._e(),e.amCreatingAccount?i("div",{staticClass:"button is-expanded is-primary is-outlined",on:{click:e.createNewAccount}},[e._m(5),i("span",[e._v("create")])]):e._e(),e.amCreatingLinkedPerson?i("div",{staticClass:"button is-success is-outlined",on:{click:e.linkPerson}},[e._m(6),i("span",[e._v("update")])]):e._e()],2)]),e.apiLoginEnabled?i("div",{staticClass:"has-text-centered"},[i("a",{on:{click:e.goToStandardLogin}},[e._v("Return to Standard Login")])]):e._e()])])])},s=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"modal-content has-text-centered"},[i("span",{staticClass:"icon is-large has-text-center has-text-link"},[i("i",{staticClass:"fas fa-2x fa-spinner is-info fa-pulse"})])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("p",[i("b",[e._v("Login failed: Invalid Username/Password")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"icon"},[i("i",{staticClass:"fa fa-times"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"icon"},[i("i",{staticClass:"fa fa-plus"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"icon"},[i("i",{staticClass:"fa fa-sign-in-alt"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"icon"},[i("i",{staticClass:"fa fa-sign-in-alt"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"icon"},[i("i",{staticClass:"fa fa-sign-in-alt"})])}],n=(i("b0c0"),i("ac1f"),i("841c"),i("498a"),i("54f8")),r={name:"LegacyLogin",data:function(){return{GROUP_SEARCH_SIZE:1e4,PERSON_SEARCH_SIZE:1e4,username:"",password:"",createAccountUsername:"",createAccountPassword:"",createAccountPasswordRetype:"",createLinkPersonName:"",createLinkPersonEmail:"",loginParamsInvalid:!1,identityFetchFailed:!1,configRetrieveFailed:!1,loginBusy:!1,ecRemoteIdentMgr:{},configFailMsg:"",identityFailMsg:"",amJustLoggingIn:!0,amCreatingAccount:!1,amCreatingLinkedPerson:!1,createAccountOrLinkPersonDataInvalid:!1,createAccountUsernameInvalid:!1,createAccountPasswordInvalid:!1,createAccountPasswordMismatch:!1,createLinkPersonNameInvalid:!1,createLinkPersonEmailInvalid:!1,createLinkPersonEmailExists:!1,createAccountUsernameUnavailable:!1,identityToLinkToPerson:{},linkedPerson:{}}},methods:{goToStandardLogin:function(){this.loginBusy=!1,this.$router.push({path:"/login"})},goToAppHome:function(){this.loginBusy=!1,this.$router.push({path:"/frameworks"})},addGroupIdentity:function(e){try{var t=e.getOrgKeys();appLog("Adding group identities: ("+e.shortId()+") - "+e.getName()+" - ("+t.length+") keys");for(var i=0;i<t.length;i++){var a=t[i],s=new EcIdentity;s.displayName=e.getName()+" - key["+i+"]",s.ppk=a,EcIdentityManager.addIdentityQuietly(s)}}catch(n){}},searchRepositoryForGroupsSuccess:function(e){var t=this.linkedPerson.shortId();if(e&&e.length>0){var i,a=Object(n["a"])(e);try{for(a.s();!(i=a.n()).done;){var s=i.value;if(s.employee&&s.employee.length>0){var r,o=Object(n["a"])(s.employee);try{for(o.s();!(r=o.n()).done;){var c=r.value;if(c.equals(t)){this.addGroupIdentity(s);break}}}catch(l){o.e(l)}finally{o.f()}}}}catch(l){a.e(l)}finally{a.f()}}},searchRepositoryForGroupsFailure:function(e){appLog("Group search failure: "+e),this.goToAppHome()},addGroupIdentities:function(){appLog(" Adding group identities...");var e={};e.size=this.GROUP_SEARCH_SIZE,EcOrganization.search(window.repo,"",this.searchRepositoryForGroupsSuccess,this.searchRepositoryForGroupsFailure,e),this.goToAppHome()},setDataToBaseLogin:function(e){this.username="",this.password="",this.createAccountUsername="",this.createAccountPassword="",this.createAccountPasswordRetype="",this.createLinkPersonName="",this.createLinkPersonEmail="",this.loginParamsInvalid=!1,this.identityFetchFailed=!1,this.configRetrieveFailed=!1,this.configFailMsg="",this.identityFailMsg="",this.amCreatingAccount=!1,this.amCreatingLinkedPerson=!1,this.createAccountOrLinkPersonDataInvalid=!1,this.createAccountUsernameInvalid=!1,this.createAccountPasswordInvalid=!1,this.createAccountPasswordMismatch=!1,this.createLinkPersonNameInvalid=!1,this.createLinkPersonEmailInvalid=!1,this.createLinkPersonEmailExists=!1,this.createAccountUsernameUnavailable=!1,e&&(this.ecRemoteIdentMgr={},EcIdentityManager.clearContacts(),EcIdentityManager.clearIdentities(),this.identityToLinkToPerson={},this.linkedPerson={}),this.amJustLoggingIn=!0,this.loginBusy=!1},showCreateAccount:function(){this.setDataToBaseLogin(!0),this.amJustLoggingIn=!1,this.amCreatingAccount=!0},showCreateLinkedPerson:function(){this.setDataToBaseLogin(!1),this.amJustLoggingIn=!1,this.amCreatingLinkedPerson=!0},setAllNewAccountValidationsChecksToValid:function(){this.createAccountOrLinkPersonDataInvalid=!1,this.createAccountUsernameInvalid=!1,this.createAccountPasswordInvalid=!1,this.createAccountPasswordMismatch=!1,this.createLinkPersonNameInvalid=!1,this.createLinkPersonEmailInvalid=!1,this.createLinkPersonEmailExists=!1,this.createAccountUsernameUnavailable=!1},isValidEmail:function(e){var t=/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/gim;return!!t.test(e)},validateNewAccountData:function(){this.createAccountUsername&&!this.createAccountUsername.trim().equals("")||(this.createAccountOrLinkPersonDataInvalid=!0,this.createAccountUsernameInvalid=!0),!this.createAccountPassword||this.createAccountPassword.trim().equals("")||!this.createAccountPasswordRetype||this.createAccountPasswordRetype.trim().equals("")?(this.createAccountOrLinkPersonDataInvalid=!0,this.createAccountPasswordInvalid=!0):this.createAccountPassword.equals(this.createAccountPasswordRetype)||(this.createAccountOrLinkPersonDataInvalid=!0,this.createAccountPasswordMismatch=!0),this.validateLinkPersonData()},handleCreatePersonSuccess:function(){appLog("Person created."),this.amCreatingAccount?this.goToAppHome():this.addGroupIdentities()},createPersonObjectToLinkToIdentity:function(){appLog("Creating person object for identity...");var e=new Person;e.assignId(window.repo.selectedServer,this.identityToLinkToPerson.ppk.toPk().fingerprint()),e.addOwner(this.identityToLinkToPerson.ppk.toPk()),e.name=this.createLinkPersonName,e.email=this.createLinkPersonEmail,appLog(e),this.$store.commit("user/loggedOnPerson",e),this.linkedPerson=e,EcRepository.save(e,this.handleCreatePersonSuccess,this.handleAttemptLoginFetchIdentityFailure)},handleCreateAccountFetchIdentitySuccess:function(){appLog("Creating new account identity object...");var e=new EcIdentity;e.displayName=this.createLinkPersonName,e.ppk=EcPpk.generateKey(),EcIdentityManager.addIdentity(e),EcIdentityManager.saveContacts(),EcIdentityManager.saveIdentities(),this.identityToLinkToPerson=e,this.ecRemoteIdentMgr.commit(this.createPersonObjectToLinkToIdentity,this.handleAttemptLoginFetchIdentityFailure)},handleCreateAccountRemoteIdentityMgrCreateSuccess:function(){appLog("Creating new account manager fetch..."),this.ecRemoteIdentMgr.fetch(this.handleCreateAccountFetchIdentitySuccess,this.handleAttemptLoginFetchIdentityFailure)},handleCreateAccountConfigureFromServerSuccess:function(e){appLog("EcRemoteIdentityManager creating..."),appLog("Creating new account login..."),this.ecRemoteIdentMgr.startLogin(this.createAccountUsername,this.createAccountPassword),this.ecRemoteIdentMgr.create(this.handleCreateAccountRemoteIdentityMgrCreateSuccess,this.handleAttemptLoginFetchIdentityFailure)},createNewAccountIdentityAndPerson:function(){appLog("Creating new account..."),appLog("EcRemoteIdentityManager Configuring from server..."),this.ecRemoteIdentMgr=new EcRemoteIdentityManager,this.ecRemoteIdentMgr.server=window.repo.selectedServer,this.ecRemoteIdentMgr.configureFromServer(this.handleCreateAccountConfigureFromServerSuccess,this.handleAttemptLoginConfigureFromServerFail)},handleCheckUsernameFetchIdentitySuccess:function(e){appLog("handleCheckUsernameFetchIdentitySuccess !!!!"),this.createAccountOrLinkPersonDataInvalid=!0,this.createAccountUsernameUnavailable=!0,this.loginBusy=!1,EcIdentityManager.clearIdentities(),EcIdentityManager.clearContacts()},handleCheckUsernameFetchIdentityFailure:function(e){appLog("handleCheckUsernameFetchIdentityFailure: "+e),e&&e.toLowerCase().trim().equals("user does not exist.")?this.createNewAccountIdentityAndPerson():(this.createAccountOrLinkPersonDataInvalid=!0,this.createAccountUsernameUnavailable=!0,this.loginBusy=!1,EcIdentityManager.clearIdentities(),EcIdentityManager.clearContacts())},handleCheckUsernameConfigureFromServerSuccess:function(e){appLog("Fetching identity for username check..."),this.ecRemoteIdentMgr.startLogin(this.createAccountUsername,this.createAccountPassword),this.ecRemoteIdentMgr.fetch(this.handleCheckUsernameFetchIdentitySuccess,this.handleCheckUsernameFetchIdentityFailure)},handleCheckUsernameConfigureFromServerFail:function(e){this.loginBusy=!1,appLog("New account configure from server for username check failure: "+msg)},checkForExistingUsername:function(){appLog("Check if new account username already exists"),this.ecRemoteIdentMgr=new EcRemoteIdentityManager,this.ecRemoteIdentMgr.server=window.repo.selectedServer,this.ecRemoteIdentMgr.configureFromServer(this.handleCheckUsernameConfigureFromServerSuccess,this.handleCheckUsernameConfigureFromServerFail)},searchPersonsForNewAccountSuccess:function(e){appLog("New account person search success: "),appLog(e);var t,i=!1,a=Object(n["a"])(e);try{for(a.s();!(t=a.n()).done;){var s=t.value,r=new EcPerson;if(r.copyFrom(s),this.createLinkPersonEmail.equalsIgnoreCase(r.email)){i=!0;break}}}catch(o){a.e(o)}finally{a.f()}i?(this.createAccountOrLinkPersonDataInvalid=!0,this.createLinkPersonEmailExists=!0,this.loginBusy=!1):this.checkForExistingUsername()},searchPersonsForNewAccountFailure:function(e){this.checkForExistingUsername()},verifyEmailAddressForNewAccountAndGo:function(){this.loginBusy=!0;var e={};e.size=this.PERSON_SEARCH_SIZE,window.repo.searchWithParams('@type:Person AND email:"'+this.createLinkPersonEmail+'"',e,null,this.searchPersonsForNewAccountSuccess,this.searchPersonsForNewAccountFailure)},createNewAccount:function(){this.setAllNewAccountValidationsChecksToValid(),this.validateNewAccountData(),this.createAccountOrLinkPersonDataInvalid||this.verifyEmailAddressForNewAccountAndGo()},validateLinkPersonData:function(){this.createLinkPersonName&&!this.createLinkPersonName.trim().equals("")||(this.createAccountOrLinkPersonDataInvalid=!0,this.createLinkPersonNameInvalid=!0),this.createLinkPersonEmail&&!this.createLinkPersonEmail.trim().equals("")&&this.isValidEmail(this.createLinkPersonEmail)||(this.createAccountOrLinkPersonDataInvalid=!0,this.createLinkPersonEmailInvalid=!0)},searchPersonsForLinkPersonSuccess:function(e){this.loginBusy=!0;var t,i=!1,a=Object(n["a"])(e);try{for(a.s();!(t=a.n()).done;){var s=t.value,r=new EcPerson;if(r.copyFrom(s),this.createLinkPersonEmail.equalsIgnoreCase(r.email)){i=!0;break}}}catch(o){a.e(o)}finally{a.f()}i?(this.createAccountOrLinkPersonDataInvalid=!0,this.createLinkPersonEmailExists=!0,this.loginBusy=!1):this.createPersonObjectToLinkToIdentity()},verifyEmailAddressForLinkPersonAndGo:function(){appLog("Validating link person email...");var e={};e.size=this.PERSON_SEARCH_SIZE,window.repo.searchWithParams('@type:Person AND email:"'+this.createLinkPersonEmail+'"',e,null,this.searchPersonsForLinkPersonSuccess,this.searchPersonsForNewAccountFailure)},linkPerson:function(){this.setAllNewAccountValidationsChecksToValid(),this.validateLinkPersonData(),this.createAccountOrLinkPersonDataInvalid||this.verifyEmailAddressForLinkPersonAndGo()},areLoginParamsValid:function(){return null!=this.username&&0!==this.username.length&&null!=this.password&&0!==this.password.length||(this.loginParamsInvalid=!0,!1)},findLinkedPersonPersonSearchSuccess:function(e){appLog("Linked person person search success: "),appLog(e),this.identityToLinkToPerson=EcIdentityManager.ids[0];var t,i=!1,a=Object(n["a"])(e);try{for(a.s();!(t=a.n()).done;){var s=t.value,r=new EcPerson;r.copyFrom(s),r.getGuid().equals(this.identityToLinkToPerson.ppk.toPk().fingerprint())&&(i=!0,this.$store.commit("user/loggedOnPerson",r),this.linkedPerson=r,appLog("Matching person record found: "),appLog(r),EcIdentityManager.saveContacts(),EcIdentityManager.saveIdentities())}}catch(o){a.e(o)}finally{a.f()}i?this.addGroupIdentities():(appLog("Matching person record NOT found"),this.showCreateLinkedPerson())},findLinkedPersonPersonSearchFailure:function(e){this.loginBusy=!1,appLog("Linked person person search failure: "+e)},findLinkedPersonForIdentity:function(){appLog("Finding linked person for identity...");var e=EcIdentityManager.ids[0].ppk.toPk().fingerprint(),t={};t.size=this.PERSON_SEARCH_SIZE,window.repo.searchWithParams('@type:Person AND @id:"'+e+'"',t,null,this.findLinkedPersonPersonSearchSuccess,this.findLinkedPersonPersonSearchFailure)},handleAttemptLoginFetchIdentitySuccess:function(e){!EcIdentityManager.ids||EcIdentityManager.ids.length<=0?this.handleAttemptLoginFetchIdentityFailure("Login credentials valid but no identity could be found."):this.findLinkedPersonForIdentity()},handleAttemptLoginFetchIdentityFailure:function(e){this.identityFailMsg=e,this.identityFetchFailed=!0,this.loginBusy=!1},handleAttemptLoginConfigureFromServerSuccess:function(e){appLog("Fetching identity..."),this.ecRemoteIdentMgr.startLogin(this.username,this.password),this.ecRemoteIdentMgr.fetch(this.handleAttemptLoginFetchIdentitySuccess,this.handleAttemptLoginFetchIdentityFailure)},handleAttemptLoginConfigureFromServerFail:function(e){this.configFailMsg=e,this.configRetrieveFailed=!0,this.loginBusy=!1},attemptCassLogin:function(){this.loginParamsInvalid=!1,this.identityFetchFailed=!1,this.configRetrieveFailed=!1,this.areLoginParamsValid()&&(appLog("Attempting CaSS login...."),this.loginBusy=!0,EcIdentityManager.clearContacts(),EcIdentityManager.clearIdentities(),this.ecRemoteIdentMgr=new EcRemoteIdentityManager,this.ecRemoteIdentMgr.server=window.repo.selectedServer,this.ecRemoteIdentMgr.configureFromServer(this.handleAttemptLoginConfigureFromServerSuccess,this.handleAttemptLoginConfigureFromServerFail))}},computed:{legacyLoginEnabled:function(){return this.$store.getters["featuresEnabled/legacyLoginEnabled"]},apiLoginEnabled:function(){return this.$store.getters["featuresEnabled/apiLoginEnabled"]}},mounted:function(){this.setDataToBaseLogin(!0)}},o=r,c=(i("9db1"),i("2877")),l=Object(c["a"])(o,a,s,!1,null,"dcaf5126",null);t["default"]=l.exports},ede4:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"section is-large",attrs:{id:"login"}},[i("div",{staticClass:"modal",class:[{"is-active":e.loginBusy}]},[i("div",{staticClass:"modal-background"}),e._m(0)]),e.loginBusy?e._e():i("div",{staticClass:"modal is-active"},[i("div",{staticClass:"modal-card"},[e.loginBusy?e._e():i("header",{staticClass:"modal-card-head has-text-centered has-background-primary"},[i("h3",{staticClass:"modal-card-title is-size-2 has-text-centered has-text-white"},[e._v(" Login to CaSS ")])]),i("section",{staticClass:"modal-card-body"},[i("div",{staticClass:"columns is-mobile is-multiline"},[i("div",{staticClass:"column is-6"},[i("div",{staticClass:"section box py-2 px-2"},[i("div",{staticClass:"modal-card-body has-text-centered"},[i("div",{staticClass:"button is-outlined is-primary",on:{click:e.attemptExternalCassLogin}},[e._m(1),i("span",[e._v("login")])])])])]),i("div",{staticClass:"column is-6"},[i("div",{staticClass:"section box py-2 px-2"},[i("div",{staticClass:"modal-card-body has-text-centered"},[i("div",{staticClass:"button is-outlined is-dark",on:{click:e.goToCreateAccount}},[e._m(2),i("span",[e._v("create account")])])])])]),e.identityFetchFailed||e.configRetrieveFailed||e.loginParamsInvalid?i("div",{staticClass:"column is-12"},[i("div",{staticClass:"panel is-warning py-2 px-2 has-text-danger"},[i("p",{staticClass:"panel-heading"},[e._v(" Login failed ")]),e.identityFetchFailed?i("div",{staticClass:"panel-block"},[i("p",[e._v("Could not fetch identity: "+e._s(e.identityFailMsg))])]):e._e(),e.configRetrieveFailed?i("div",{staticClass:"panel-block"},[i("p",[e._v("Could not retrieve configuration from selected server: "+e._s(e.configFailMsg))])]):e._e(),e.loginParamsInvalid?i("div",{staticClass:"panel-block"},[i("p",[e._v("Login failed: Invalid Username/Password")])]):e._e()])]):e._e(),e.legacyLoginEnabled?i("div",{staticClass:"column is-12 pt-4"},[i("div",{staticClass:"section box p-2 has-text-centered"},[i("i",{staticClass:"fas fa-exclamation-circle"}),e._v(" For accounts created in CaSS "),i("b",[e._v("1.3 and earlier")]),e._v(": "),i("a",{on:{click:e.goToLegacyLogin}},[e._v("Legacy Login")])])]):e._e()])])])])])},s=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"modal-content has-text-centered"},[i("span",{staticClass:"icon is-large has-text-center has-text-link"},[i("i",{staticClass:"fas fa-2x fa-spinner is-info fa-pulse"})])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"icon"},[i("i",{staticClass:"fa fa-sign-in-alt"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"icon"},[i("i",{staticClass:"fa fa-plus"})])}],n=(i("b0c0"),i("ac1f"),i("841c"),i("498a"),i("54f8")),r=i("f3d2"),o={name:"Login",mixins:[r["a"]],data:function(){return{GROUP_SEARCH_SIZE:1e4,PERSON_SEARCH_SIZE:1e4,loginBusy:!1,ecRemoteIdentMgr:null,identityFetchFailed:!1,configRetrieveFailed:!1,loginParamsInvalid:!1,identityFailMsg:"",configFailMsg:"",loginCredentials:null,identityToLinkToPerson:null,linkedPerson:null}},methods:{forceLogout:function(){this.redirectToExternalLogout()},goToAppHome:function(){this.loginBusy=!1,this.$router.push({path:"/frameworks"})},goToLegacyLogin:function(){this.loginBusy=!1,this.loginCredentials=null,this.identityToLinkToPerson=null,this.$router.push({path:"/legacyLogin"})},goToCreateAccount:function(){this.loginBusy=!1,this.loginCredentials=null,this.identityToLinkToPerson=null,this.$router.push({path:"/createAccount"})},addGroupIdentity:function(e){try{var t=e.getOrgKeys();appLog("Adding group identities: ("+e.shortId()+") - "+e.getName()+" - ("+t.length+") keys");for(var i=0;i<t.length;i++){var a=t[i],s=new EcIdentity;s.displayName=e.getName()+" - key["+i+"]",s.ppk=a,EcIdentityManager.addIdentityQuietly(s)}}catch(n){}},searchRepositoryForGroupsSuccess:function(e){var t=this.linkedPerson.shortId();if(e&&e.length>0){var i,a=Object(n["a"])(e);try{for(a.s();!(i=a.n()).done;){var s=i.value;if(s.employee&&s.employee.length>0){var r,o=Object(n["a"])(s.employee);try{for(o.s();!(r=o.n()).done;){var c=r.value;if(!EcObject.isObject(c)&&c.equals(t)){this.addGroupIdentity(s);break}}}catch(l){o.e(l)}finally{o.f()}}}}catch(l){a.e(l)}finally{a.f()}}this.goToAppHome()},searchRepositoryForGroupsFailure:function(e){appLog("Group search failure: "+e),this.goToAppHome()},addGroupIdentities:function(){appLog("Finding assigned groups...");var e={};e.size=this.GROUP_SEARCH_SIZE,EcOrganization.search(window.repo,"",this.searchRepositoryForGroupsSuccess,this.searchRepositoryForGroupsFailure,e)},handleCreatePersonSuccess:function(){appLog("Person created."),this.addGroupIdentities()},createPersonObjectForIdentity:function(){appLog("Creating person object for identity...");var e=new Person;e.assignId(window.repo.selectedServer,this.identityToLinkToPerson.ppk.toPk().fingerprint()),e.addOwner(this.identityToLinkToPerson.ppk.toPk()),e.name=this.loginCredentials.name,e.email=this.loginCredentials.email,this.$store.commit("user/loggedOnPerson",e),this.linkedPerson=e,EcRepository.save(e,this.handleCreatePersonSuccess,this.handleAttemptLoginFetchIdentityFailureNoCreateAccountCheck)},findLinkedPersonPersonSearchSuccess:function(e){appLog("Linked person person search success: "),appLog(e),this.identityToLinkToPerson=EcIdentityManager.ids[0];var t,i=!1,a=Object(n["a"])(e);try{for(a.s();!(t=a.n()).done;){var s=t.value,r=new EcPerson;r.copyFrom(s),r.getGuid().equals(this.identityToLinkToPerson.ppk.toPk().fingerprint())&&(i=!0,this.$store.commit("user/loggedOnPerson",r),this.linkedPerson=r,appLog("Matching person record found: "),appLog(r),EcIdentityManager.saveContacts(),EcIdentityManager.saveIdentities())}}catch(o){a.e(o)}finally{a.f()}i?this.addGroupIdentities():(appLog("Matching person record NOT found"),this.createPersonObjectForIdentity())},findLinkedPersonPersonSearchFailure:function(e){this.loginBusy=!1,appLog("Linked person person search failure: "+e)},findLinkedPersonForIdentity:function(){appLog("Finding linked person for identity...");var e=EcIdentityManager.ids[0].ppk.toPk().fingerprint(),t={};t.size=this.PERSON_SEARCH_SIZE,window.repo.searchWithParams('@type:Person AND @id:"'+e+'"',t,null,this.findLinkedPersonPersonSearchSuccess,this.findLinkedPersonPersonSearchFailure)},handleCreateAccountFetchIdentitySuccess:function(){appLog("Creating new account identity object...");var e=new EcIdentity;e.displayName=this.loginCredentials.name,e.ppk=EcPpk.generateKey(),EcIdentityManager.addIdentity(e),EcIdentityManager.saveContacts(),EcIdentityManager.saveIdentities(),this.identityToLinkToPerson=e,this.ecRemoteIdentMgr.commit(this.createPersonObjectForIdentity,this.handleAttemptLoginFetchIdentityFailureNoCreateAccountCheck)},handleCreateAccountRemoteIdentityMgrCreateSuccess:function(){appLog("Creating new account manager fetch..."),this.ecRemoteIdentMgr.fetch(this.handleCreateAccountFetchIdentitySuccess,this.handleAttemptLoginFetchIdentityFailureNoCreateAccountCheck)},handleCreateAccountConfigureFromServerSuccess:function(e){appLog("Creating new account identity..."),this.ecRemoteIdentMgr.startLogin(this.loginCredentials.username,this.loginCredentials.password),this.ecRemoteIdentMgr.create(this.handleCreateAccountRemoteIdentityMgrCreateSuccess,this.handleAttemptLoginFetchIdentityFailureNoCreateAccountCheck)},createNewAccountIdentity:function(){appLog("Creating new account..."),appLog("EcRemoteIdentityManager Configuring from server..."),this.ecRemoteIdentMgr=new EcRemoteIdentityManager,this.ecRemoteIdentMgr.server=window.repo.selectedServer,this.ecRemoteIdentMgr.configureFromServer(this.handleCreateAccountConfigureFromServerSuccess,this.handleAttemptLoginConfigureFromServerFail)},handleAttemptLoginFetchIdentityFailureNoCreateAccountCheck:function(e){this.identityFailMsg=e,this.identityFetchFailed=!0,this.loginBusy=!1},handleAttemptLoginFetchIdentitySuccess:function(e){!EcIdentityManager.ids||EcIdentityManager.ids.length<=0?this.handleAttemptLoginFetchIdentityFailure("Login credentials valid but no identity could be found."):this.findLinkedPersonForIdentity()},handleAttemptLoginFetchIdentityFailure:function(e){e&&e.toLowerCase().trim().equals("user does not exist.")?this.createNewAccountIdentity():(this.identityFailMsg=e,this.identityFetchFailed=!0,this.loginBusy=!1)},handleAttemptLoginConfigureFromServerSuccess:function(e){appLog("Fetching identity..."),this.ecRemoteIdentMgr.startLogin(this.loginCredentials.username,this.loginCredentials.password),this.ecRemoteIdentMgr.fetch(this.handleAttemptLoginFetchIdentitySuccess,this.handleAttemptLoginFetchIdentityFailure)},handleAttemptLoginConfigureFromServerFail:function(e){this.configFailMsg=e,this.configRetrieveFailed=!0,this.loginBusy=!1},performInternalCassLogin:function(){appLog("Attempting CaSS login...."),this.loginBusy=!0,this.identityToLinkToPerson=null,EcIdentityManager.clearContacts(),EcIdentityManager.clearIdentities(),this.ecRemoteIdentMgr=new EcRemoteIdentityManager,this.ecRemoteIdentMgr.server=window.repo.selectedServer,this.ecRemoteIdentMgr.configureFromServer(this.handleAttemptLoginConfigureFromServerSuccess,this.handleAttemptLoginConfigureFromServerFail)},attemptExternalCassLogin:function(){this.redirectToExternalLoginPage()},handleUserProfileAlreadyLoaded:function(e){var t=this.parseCredentialsFromProfileResponse(e);t.username&&t.username.trim().length>0&&t.password&&t.password.trim().length>0?(this.loginCredentials=t,this.performInternalCassLogin()):appLog("Unable to parse credentials from user profile response")},checkUserProfileRequestStatus:function(e){401===e.status?this.loginBusy=!1:200===e.status?this.handleUserProfileAlreadyLoaded(e):(appLog("Unexpected user profile response status: "+e.status),this.loginBusy=!1)},checkLoginStatus:function(){this.loginBusy=!0,this.getUserProfile(this.checkUserProfileRequestStatus)}},computed:{legacyLoginEnabled:function(){return this.$store.getters["featuresEnabled/legacyLoginEnabled"]},apiLoginEnabled:function(){return this.$store.getters["featuresEnabled/apiLoginEnabled"]}},mounted:function(){this.apiLoginEnabled?this.checkLoginStatus():this.goToLegacyLogin()}},c=o,l=(i("2b89"),i("2877")),d=Object(l["a"])(c,a,s,!1,null,"25463ba6",null);t["default"]=d.exports},eeb4:function(e,t,i){},f3d2:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));i("b0c0"),i("d3b7"),i("ddb0");var a={name:"cassApi",data:function(){return{USER_PROFILE_SERVICE:"user/profile",USER_CREATE_SERVICE:"user",USER_LOGIN_SERVICE:"login",USER_LOGOUT_SERVICE:"logout",LOGOUT_REDIRECT_URL:window.location.origin+"/cass-editor/#/login"}},methods:{parseCredentialsFromProfileResponse:function(e){var t=JSON.parse(e.responseText),i={};return i.username=t["preferred_username"],i.password=t["cass_password"],t["email"]?i.email=t["email"]:i.email="n/a",t["name"]?i.name=t["name"]:t["given_name"]&&t["family_name"]?i.name=t["given_name"]+" "+t["family_name"]:i.name=t["preferred_username"],i},performCreateUser:function(e,t){var i=new XMLHttpRequest;i.addEventListener("load",(function(e){return t(e.currentTarget)})),i.withCredentials=!0;var a=this.cassApiLocation+this.USER_CREATE_SERVICE;i.open("POST",a),i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.send(JSON.stringify({username:e.username,password:e.password,email:e.email,firstName:e.firstName,lastName:e.lastName}))},getUserProfile:function(e){var t=new XMLHttpRequest;t.addEventListener("load",(function(t){return e(t.currentTarget)})),t.withCredentials=!0;var i=this.cassApiLocation+this.USER_PROFILE_SERVICE;t.open("GET",i),t.send()},redirectToExternalLoginPage:function(){appLog("Redirecting to external login..."),window.location=this.cassApiLocation+this.USER_LOGIN_SERVICE+"?redirectUrl="+encodeURIComponent(window.location)},goToLogin:function(){this.apiLoginEnabled?this.$router.push({path:"/login"}):this.$router.push({path:"/legacyLogin"})},checkExternalLogoutStatus:function(e){200!==e.status&&appLog("Logout fired but returned an unexpected response code: "+e.status),this.goToLogin()},performExternalLogout:function(){var e=this;appLog("Performing external logout...");var t=new XMLHttpRequest;t.addEventListener("load",(function(t){return e.checkExternalLogoutStatus(t.currentTarget)})),t.withCredentials=!0;var i=this.cassApiLocation+this.USER_LOGOUT_SERVICE;t.open("GET",i),t.send()},performApplicationLogout:function(){appLog("Performing application logout..."),EcIdentityManager.clearContacts(),EcIdentityManager.clearIdentities();var e={};this.$store.commit("user/loggedOnPerson",e),this.apiLoginEnabled?this.performExternalLogout():this.goToLogin()},addQueryParams:function(){var e=this.$store.getters["editor/queryParams"],t=EcObject.keys(e);if(e&&t.length){var i="?";for(var a in t){0!==a&&(i+="&");var s=t[a],n=e[s];if(EcArray.isArray(n))for(var r in n)0!==r&&(i+="&"),i+=s+"="+n[r];else i+=s+"="+n}return i}return""}},computed:{cassApiLocation:function(){return this.$store.getters["environment/cassApiLocation"]},apiLoginEnabled:function(){return this.$store.getters["featuresEnabled/apiLoginEnabled"]}}}}}]);
//# sourceMappingURL=login.d23f174d.js.map