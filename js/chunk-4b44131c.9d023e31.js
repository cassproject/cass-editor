(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4b44131c","chunk-2adf32c6","chunk-f3b8fe20","chunk-f3b8fe20","chunk-74a95bb3","chunk-74a95bb3"],{"054a":function(e,t,r){},"18a3":function(e,t,r){"use strict";var a=r("2eb6"),n=r.n(a);n.a},"2eb6":function(e,t,r){},"3dcd":function(e,t,r){"use strict";var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"columns is-multiline"},[e.selectedFramework?e._e():r("div",{staticClass:"column is-12"},[r("SearchBar",{attrs:{filterSet:"basic",allowShowFrameworks:e.allowShowFrameworks,searchType:e.searchType}})],1),e.selectedFramework?e._e():r("div",{staticClass:"column is-12"},[e.$store.state.lode.competencySearchModalOpen?r("List",{attrs:{type:e.searchTypeToPassToList,view:"search",parent:e.parent,repo:e.repo,click:e.select,searchOptions:e.searchOptions,paramObj:e.paramObj,disallowEdits:!0,selectingCompetency:!0,selected:e.selectedIds,displayFirst:e.displayFirst,idsNotPermittedInSearch:e.idsNotPermittedInSearch}}):e._e()],1),e.selectedFramework&&!e.hierarchyLoaded?r("div",[e._m(0)]):e._e(),r("div",{directives:[{name:"show",rawName:"v-show",value:e.hierarchyLoaded,expression:"hierarchyLoaded"}]},[e.selectedFramework?r("Thing",{attrs:{parent:e.parent,obj:e.selectedFramework,repo:e.repo,view:e.view,expandInModal:!0}}):e._e(),e.selectedFramework?r("Hierarchy",{attrs:{parent:e.parent,container:e.selectedFramework,view:"competencySearch",containerType:"Framework",containerTypeGet:"EcFramework",containerNodeProperty:"competency",containerEdgeProperty:"relation",nodeType:"EcCompetency",edgeType:"EcAlignment",edgeRelationProperty:"relationType",edgeRelationLiteral:"narrows",edgeSourceProperty:"source",edgeTargetProperty:"target",viewOnly:!0,repo:e.repo,highlightList:null,properties:"primary"},on:{"done-loading-nodes":function(t){e.hierarchyLoaded=!0},"selected-array":e.selectedArrayEvent}}):e._e()],1)])},n=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("span",{staticClass:"icon is-large"},[r("i",{staticClass:"fa fa-spinner fa-2x fa-pulse"})])}],s=(r("4de4"),r("a434"),r("b0c0"),r("96cf"),r("c964")),i=r("f3f3"),o=r("713e"),c=r("9418"),d=r("098b"),l=r("872c"),p=r("2f62"),h=r("6b9e"),m={name:"CompetencySearch",props:{parent:{type:String,default:""},isActive:Boolean,view:{type:String,default:"modal"},idsNotPermittedInSearch:{type:Array,default:null},allowShowFrameworks:{type:Boolean,default:!1},clearFramework:{type:Boolean,default:!1},typesPermittedInSearch:{type:Array,default:null}},components:{List:o["a"],SearchBar:h["a"],Hierarchy:c["default"],Thing:d["default"]},mixins:[l["a"]],data:function(){return{repo:window.repo,selectedIds:[],displayFirst:[],showMine:!1,sortBy:null,selectedFramework:null,hierarchyLoaded:!1}},created:function(){this.sortBy=!0===this.$store.getters["editor/conceptMode"]||"Concept"===this.searchType?"dcterms:title.keyword":"name.keyword",this.$store.commit("app/searchTerm","")},beforeDestroy:function(){this.$store.commit("app/searchTerm","")},computed:Object(i["a"])(Object(i["a"])({},Object(p["c"])({selectedCompetency:function(e){return e.editor.selectedCompetency},framework:function(e){return e.editor.framework},queryParams:function(e){return e.editor.queryParams},addingProperty:function(e){return e.lode.addingProperty}})),{},{nameOfSelectedCompetency:function(){return this.selectedCompetency&&this.selectedCompetency.name?this.selectedCompetency.getName():this.selectedCompetency?schema.Thing.getDisplayStringFrom(this.selectedCompetency["skos:prefLabel"]):""},copyOrLink:function(){return this.$store.state.lode.copyOrLink},frameworkName:function(){return this.framework?this.framework.getName():""},searchOptions:function(){var e="";if(this.queryParams&&null!=this.queryParams.filter&&(e+=" AND ("+this.queryParams.filter+")"),"DirectLink"===this.searchType&&(e+=" AND @type:Competency",this.typesPermittedInSearch&&this.typesPermittedInSearch.length>0)){e+=" AND ((dcterms\\:type:"+this.typesPermittedInSearch[0]+")";for(var t=1;t<this.typesPermittedInSearch.length;t++)e+=" OR (dcterms\\:type:"+this.typesPermittedInSearch[t]+")";e+=")"}if((this.showMine||this.queryParams&&!0!==this.$store.getters["editor/conceptMode"]&&"mine"===this.queryParams.show||this.queryParams&&!0===this.$store.getters["editor/conceptMode"]&&"mine"===this.queryParams.conceptShow)&&EcIdentityManager.default.ids.length>0){e+=" AND (";for(var r=0;r<EcIdentityManager.default.ids.length;r++){0!==r&&(e+=" OR ");var a=EcIdentityManager.default.ids[r];e+='\\*owner:"'+a.ppk.toPk().toPem()+'"',e+=' OR \\*owner:"'+this.addNewlinesToId(a.ppk.toPk().toPem())+'"'}e+=")"}return e},paramObj:function(){var e={size:20},t=this.$store.getters["app/searchTerm"];if(t&&0!==t.length)delete e.sort;else{var r="name.keyword"===this.sortBy||"dcterms:title.keyword"===this.sortBy?"asc":"desc";e.sort='[ { "'+this.sortBy+'": {"order" : "'+r+'" , "unmapped_type" : "long",  "missing" : "_last"}} ]'}return EcIdentityManager.default.ids.length>0&&this.queryParams&&(!0!==this.$store.getters["editor/conceptMode"]&&"mine"===this.queryParams.show||!0===this.$store.getters["editor/conceptMode"]&&"mine"===this.queryParams.conceptShow)&&(e.ownership="me"),e},searchType:function(){return this.$store.state.lode.searchType},sortResults:function(){return this.$store.getters["app/sortResults"]},quickFilters:function(){return this.$store.getters["app/quickFilters"]},filteredQuickFilters:function(){if(this.quickFilters){var e=this.quickFilters.filter((function(e){return!0===e.checked}));return appLog("filtered value",e),e}return[]},searchFrameworksInCompetencySearch:function(){return this.$store.getters["app/searchFrameworksInCompetencySearch"]},searchTypeToPassToList:function(){return"Competency"===this.searchType&&this.searchFrameworksInCompetencySearch?"Framework":"DirectLink"===this.searchType?"Competency":this.searchType}}),mounted:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.displayFirst.splice(0,this.displayFirst.length),this.$store.commit("app/searchTerm",""),this.copyOrLink||"Competency"!==this.searchType||!this.framework.competency){e.next=14;break}t=0;case 4:if(!(t<this.framework.competency.length)){e.next=14;break}if(this.framework.competency[t]===this.selectedCompetency.shortId()){e.next=11;break}if(this.idsNotPermittedInSearch&&0!==this.idsNotPermittedInSearch.length&&EcArray.has(this.idsNotPermittedInSearch,this.framework.competency[t])){e.next=11;break}return e.next=9,EcRepository.get(this.framework.competency[t]);case 9:r=e.sent,r&&this.displayFirst.push(r);case 11:t++,e.next=4;break;case 14:if("Level"!==this.searchType||!this.framework.level){e.next=24;break}t=0;case 16:if(!(t<this.framework.level.length)){e.next=24;break}return e.next=19,EcRepository.get(this.framework.level[t]);case 19:r=e.sent,r&&this.displayFirst.push(r);case 21:t++,e.next=16;break;case 24:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),methods:{resetModal:function(){this.$store.commit("app/closeModal"),this.selectedIds=[]},selectedArrayEvent:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){var r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.selectedIds=t,this.copyOrLink&&"Level"!==this.searchType||this.$store.commit("editor/selectedCompetenciesAsProperties",this.selectedIds),"true"!==this.queryParams.selectRelations||!this.framework.relation){e.next=12;break}r=0;case 4:if(!(r<this.framework.relation.length)){e.next=12;break}return e.next=7,EcAlignment.get(this.framework.relation[r]);case 7:a=e.sent,EcArray.has(selectedArray,a.target)&&("true"===this.queryParams.selectVerbose?t.push(JSON.parse(rld.toJson())):t.push(a.shortId()));case 9:r++,e.next=4;break;case 12:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),select:function(e){if("Framework"===e.type)return this.selectFramework(e);EcArray.has(this.selectedIds,e.shortId())?EcArray.setRemove(this.selectedIds,e.shortId()):this.selectedIds.push(e.shortId()),this.copyOrLink&&"Level"!==this.searchType&&"DirectLink"!==this.searchType||this.$store.commit("editor/selectedCompetenciesAsProperties",this.selectedIds)},selectFramework:function(e){this.selectedFramework=e,this.$emit("selectFramework",e)},addNewlinesToId:function(e){e=e.substring(0,26)+"\n"+e.substring(26);var t=e.length,r=27;while(r+64<t)e=e.substring(0,r+64)+"\n"+e.substring(r+64),r+=65,t++;return e=e.substring(0,t-24)+"\n"+e.substring(t-24),e}},watch:{sortResults:function(){"lastEdited"===this.sortResults.id?(this.sortBy="schema:dateModified",this.displayFirst.splice(0,this.displayFirst.length)):(this.sortBy=!0===this.$store.getters["editor/conceptMode"]||"Concept"===this.searchType?"dcterms:title.keyword":"name.keyword",this.displayFirst.splice(0,this.displayFirst.length))},filteredQuickFilters:function(){this.showMine=!1;for(var e=0;e<this.filteredQuickFilters.length;e++)"ownedByMe"===this.filteredQuickFilters[e].id&&(this.showMine=!0,this.displayFirst.splice(0,this.displayFirst.length))},selectedIds:function(e){"search-modal"===this.parent&&this.$emit("setSelectedIds",e)},clearFramework:function(){this.clearFramework&&this.selectFramework(null)}}},u=m,f=(r("18a3"),r("2877")),y=Object(f["a"])(u,a,n,!1,null,null,null);t["a"]=y.exports},"6ffa4":function(e,t,r){"use strict";r("fb6a"),r("96cf");var a=r("c964"),n=r("872c");t["a"]={mixins:[n["a"]],methods:{removeObject:function(e){appLog("removing "+e.id);var t=this,r=this.$store.getters["editor/framework"],n=r.competency?r.competency.slice():null,s=r.relation?r.relation.slice():null,i=r.level?r.level.slice():null;r["schema:dateModified"]=(new Date).toISOString(),r.removeCompetency(e.shortId(),Object(a["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=t.framework,t.$store.commit("editor/addEditsToUndo",[{operation:"update",id:a.shortId(),fieldChanged:["competency","relation","level"],initialValue:[n,s,i]}]),!0!==t.$store.state.editor.private||!0===EcEncryptedValue.encryptOnSaveMap[f.id]){e.next=6;break}return e.next=5,EcEncryptedValue.toEncryptedValue(a);case 5:a=e.sent;case 6:window.repo.saveTo(a,(function(){t.$store.commit("editor/framework",r)}),appError);case 7:case"end":return e.stop()}}),e)}))),appLog)},deleteObject:function(e){appLog("deleting "+e.id);var t=this,r=this.$store.getters["editor/framework"];if(e.shortId()===r.shortId())window.repo.deleteRegistered(r,(function(e){if(t.spitEvent("frameworkDeleted",r.shortId(),"editFrameworkSection"),null!=r.competency)for(var a=0;a<r.competency.length;a++)t.conditionalDelete(r.competency[a]);if(null!=r.relation)for(a=0;a<r.relation.length;a++)t.conditionalDelete(r.relation[a]);if(null!=r.level)for(a=0;a<r.level.length;a++)t.conditionalDelete(r.level[a]);t.$store.commit("editor/framework",null),t.importType?t.$store.commit("app/importFramework",null):t.$router.push({name:"frameworks"})}),appLog);else{var n=r.competency?r.competency.slice():null,s=r.relation?r.relation.slice():null,i=r.level?r.level.slice():null;this.$store.commit("editor/selectedCompetency",e),r["schema:dateModified"]=(new Date).toISOString(),r.removeCompetency(e.shortId(),Object(a["a"])(regeneratorRuntime.mark((function a(){var o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(r.removeLevel(e.shortId()),t.$store.commit("editor/addEditsToUndo",[{operation:"delete",obj:e},{operation:"update",id:r.shortId(),fieldChanged:["competency","relation","level"],initialValue:[n,s,i],changedValue:[r.competency,r.relation,r.level]}]),t.conditionalDelete(e.shortId()),t.spitEvent("competencyDeleted",e.shortId(),"editFrameworkSection"),t.$store.commit("editor/selectedCompetency",null),o=r,!0!==t.$store.state.editor.private||!0===EcEncryptedValue.encryptOnSaveMap[r.id]){a.next=10;break}return a.next=9,EcEncryptedValue.toEncryptedValue(r);case 9:o=a.sent;case 10:window.repo.saveTo(o,(function(){t.$store.commit("editor/framework",r)}),appError);case 11:case"end":return a.stop()}}),a)}))),appLog)}}}}},"984b":function(e,t,r){},a907:function(e,t,r){},ad86:function(e,t,r){"use strict";var a=r("a907"),n=r.n(a);n.a},af07:function(e,t,r){"use strict";var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"modal cass-editor___modal",class:[{"is-active":e.active},"is-"+e.size,"cass-editor__modal--"+e.content],attrs:{id:"cass-modal"}},[r("div",{staticClass:"modal-background"}),r("div",{staticClass:"modal-card",class:"cass-editor__modal-card--"+e.size},[r("header",{staticClass:"modal-card-head is-size-4 has-text-weight-bold",class:["has-background-"+e.type,"has-text-"+e.fontColor]},[r("p",{staticClass:"modal-card-title"},[e._t("modal-header")],2),e.canClose?r("button",{staticClass:"delete",attrs:{"aria-label":"close"},on:{click:function(t){e.$store.commit("app/closeModal"),e.$emit("close")}}}):e._e()]),r("div",{staticClass:"modal-card-body has-text-dark"},[e._t("modal-body")],2),r("footer",{staticClass:"modal-card-foot has-background-white"},[e._t("modal-foot")],2)])])},n=[],s=(r("984b"),{name:"ModalTemplate",props:{canClose:{type:Boolean,default:!0},active:{type:Boolean,default:!1},type:{default:"primary",type:String},fontColor:{type:String,default:"white"},size:{type:String,default:"medium"},content:{defualt:"default",type:String}},data:function(){return{}},computed:{}}),i=s,o=(r("ad86"),r("2877")),c=Object(o["a"])(i,a,n,!1,null,null,null);t["a"]=c.exports},eb5e:function(e,t,r){"use strict";var a=r("054a"),n=r.n(a);n.a},fbde:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("modal-template",{attrs:{content:"search",active:!0},on:{close:e.closeModal}},[r("template",{slot:"modal-header"},[r("p",{staticClass:"modal-card-title"},[r("span",{staticClass:"title has-text-white"},[e._v("Search for "+e._s(e.searchType))]),r("br"),e.copyOrLink?r("span",{staticClass:"subtitle has-text-white"},[r("b",[e._v("Editing framework:")]),e._v(" "+e._s(e.frameworkName)+" ")]):e._e()])]),r("template",{slot:"modal-body"},[e.selectedIds&&e.selectedIds.length||e.selectedFramework?r("button",{staticClass:"button is-dark is-outlined is-small is-pulled-right",on:{click:e.clickClearFramework}},[r("span",{staticClass:"icon"},[r("i",{staticClass:"fa fa-times"})]),r("span",[e._v(" Clear selection ")])]):e._e(),r("search",{ref:"search",attrs:{parent:"search-modal",allowShowFrameworks:!0,clearFramework:e.clearFramework,idsNotPermittedInSearch:e.idsNotPermittedInSearch},on:{setSelectedIds:function(t){e.selectedIds=t},selectFramework:e.selectFramework}})],1),r("template",{slot:"modal-foot"},[r("div",{staticClass:"buttons"},[r("button",{staticClass:"button is-outlined is-dark",on:{click:e.closeModal}},[r("span",{staticClass:"icon"},[r("i",{staticClass:"fa fa-times"})]),r("span",[e._v("cancel")])]),e.copyOrLink?r("button",{staticClass:"button is-outlined is-primary",attrs:{disabled:!e.selectedIds||0===e.selectedIds.length},on:{click:e.copyCompetencies}},[r("span",{staticClass:"icon"},[r("i",{staticClass:"fa fa-copy"})]),r("span",[e._v(" Copy "+e._s(e.searchType)+" ")])]):e._e(),e.copyOrLink?r("button",{staticClass:"button is-outlined is-primary",attrs:{disabled:!e.selectedIds||0===e.selectedIds.length},on:{click:e.appendCompetencies}},[r("span",{staticClass:"icon"},[r("i",{staticClass:"fa fa-link"})]),r("span",[e._v(" Link "+e._s(e.searchType)+" ")])]):e._e()])])],2)},n=[],s=(r("99af"),r("fb6a"),r("a434"),r("96cf"),r("c964")),i=r("f3f3"),o=r("af07"),c=r("3dcd"),d=r("872c"),l=r("2f62"),p={name:"SearchModal",data:function(){return{selectedIds:[],clearFramework:!1,selectedFramework:null,repo:window.repo,itemsSaving:0}},components:{ModalTemplate:o["a"],Search:c["a"]},mixins:[d["a"]],computed:Object(i["a"])(Object(i["a"])({},Object(l["c"])({selectedCompetency:function(e){return e.editor.selectedCompetency},framework:function(e){return e.editor.framework},queryParams:function(e){return e.editor.queryParams}})),{},{copyOrLink:function(){return this.$store.state.lode.copyOrLink},searchType:function(){return this.$store.state.lode.searchType},frameworkName:function(){return this.framework&&this.framework.context?this.framework.getName():""},searchFrameworksInCompetencySearch:function(){return this.$store.getters["app/searchFrameworksInCompetencySearch"]},idsNotPermittedInSearch:function(){if(this.copyOrLink){var e=[this.framework.shortId()];return this.framework.competency&&this.framework.competency.length>0&&(e=e.concat(this.framework.competency)),e}return null}}),methods:{closeModal:function(){this.$store.commit("app/closeModal")},clickClearFramework:function(){var e=this;this.selectedIds.splice(0,this.selectedIds.length),this.clearFramework=!0,this.$nextTick((function(){e.clearFramework=!1}))},selectFramework:function(e){this.selectedFramework=e},addRelations:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.searchFrameworksInCompetencySearch||!this.selectedFramework.relation){e.next=10;break}t=0;case 2:if(!(t<this.selectedFramework.relation.length)){e.next=10;break}return e.next=5,EcAlignment.get(this.selectedFramework.relation[t]);case 5:r=e.sent,EcArray.has(this.selectedIds,r.target)&&EcArray.has(this.selectedIds,r.source)&&this.selectedIds.push(r.shortId());case 7:t++,e.next=2;break;case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),copyCompetencies:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,r,a,n,s,i,o,c,d,l,p,h,m,u,f,y,w,k,g;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.selectedIds,e.next=3,this.addRelations();case 3:r={},a=this.$store.state.editor.framework,n=this.framework.competency?this.framework.competency.slice():null,s=this.framework.relation?this.framework.relation.slice():null,i=this.framework.level?this.framework.level.slice():null,o=[],c=this,d=0;case 11:if(!(d<t.length)){e.next=55;break}return e.next=14,EcRepository.get(t[d]);case 14:if(l=e.sent,null==l||!l.isAny((new EcCompetency).getTypes())){e.next=36;break}if(p=new EcCompetency,p.copyFrom(l),null!=this.queryParams.newObjectEndpoint?p.generateShortId(this.queryParams.newObjectEndpoint):p.generateId(this.repo.selectedServer),o.push(p.shortId()),p["schema:dateCreated"]=(new Date).toISOString(),p["schema:dateModified"]=(new Date).toISOString(),delete p.owner,EcIdentityManager.default.ids.length>0&&p.addOwner(EcIdentityManager.default.ids[0].ppk.toPk()),a.owner&&a.owner.length>0)for(h=0;h<a.owner.length;h++)m=a.owner[h],p.addOwner(EcPk.fromPem(m));if(a.reader&&a.reader.length>0)for(h=0;h<a.reader.length;h++)u=a.reader[h],p.addReader(EcPk.fromPem(u));if(p["ceasn:derivedFrom"]=l.id,r[l.shortId()]=p,!0!==this.$store.state.editor.private||!0===EcEncryptedValue.encryptOnSaveMap[p.id]){e.next=32;break}return e.next=31,EcEncryptedValue.toEncryptedValue(p);case 31:p=e.sent;case 32:this.itemsSaving++,function(e){Task.asyncImmediate((function(t){c.repo.saveTo(e,(function(){a.addCompetency(e.shortId()),c.$store.commit("editor/framework",a),c.afterCopy(n,s,i,o),t()}),(function(e){appError(e),c.afterCopy(n,s,i,o),t()}))}))}(p),e.next=52;break;case 36:if(null==l||!l.isAny((new EcLevel).getTypes())){e.next=52;break}if(f=new EcLevel,f.copyFrom(l),null!=this.queryParams.newObjectEndpoint?f.generateShortId(this.queryParams.newObjectEndpoint):f.generateId(this.repo.selectedServer),o.push(f.shortId()),f["schema:dateCreated"]=(new Date).toISOString(),f.competency=this.$store.state.editor.selectedCompetency.shortId(),delete f.owner,f["ceasn:derivedFrom"]=l.id,r[l.shortId()]=f,!0!==this.$store.state.editor.private||!0===EcEncryptedValue.encryptOnSaveMap[f.id]){e.next=50;break}return e.next=49,EcEncryptedValue.toEncryptedValue(f);case 49:f=e.sent;case 50:this.itemsSaving++,function(e){Task.asyncImmediate((function(t){c.repo.saveTo(e,(function(){a.addLevel(e.shortId()),c.$store.commit("editor/framework",a),c.afterCopy(n,s,i,o),t()}),(function(e){appError(e),c.afterCopy(n,s,i,o),t()}))}))}(f);case 52:d++,e.next=11;break;case 55:d=0;case 56:if(!(d<t.length)){e.next=86;break}return e.next=59,EcRepository.get(t[d]);case 59:if(l=e.sent,null==l||!l.isAny((new EcAlignment).getTypes())){e.next=83;break}if(y=r[l.target],w=r[l.source],"undefined"===typeof y||"undefined"===typeof w){e.next=83;break}if(k=new EcAlignment,k.copyFrom(l),null!=this.queryParams.newObjectEndpoint?k.generateShortId(this.queryParams.newObjectEndpoint):k.generateId(this.repo.selectedServer),o.push(k.shortId()),k["schema:dateCreated"]=(new Date).toISOString(),k.target=y.shortId(),k.source=w.shortId(),k.relationType=l.relationType,EcIdentityManager.default.ids.length>0&&k.addOwner(EcIdentityManager.default.ids[0].ppk.toPk()),a.owner&&a.owner.length>0)for(h=0;h<a.owner.length;h++)m=a.owner[h],k.addOwner(EcPk.fromPem(m));if(a.reader&&a.reader.length>0)for(h=0;h<a.reader.length;h++)u=a.reader[h],k.addReader(EcPk.fromPem(u));if(k.source===k.target){e.next=83;break}if(a["schema:dateModified"]=(new Date).toISOString(),!0!==this.$store.state.editor.private){e.next=81;break}return e.next=80,EcEncryptedValue.toEncryptedValue(k);case 80:k=e.sent;case 81:this.itemsSaving++,function(e){Task.asyncImmediate((function(t){c.repo.saveTo(e,(function(){a.addRelation(e.id),c.$store.commit("editor/framework",a),c.afterCopy(n,s,i,o),t()}),(function(e){appError(e),c.afterCopy(n,s,i,o),t()}))}))}(k);case 83:d++,e.next=56;break;case 86:g=this.$store.state.editor.selectedCompetency,d=0;case 88:if(!(d<t.length)){e.next=117;break}return e.next=91,EcRepository.get(t[d]);case 91:if(l=e.sent,null==l||!l.isAny((new EcCompetency).getTypes())){e.next=114;break}if(null==g){e.next=114;break}if(k=new EcAlignment,null!=this.queryParams.newObjectEndpoint?k.generateShortId(this.queryParams.newObjectEndpoint):k.generateId(this.repo.selectedServer),o.push(k.shortId()),k["schema:dateCreated"]=(new Date).toISOString(),w=r[l.shortId()],k.target=g.shortId(),k.source=w.shortId(),k.relationType=Relation.NARROWS,EcIdentityManager.default.ids.length>0&&k.addOwner(EcIdentityManager.default.ids[0].ppk.toPk()),a.owner&&a.owner.length>0)for(h=0;h<a.owner.length;h++)m=a.owner[h],k.addOwner(EcPk.fromPem(m));if(a.reader&&a.reader.length>0)for(h=0;h<a.reader.length;h++)u=a.reader[h],k.addReader(EcPk.fromPem(u));if(k.source===k.target){e.next=114;break}if(this.itemsSaving++,a.addRelation(k.id),a["schema:dateModified"]=(new Date).toISOString(),!0!==this.$store.state.editor.private){e.next=113;break}return e.next=112,EcEncryptedValue.toEncryptedValue(k);case 112:k=e.sent;case 113:(function(e){Task.asyncImmediate((function(t){c.repo.saveTo(e,(function(){c.afterCopy(n,s,i,o),t()}),(function(e){appError(e),c.afterCopy(n,s,i,o),t()}))}))})(k);case 114:d++,e.next=88;break;case 117:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),afterCopy:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,r,a,n){var s,i,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.itemsSaving--,0!==this.itemsSaving){e.next=13;break}for(s=this.$store.state.editor.framework,i=[],o=0;o<n.length;o++)i.push({operation:"addNew",id:n[o]});if(i.push({operation:"update",id:s.shortId(),fieldChanged:["competency","relation","level"],initialValue:[t,r,a],changedValue:[s.competency,s.relation,s.level]}),this.$store.commit("editor/addEditsToUndo",i),!0!==this.$store.state.editor.private||!0===EcEncryptedValue.encryptOnSaveMap[s.id]){e.next=11;break}return e.next=10,EcEncryptedValue.toEncryptedValue(s);case 10:s=e.sent;case 11:this.repo.saveTo(s,(function(){}),appError),this.closeModal();case 13:case"end":return e.stop()}}),e,this)})));function t(t,r,a,n){return e.apply(this,arguments)}return t}(),appendCompetencies:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,r,a,n,i,o,c,d,l,p,h,m,u,f,y,w,k,g;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.selectedIds,e.next=3,this.addRelations();case 3:r=this.$store.state.editor.selectedCompetency,a=this.$store.state.editor.framework,n=this.framework.competency?this.framework.competency.slice():null,i=this.framework.relation?this.framework.relation.slice():null,o=this.framework.level?this.framework.level.slice():null,c=[],d=[],l=[],p=this,h=0;case 13:if(!(h<t.length)){e.next=21;break}return e.next=16,EcRepository.get(t[h]);case 16:m=e.sent,m.isAny((new EcCompetency).getTypes())?a.addCompetency(m.shortId()):m.isAny((new EcLevel).getTypes())&&(a.addLevel(m.shortId()),EcArray.isArray(m.competency)||(m.competency=[m.competency]),u=m.shortId(),c.push({id:u,competency:m.competency.splice()}),m.competency.push(r.shortId()),d.push({id:u,competency:m.competency}),this.repo.saveTo(m,(function(){}),appError));case 18:h++,e.next=13;break;case 21:h=0;case 22:if(!(h<t.length)){e.next=30;break}return e.next=25,EcRepository.get(t[h]);case 25:m=e.sent,m.isAny((new EcAlignment).getTypes())&&EcArray.has(a.competency,m.source)&&EcArray.has(a.competency,m.target)&&a.addRelation(m.shortId());case 27:h++,e.next=22;break;case 30:h=0;case 31:if(!(h<t.length)){e.next=57;break}return e.next=34,EcRepository.get(t[h]);case 34:if(m=e.sent,!m.isAny((new EcCompetency).getTypes())){e.next=54;break}if(null==r){e.next=54;break}if(f=new EcAlignment,null!=this.queryParams.newObjectEndpoint?f.generateShortId(this.queryParams.newObjectEndpoint):f.generateId(this.repo.selectedServer),l.push(f.shortId()),f["schema:dateCreated"]=(new Date).toISOString(),f.target=r.shortId(),f.source=m.shortId(),f.relationType=Relation.NARROWS,EcIdentityManager.default.ids.length>0&&f.addOwner(EcIdentityManager.default.ids[0].ppk.toPk()),a.owner&&a.owner.length>0)for(y=0;y<a.owner.length;y++)w=a.owner[y],f.addOwner(EcPk.fromPem(w));if(a.reader&&a.reader.length>0)for(y=0;y<a.reader.length;y++)k=a.reader[y],f.addReader(EcPk.fromPem(k));if(f.source===f.target){e.next=54;break}if(a.addRelation(f.id),!0!==this.$store.state.editor.private){e.next=53;break}return e.next=52,EcEncryptedValue.toEncryptedValue(f);case 52:f=e.sent;case 53:this.repo.saveTo(f,(function(){}),appError);case 54:h++,e.next=31;break;case 57:for(g=[],h=0;h<l.length;h++)g.push({operation:"addNew",id:l[h]});if(c.length>0)for(h=0;h<c.length;h++)g.push({operation:"update",id:c[h].id,fieldChanged:["competency"],initialValue:[c[h].competency],changedValue:[d[h].competency]});if(g.push({operation:"update",id:a.shortId(),fieldChanged:["competency","relation","level"],initialValue:[n,i,o],changedValue:[a.competency,a.relation,a.level]}),this.$store.commit("editor/addEditsToUndo",g),!0!==this.$store.state.editor.private||!0===EcEncryptedValue.encryptOnSaveMap[a.id]){e.next=66;break}return e.next=65,EcEncryptedValue.toEncryptedValue(a);case 65:a=e.sent;case 66:this.repo.saveTo(a,Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.t0=p.$store,e.next=3,EcFramework.get(a.id);case 3:e.t1=e.sent,e.t0.commit.call(e.t0,"editor/framework",e.t1),p.closeModal();case 6:case"end":return e.stop()}}),e)}))),appError);case 67:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},h=p,m=(r("eb5e"),r("2877")),u=Object(m["a"])(h,a,n,!1,null,"58411e03",null);t["default"]=u.exports}}]);
//# sourceMappingURL=chunk-4b44131c.9d023e31.js.map