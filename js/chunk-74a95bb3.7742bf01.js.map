{"version":3,"sources":["webpack:///./src/mixins/competencyEdits.js"],"names":["mixins","common","methods","removeObject","thing","appLog","id","me","thisFramework","$store","getters","initialCompetencies","competency","slice","initialRelations","relation","initialLevels","level","Date","toISOString","removeCompetency","shortId","_asyncToGenerator","_regeneratorRuntime","mark","_callee","framework","wrap","_callee$","_context","prev","next","commit","operation","fieldChanged","initialValue","state","editor","private","EcEncryptedValue","encryptOnSaveMap","f","toEncryptedValue","sent","window","repo","saveTo","appError","stop","deleteObject","deleteRegistered","success","spitEvent","i","length","conditionalDelete","importType","$router","push","name","_callee2","frameworkToSave","_callee2$","_context2","removeLevel","obj","changedValue"],"mappings":"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","file":"js/chunk-74a95bb3.7742bf01.js","sourcesContent":["import common from '@/mixins/common.js';\nexport default {\n    mixins: [common],\n    methods: {\n        removeObject: function(thing) {\n            // Remove from container but don't delete\n            appLog(\"removing \" + thing.id);\n            var me = this;\n            var thisFramework = this.$store.getters['editor/framework'];\n            var initialCompetencies = thisFramework.competency ? thisFramework.competency.slice() : null;\n            var initialRelations = thisFramework.relation ? thisFramework.relation.slice() : null;\n            var initialLevels = thisFramework.level ? thisFramework.level.slice() : null;\n            thisFramework[\"schema:dateModified\"] = new Date().toISOString();\n            thisFramework.removeCompetency(thing.shortId(), async function() {\n                var framework = me.framework;\n                me.$store.commit('editor/addEditsToUndo', [{operation: \"update\", id: framework.shortId(), fieldChanged: [\"competency\", \"relation\", \"level\"], initialValue: [initialCompetencies, initialRelations, initialLevels]}]);\n                if (me.$store.state.editor.private === true && EcEncryptedValue.encryptOnSaveMap[f.id] !== true) {\n                    framework = await EcEncryptedValue.toEncryptedValue(framework);\n                }\n                window.repo.saveTo(framework, function() {\n                    me.$store.commit('editor/framework', thisFramework);\n                }, appError);\n            }, appLog);\n        },\n        deleteObject: function(thing) {\n            appLog(\"deleting \" + thing.id);\n            var me = this;\n            var framework = this.$store.getters['editor/framework'];\n            if (thing.shortId() === framework.shortId()) {\n                // delete framework\n                window.repo.deleteRegistered(framework, function(success) {\n                    me.spitEvent(\"frameworkDeleted\", framework.shortId(), \"editFrameworkSection\");\n                    // Delete the framework, delete all non-used stuff.\n                    if (framework.competency != null) {\n                        for (var i = 0; i < framework.competency.length; i++) {\n                            me.conditionalDelete(framework.competency[i]);\n                        }\n                    }\n                    if (framework.relation != null) {\n                        for (var i = 0; i < framework.relation.length; i++) {\n                            me.conditionalDelete(framework.relation[i]);\n                        }\n                    }\n                    if (framework.level != null) {\n                        for (var i = 0; i < framework.level.length; i++) {\n                            me.conditionalDelete(framework.level[i]);\n                        }\n                    }\n                    me.$store.commit('editor/framework', null);\n                    if (me.importType) {\n                        // Calling function from import page\n                        me.$store.commit('app/importFramework', null);\n                    } else {\n                        me.$router.push({name: \"frameworks\"});\n                    }\n                }, appLog);\n            } else {\n                // Delete competency and relations\n                var initialCompetencies = framework.competency ? framework.competency.slice() : null;\n                var initialRelations = framework.relation ? framework.relation.slice() : null;\n                var initialLevels = framework.level ? framework.level.slice() : null;\n                this.$store.commit('editor/selectedCompetency', thing);\n                framework[\"schema:dateModified\"] = new Date().toISOString();\n                framework.removeCompetency(thing.shortId(), async function() {\n                    framework.removeLevel(thing.shortId());\n                    me.$store.commit('editor/addEditsToUndo', [\n                        {operation: \"delete\", obj: thing},\n                        {operation: \"update\", id: framework.shortId(), fieldChanged: [\"competency\", \"relation\", \"level\"], initialValue: [initialCompetencies, initialRelations, initialLevels], changedValue: [framework.competency, framework.relation, framework.level]}\n                    ]);\n                    me.conditionalDelete(thing.shortId());\n                    me.spitEvent(\"competencyDeleted\", thing.shortId(), \"editFrameworkSection\");\n                    me.$store.commit('editor/selectedCompetency', null);\n                    var frameworkToSave = framework;\n                    if (me.$store.state.editor.private === true && EcEncryptedValue.encryptOnSaveMap[framework.id] !== true) {\n                        frameworkToSave = await EcEncryptedValue.toEncryptedValue(framework);\n                    }\n                    window.repo.saveTo(frameworkToSave, function() {\n                        me.$store.commit('editor/framework', framework);\n                    }, appError);\n                }, appLog);\n            }\n        }\n    }\n};"],"sourceRoot":""}