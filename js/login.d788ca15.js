(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["login"],{"21a0":function(e,t,a){"use strict";var i=a("7e9c"),s=a.n(i);s.a},"50b5":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"section is-large",attrs:{id:"createAccount"}},[a("div",{staticClass:"modal",class:[{"is-active":e.createAccountBusy}]},[a("div",{staticClass:"modal-background"}),e._m(0)]),e.createAccountBusy||e.userCreated||e.createUserServerError?e._e():a("div",{staticClass:"modal is-active"},[a("div",{staticClass:"modal-card"},[e._m(1),a("section",{staticClass:"modal-card-body"},[a("div",{staticClass:"section"},[a("div",{staticClass:"field"},[a("div",{staticClass:"control"},[a("label",{staticClass:"label"},[e._v("first name")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.inputFirstName,expression:"inputFirstName"}],staticClass:"input",attrs:{type:"text "},domProps:{value:e.inputFirstName},on:{input:function(t){t.target.composing||(e.inputFirstName=t.target.value)}}})])]),a("div",{staticClass:"field"},[a("div",{staticClass:"control"},[a("label",{staticClass:"label"},[e._v("last name")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.inputLastName,expression:"inputLastName"}],staticClass:"input",attrs:{type:"text "},domProps:{value:e.inputLastName},on:{input:function(t){t.target.composing||(e.inputLastName=t.target.value)}}})])]),a("div",{staticClass:"field"},[a("div",{staticClass:"control"},[a("label",{staticClass:"label"},[e._v("email")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.inputEmail,expression:"inputEmail"}],staticClass:"input",attrs:{type:"text "},domProps:{value:e.inputEmail},on:{input:function(t){t.target.composing||(e.inputEmail=t.target.value)}}})])]),a("div",{staticClass:"field"},[a("div",{staticClass:"control"},[a("label",{staticClass:"label"},[e._v("username")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.inputUserName,expression:"inputUserName"}],staticClass:"input",attrs:{type:"text"},domProps:{value:e.inputUserName},on:{input:function(t){t.target.composing||(e.inputUserName=t.target.value)}}})])]),a("div",{staticClass:"field is-grouped"},[a("div",{staticClass:"control is-expanded"},[a("label",{staticClass:"label"},[e._v("password")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.inputPassword,expression:"inputPassword"}],staticClass:"input",attrs:{type:"password"},domProps:{value:e.inputPassword},on:{input:function(t){t.target.composing||(e.inputPassword=t.target.value)}}})]),a("div",{staticClass:"control is-expanded"},[a("label",{staticClass:"label"},[e._v("confirm password")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.inputPasswordConfirm,expression:"inputPasswordConfirm"}],staticClass:"input",attrs:{type:"password"},domProps:{value:e.inputPasswordConfirm},on:{input:function(t){t.target.composing||(e.inputPasswordConfirm=t.target.value)}}})])])]),e.createAccountInvalid?a("div",{staticClass:"field has-text-danger"},[a("div",{staticClass:"label has-text-danger"},[e._v(" Please correct the following errors: ")]),e.usernameInvalid?a("div",{staticClass:"is-size-6"},[e._v(" Username is required ")]):e._e(),e.passwordInvalid?a("div",{staticClass:"is-size-6"},[e._v(" Password is required ")]):e._e(),e.passwordMismatch?a("div",{staticClass:"is-size-6"},[e._v(" Passwords do not match ")]):e._e(),e.firstNameInvalid?a("div",{staticClass:"is-size-6"},[e._v(" First Name is required ")]):e._e(),e.lastNameInvalid?a("div",{staticClass:"is-size-6"},[e._v(" Last Name is required ")]):e._e(),e.emailInvalid?a("div",{staticClass:"is-size-6"},[e._v(" Valid email is required ")]):e._e(),e.emailUnavailable?a("div",{staticClass:"is-size-6"},[e._v(" That email is unavailable ")]):e._e(),e.usernameUnavailable?a("div",{staticClass:"is-size-6"},[e._v(" That username is unavailable ")]):e._e()]):e._e()]),a("footer",{staticClass:"modal-card-foot has-background-white"},[a("div",{staticClass:"buttons is-spaced"},[a("div",{staticClass:"button is-dark is-outlined",on:{click:e.goToLogin}},[e._m(2),a("span",[e._v("cancel")])]),a("div",{staticClass:"button is-dark is-primary",on:{click:e.attemptAccountCreate}},[e._m(3),a("span",[e._v("create")])])])])])]),!e.createAccountBusy&&e.userCreated?a("div",{staticClass:"modal is-active"},[a("div",{staticClass:"modal-card"},[e._m(4),e._m(5),a("footer",{staticClass:"modal-card-foot has-background-white"},[a("div",{staticClass:"buttons is-spaced"},[a("div",{staticClass:"button is-dark is-outlined",on:{click:e.goToLogin}},[e._m(6),a("span",[e._v("ok")])])])])])]):e._e(),!e.createAccountBusy&&e.createUserServerError?a("div",{staticClass:"modal is-active"},[a("div",{staticClass:"modal-card"},[e._m(7),e._m(8),a("footer",{staticClass:"modal-card-foot has-background-white"},[a("div",{staticClass:"buttons is-spaced"},[a("div",{staticClass:"button is-dark is-outlined",on:{click:e.goToLogin}},[e._m(9),a("span",[e._v("ok")])])])])])]):e._e()])},s=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"modal-content has-text-centered"},[a("span",{staticClass:"icon is-large has-text-center has-text-link"},[a("i",{staticClass:"fas fa-2x fa-spinner is-info fa-pulse"})])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("header",{staticClass:"modal-card-head has-text-centered has-background-primary"},[a("h3",{staticClass:"modal-card-title is-size-2 has-text-centered has-text-white"},[e._v(" Create CaSS Account ")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"icon"},[a("i",{staticClass:"fa fa-times"})])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"icon"},[a("i",{staticClass:"fa fa-sign-in-alt"})])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("header",{staticClass:"modal-card-head has-text-centered has-background-success"},[a("h3",{staticClass:"modal-card-title is-size-2 has-text-centered has-text-white"},[e._v(" Account Created ")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"modal-card-body"},[a("p",[e._v("Your account has been successfully created. Please return to the login screen.")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"icon"},[a("i",{staticClass:"fa fa-times"})])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("header",{staticClass:"modal-card-head has-text-centered has-background-danger"},[a("h3",{staticClass:"modal-card-title is-size-2 has-text-centered has-text-white"},[e._v(" Could Not Create Account ")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"modal-card-body"},[a("p",[e._v("There was an error when attempting to create your account. Please contact the system administrator.")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"icon"},[a("i",{staticClass:"fa fa-times"})])}],n=(a("498a"),a("54f8")),r=a("f3d2"),o={name:"CreateAccount",mixins:[r["a"]],data:function(){return{PERSON_SEARCH_SIZE:1e4,createAccountBusy:!1,createAccountInvalid:!1,inputFirstName:"",inputLastName:"",inputUserName:"",inputEmail:"",inputPassword:"",inputPasswordConfirm:"",usernameInvalid:!1,usernameUnavailable:!1,passwordInvalid:!1,passwordMismatch:!1,firstNameInvalid:!1,lastNameInvalid:!1,emailInvalid:!1,emailUnavailable:!1,ecRemoteIdentMgr:null,userCreated:!1,createUserServerError:!1}},methods:{setAllNewAccountValidationsChecksToValid:function(){this.createAccountInvalid=!1,this.usernameInvalid=!1,this.usernameUnavailable=!1,this.passwordInvalid=!1,this.passwordMismatch=!1,this.firstNameInvalid=!1,this.lastNameInvalid=!1,this.emailInvalid=!1,this.emailUnavailable=!1},isValidEmail:function(e){var t=/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/gim;return!!t.test(e)},validateNewAccountData:function(){this.inputUserName&&!this.inputUserName.trim().equals("")||(this.createAccountInvalid=!0,this.usernameInvalid=!0),!this.inputPassword||this.inputPassword.trim().equals("")||!this.inputPasswordConfirm||this.inputPasswordConfirm.trim().equals("")?(this.createAccountInvalid=!0,this.passwordInvalid=!0):this.inputPassword.equals(this.inputPasswordConfirm)||(this.createAccountInvalid=!0,this.passwordMismatch=!0),this.inputFirstName&&!this.inputFirstName.trim().equals("")||(this.createAccountInvalid=!0,this.firstNameInvalid=!0),this.inputLastName&&!this.inputLastName.trim().equals("")||(this.createAccountInvalid=!0,this.lastNameInvalid=!0),this.inputEmail&&!this.inputEmail.trim().equals("")&&this.isValidEmail(this.inputEmail)||(this.createAccountInvalid=!0,this.emailInvalid=!0)},checkCreateUserRequestStatus:function(e){409===e.status?(this.createAccountInvalid=!0,this.usernameUnavailable=!0,this.createUserServerError=!1,this.userCreated=!1):503===e.status?(this.createUserServerError=!0,this.userCreated=!1):200===e.status?(this.createUserServerError=!1,this.userCreated=!0):appLog("Unexpected create user response status: "+e.status),this.createAccountBusy=!1},buildUserInfoObject:function(){var e={};return e.firstName=this.inputFirstName,e.lastName=this.inputLastName,e.username=this.inputUserName,e.password=this.inputPassword,e.email=this.inputEmail,e},performAccountCreation:function(){this.performCreateUser(this.buildUserInfoObject(),this.checkCreateUserRequestStatus)},handleCheckUsernameFetchIdentitySuccess:function(e){this.createAccountInvalid=!0,this.usernameUnavailable=!0,this.createAccountBusy=!1,EcIdentityManager.default.clearIdentities(),EcIdentityManager.default.clearContacts()},handleCheckUsernameFetchIdentityFailure:function(e){e&&e.toLowerCase().trim().equals("user does not exist.")?this.performAccountCreation():(this.createAccountInvalid=!0,this.usernameUnavailable=!0,this.createAccountBusy=!1,EcIdentityManager.default.clearIdentities(),EcIdentityManager.default.clearContacts())},handleCheckUsernameConfigureFromServerSuccess:function(e){appLog("Fetching identity for username check..."),this.ecRemoteIdentMgr.startLogin(this.inputUserName,this.inputPassword),this.ecRemoteIdentMgr.fetch(this.handleCheckUsernameFetchIdentitySuccess,this.handleCheckUsernameFetchIdentityFailure)},handleCheckUsernameConfigureFromServerFail:function(e){this.createAccountBusy=!1,appLog("New account configure from server for username check failure: "+msg)},checkForExistingUsername:function(){appLog("Check if new account username already exists"),this.ecRemoteIdentMgr=new EcRemoteIdentityManager,this.ecRemoteIdentMgr.server=window.repo.selectedServer,this.ecRemoteIdentMgr.configureFromServer(this.handleCheckUsernameConfigureFromServerSuccess,this.handleCheckUsernameConfigureFromServerFail)},searchPersonsForNewAccountSuccess:function(e){appLog("New account person search success: "),appLog(e);var t,a=!1,i=Object(n["a"])(e);try{for(i.s();!(t=i.n()).done;){var s=t.value,r=new EcPerson;if(r.copyFrom(s),this.inputEmail.equalsIgnoreCase(r.email)){a=!0;break}}}catch(o){i.e(o)}finally{i.f()}a?(this.createAccountInvalid=!0,this.emailUnavailable=!0,this.createAccountBusy=!1):this.checkForExistingUsername()},searchPersonsForNewAccountFailure:function(e){this.checkForExistingUsername()},verifyEmailAddressForNewAccountAndGo:function(){this.createAccountBusy=!0;var e={};e.size=this.PERSON_SEARCH_SIZE,window.repo.searchWithParams('@type:Person AND email:"'+this.inputEmail+'"',e,null,this.searchPersonsForNewAccountSuccess,this.searchPersonsForNewAccountFailure)},attemptAccountCreate:function(){this.setAllNewAccountValidationsChecksToValid(),this.validateNewAccountData(),this.createAccountInvalid||this.verifyEmailAddressForNewAccountAndGo()},goToLogin:function(){this.createAccountBusy=!1,this.$router.push({path:"/login"})}},mounted:function(){}},c=o,l=(a("9efc"),a("2877")),d=Object(l["a"])(c,i,s,!1,null,"e6348706",null);t["default"]=d.exports},"7e9c":function(e,t,a){},"853d":function(e,t,a){"use strict";var i=a("a896"),s=a.n(i);s.a},"9efc":function(e,t,a){"use strict";var i=a("b4cc"),s=a.n(i);s.a},a896:function(e,t,a){},b4cc:function(e,t,a){},d492:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"section is-large",attrs:{id:"login"}},[a("div",{staticClass:"modal",class:[{"is-active":e.loginBusy}]},[a("div",{staticClass:"modal-background"}),e._m(0)]),e.loginBusy?e._e():a("div",{staticClass:"modal is-active"},[a("div",{staticClass:"modal-card"},[e.loginBusy?e._e():a("header",{staticClass:"modal-card-head has-text-centered has-background-primary"},[e.amJustLoggingIn?a("h3",{staticClass:"modal-card-title is-size-2 has-text-centered has-text-white"},[e._v(" Login to CaSS Authoring Tool ")]):e._e(),e.amCreatingAccount?a("h3",{staticClass:"modal-card-title is-size-2 has-text-centered has-text-white"},[e._v(" Create CaSS Authoring Tool User ")]):e._e(),e.amCreatingLinkedPerson?a("h4",{staticClass:"title is-size-2 has-text-centered has-text-white"},[e._v(" Link User Information ")]):e._e()]),a("section",{staticClass:"modal-card-body"},[e.amCreatingLinkedPerson?a("div",{staticClass:"section"},[e.amCreatingLinkedPerson?a("p",[e._v(" No matching user record could be found that matched your login information. Please provide the following: ")]):e._e()]):e._e(),e.amJustLoggingIn?a("div",{staticClass:"section"},[a("div",{staticClass:"field"},[a("div",{staticClass:"control"},[a("label",{staticClass:"label"},[e._v("Username")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],staticClass:"input",attrs:{type:"text",placeholder:"username"},domProps:{value:e.username},on:{input:function(t){t.target.composing||(e.username=t.target.value)}}})])]),a("div",{staticClass:"field"},[a("div",{staticClass:"control"},[a("label",{staticClass:"label"},[e._v("Password")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:"input",attrs:{type:"password",placeholder:"password"},domProps:{value:e.password},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.attemptCassLogin.apply(null,arguments)},input:function(t){t.target.composing||(e.password=t.target.value)}}})])])]):e._e(),a("div",{staticClass:"section"},[e.amCreatingAccount||e.amCreatingLinkedPerson?a("div",{staticClass:"field"},[a("div",{staticClass:"control"},[a("label",{staticClass:"label"},[e._v("name")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.createLinkPersonName,expression:"createLinkPersonName"}],staticClass:"input",attrs:{type:"text "},domProps:{value:e.createLinkPersonName},on:{input:function(t){t.target.composing||(e.createLinkPersonName=t.target.value)}}})])]):e._e(),e.amCreatingAccount||e.amCreatingLinkedPerson?a("div",{staticClass:"field"},[a("div",{staticClass:"control"},[a("label",{staticClass:"label"},[e._v("email")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.createLinkPersonEmail,expression:"createLinkPersonEmail"}],staticClass:"input",attrs:{type:"text "},domProps:{value:e.createLinkPersonEmail},on:{input:function(t){t.target.composing||(e.createLinkPersonEmail=t.target.value)}}})])]):e._e(),e.amCreatingAccount?a("div",{staticClass:"field"},[a("div",{staticClass:"control"},[a("label",{staticClass:"label"},[e._v("username")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.createAccountUsername,expression:"createAccountUsername"}],staticClass:"input",attrs:{type:"text"},domProps:{value:e.createAccountUsername},on:{input:function(t){t.target.composing||(e.createAccountUsername=t.target.value)}}})])]):e._e(),e.amCreatingAccount?a("div",{staticClass:"field is-grouped"},[a("div",{staticClass:"control is-expanded"},[a("label",{staticClass:"label"},[e._v("password")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.createAccountPassword,expression:"createAccountPassword"}],staticClass:"input",attrs:{type:"password"},domProps:{value:e.createAccountPassword},on:{input:function(t){t.target.composing||(e.createAccountPassword=t.target.value)}}})]),a("div",{staticClass:"control is-expanded"},[a("label",{staticClass:"label"},[e._v("Confirm password")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.createAccountPasswordRetype,expression:"createAccountPasswordRetype"}],staticClass:"input",attrs:{type:"password"},domProps:{value:e.createAccountPasswordRetype},on:{input:function(t){t.target.composing||(e.createAccountPasswordRetype=t.target.value)}}})])]):e._e()]),e.createAccountOrLinkPersonDataInvalid?a("div",{staticClass:"field has-text-danger"},[a("div",{staticClass:"label has-text-danger"},[e._v(" Please correct the following errors: ")]),e.createAccountUsernameInvalid?a("div",{staticClass:"is-size-6"},[e._v(" Username is required ")]):e._e(),e.createAccountPasswordInvalid?a("div",{staticClass:"is-size-6"},[e._v(" Password is required ")]):e._e(),e.createAccountPasswordMismatch?a("div",{staticClass:"is-size-6"},[e._v(" Passwords do not match ")]):e._e(),e.createLinkPersonNameInvalid?a("div",{staticClass:"is-size-6"},[e._v(" Name is required ")]):e._e(),e.createLinkPersonEmailInvalid?a("div",{staticClass:"is-size-6"},[e._v(" Valid email is required ")]):e._e(),e.createLinkPersonEmailExists?a("div",{staticClass:"is-size-6"},[e._v(" That email is already in use ")]):e._e(),e.createAccountUsernameUnavailable?a("div",{staticClass:"is-size-6"},[e._v(" That username is unavailable ")]):e._e()]):e._e(),e.identityFetchFailed||e.configRetrieveFailed||e.loginParamsInvalid?a("div",{staticClass:"section"},[e.identityFetchFailed?a("div",[a("p",[a("b",[e._v("Login failed: "+e._s(e.identityFailMsg))])])]):e._e(),e.configRetrieveFailed?a("div",[a("p",[a("b",[e._v("Could not retrieve configuration from selected server: "+e._s(e.configFailMsg))])])]):e._e(),e.loginParamsInvalid?a("div",[e._m(1)]):e._e()]):e._e()]),a("footer",{staticClass:"modal-card-foot has-background-white"},[a("div",{staticClass:"buttons is-spaced"},[e.amCreatingLinkedPerson||e.amCreatingAccount?a("div",{staticClass:"button is-dark is-outlined",on:{click:function(t){return e.setDataToBaseLogin(!0)}}},[e._m(2),a("span",[e._v("cancel")])]):e._e(),e.amJustLoggingIn?[e.apiLoginEnabled?e._e():a("div",{staticClass:"button is-outlined is-dark",on:{click:e.showCreateAccount}},[e._m(3),a("span",[e._v("create account")])]),a("div",{staticClass:"button is-outlined is-primary",on:{click:e.attemptCassLogin}},[e._m(4),a("span",[e._v("login")])])]:e._e(),e.amCreatingAccount?a("div",{staticClass:"button is-expanded is-primary is-outlined",on:{click:e.createNewAccount}},[e._m(5),a("span",[e._v("create")])]):e._e(),e.amCreatingLinkedPerson?a("div",{staticClass:"button is-success is-outlined",on:{click:e.linkPerson}},[e._m(6),a("span",[e._v("update")])]):e._e()],2)]),e.apiLoginEnabled?a("div",{staticClass:"has-text-centered"},[a("a",{on:{click:e.goToStandardLogin}},[e._v("Return to Standard Login")])]):e._e()])])])},s=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"modal-content has-text-centered"},[a("span",{staticClass:"icon is-large has-text-center has-text-link"},[a("i",{staticClass:"fas fa-2x fa-spinner is-info fa-pulse"})])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("p",[a("b",[e._v("Login failed: Invalid Username/Password")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"icon"},[a("i",{staticClass:"fa fa-times"})])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"icon"},[a("i",{staticClass:"fa fa-plus"})])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"icon"},[a("i",{staticClass:"fa fa-sign-in-alt"})])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"icon"},[a("i",{staticClass:"fa fa-sign-in-alt"})])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"icon"},[a("i",{staticClass:"fa fa-sign-in-alt"})])}],n=(a("b0c0"),a("d3b7"),a("ac1f"),a("25f0"),a("841c"),a("498a"),a("54f8")),r=(a("96cf"),a("c964")),o={name:"LegacyLogin",data:function(){return{GROUP_SEARCH_SIZE:1e4,PERSON_SEARCH_SIZE:1e4,username:"",password:"",createAccountUsername:"",createAccountPassword:"",createAccountPasswordRetype:"",createLinkPersonName:"",createLinkPersonEmail:"",loginParamsInvalid:!1,identityFetchFailed:!1,configRetrieveFailed:!1,loginBusy:!1,ecRemoteIdentMgr:{},configFailMsg:"",identityFailMsg:"",amJustLoggingIn:!0,amCreatingAccount:!1,amCreatingLinkedPerson:!1,createAccountOrLinkPersonDataInvalid:!1,createAccountUsernameInvalid:!1,createAccountPasswordInvalid:!1,createAccountPasswordMismatch:!1,createLinkPersonNameInvalid:!1,createLinkPersonEmailInvalid:!1,createLinkPersonEmailExists:!1,createAccountUsernameUnavailable:!1,identityToLinkToPerson:{},linkedPerson:{}}},methods:{goToStandardLogin:function(){this.loginBusy=!1,this.$router.push({path:"/login"})},goToAppHome:function(){this.loginBusy=!1,this.$router.push({path:"/frameworks"})},addGroupIdentity:function(e){return Object(r["a"])(regeneratorRuntime.mark((function t(){var a,i,s,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.getOrgKeys();case 3:for(a=t.sent,appLog("Adding group identities: ("+e.shortId()+") - "+e.getName()+" - ("+a.length+") keys"),i=0;i<a.length;i++)s=a[i],n=new EcIdentity,n.displayName=e.getName()+" - key["+i+"]",n.ppk=s,EcIdentityManager.default.addIdentityQuietly(n);t.next=10;break;case 8:t.prev=8,t.t0=t["catch"](0);case 10:case"end":return t.stop()}}),t,null,[[0,8]])})))()},searchRepositoryForGroupsSuccess:function(e){var t=this.linkedPerson.shortId();if(e&&e.length>0){var a,i=Object(n["a"])(e);try{for(i.s();!(a=i.n()).done;){var s=a.value;if(s.employee&&s.employee.length>0){var r,o=Object(n["a"])(s.employee);try{for(o.s();!(r=o.n()).done;){var c=r.value;if(c.equals(t)){this.addGroupIdentity(s);break}}}catch(l){o.e(l)}finally{o.f()}}}}catch(l){i.e(l)}finally{i.f()}}},searchRepositoryForGroupsFailure:function(e){appLog("Group search failure: "+e),this.goToAppHome()},addGroupIdentities:function(){appLog(" Adding group identities...");var e={};e.size=this.GROUP_SEARCH_SIZE,EcOrganization.search(window.repo,"",this.searchRepositoryForGroupsSuccess,this.searchRepositoryForGroupsFailure,e),this.goToAppHome()},setDataToBaseLogin:function(e){this.username="",this.password="",this.createAccountUsername="",this.createAccountPassword="",this.createAccountPasswordRetype="",this.createLinkPersonName="",this.createLinkPersonEmail="",this.loginParamsInvalid=!1,this.identityFetchFailed=!1,this.configRetrieveFailed=!1,this.configFailMsg="",this.identityFailMsg="",this.amCreatingAccount=!1,this.amCreatingLinkedPerson=!1,this.createAccountOrLinkPersonDataInvalid=!1,this.createAccountUsernameInvalid=!1,this.createAccountPasswordInvalid=!1,this.createAccountPasswordMismatch=!1,this.createLinkPersonNameInvalid=!1,this.createLinkPersonEmailInvalid=!1,this.createLinkPersonEmailExists=!1,this.createAccountUsernameUnavailable=!1,e&&(this.ecRemoteIdentMgr={},EcIdentityManager.default.clearContacts(),EcIdentityManager.default.clearIdentities(),this.identityToLinkToPerson={},this.linkedPerson={}),this.amJustLoggingIn=!0,this.loginBusy=!1},showCreateAccount:function(){this.setDataToBaseLogin(!0),this.amJustLoggingIn=!1,this.amCreatingAccount=!0},showCreateLinkedPerson:function(){this.setDataToBaseLogin(!1),this.amJustLoggingIn=!1,this.amCreatingLinkedPerson=!0},setAllNewAccountValidationsChecksToValid:function(){this.createAccountOrLinkPersonDataInvalid=!1,this.createAccountUsernameInvalid=!1,this.createAccountPasswordInvalid=!1,this.createAccountPasswordMismatch=!1,this.createLinkPersonNameInvalid=!1,this.createLinkPersonEmailInvalid=!1,this.createLinkPersonEmailExists=!1,this.createAccountUsernameUnavailable=!1},isValidEmail:function(e){var t=/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/gim;return!!t.test(e)},validateNewAccountData:function(){this.createAccountUsername&&!this.createAccountUsername.trim().equals("")||(this.createAccountOrLinkPersonDataInvalid=!0,this.createAccountUsernameInvalid=!0),!this.createAccountPassword||this.createAccountPassword.trim().equals("")||!this.createAccountPasswordRetype||this.createAccountPasswordRetype.trim().equals("")?(this.createAccountOrLinkPersonDataInvalid=!0,this.createAccountPasswordInvalid=!0):this.createAccountPassword.equals(this.createAccountPasswordRetype)||(this.createAccountOrLinkPersonDataInvalid=!0,this.createAccountPasswordMismatch=!0),this.validateLinkPersonData()},handleCreatePersonSuccess:function(){appLog("Person created."),this.amCreatingAccount?this.goToAppHome():this.addGroupIdentities()},createPersonObjectToLinkToIdentity:function(){appLog("Creating person object for identity...");var e=new EcPerson;e.assignId(window.repo.selectedServer,this.identityToLinkToPerson.ppk.toPk().fingerprint()),e.addOwner(this.identityToLinkToPerson.ppk.toPk()),e.name=this.createLinkPersonName,e.email=this.createLinkPersonEmail,appLog(e),this.$store.commit("user/loggedOnPerson",e),this.linkedPerson=e,EcRepository.save(e,this.handleCreatePersonSuccess,this.handleAttemptLoginFetchIdentityFailure)},handleCreateAccountFetchIdentitySuccess:function(){appLog("Creating new account identity object...");var e=new EcIdentity;e.displayName=this.createLinkPersonName,e.ppk=EcPpk.generateKey(),EcIdentityManager.default.addIdentity(e),EcIdentityManager.default.saveContacts(),EcIdentityManager.default.saveIdentities(),this.identityToLinkToPerson=e,this.ecRemoteIdentMgr.commit(this.createPersonObjectToLinkToIdentity,this.handleAttemptLoginFetchIdentityFailure)},handleCreateAccountRemoteIdentityMgrCreateSuccess:function(){appLog("Creating new account manager fetch..."),this.ecRemoteIdentMgr.fetch(this.handleCreateAccountFetchIdentitySuccess,this.handleAttemptLoginFetchIdentityFailure)},handleCreateAccountConfigureFromServerSuccess:function(e){appLog("EcRemoteIdentityManager creating..."),appLog("Creating new account login..."),this.ecRemoteIdentMgr.startLogin(this.createAccountUsername,this.createAccountPassword),this.ecRemoteIdentMgr.create(this.handleCreateAccountRemoteIdentityMgrCreateSuccess,this.handleAttemptLoginFetchIdentityFailure)},createNewAccountIdentityAndPerson:function(){appLog("Creating new account..."),appLog("EcRemoteIdentityManager Configuring from server..."),this.ecRemoteIdentMgr=new EcRemoteIdentityManager,this.ecRemoteIdentMgr.server=window.repo.selectedServer,this.ecRemoteIdentMgr.configureFromServer(this.handleCreateAccountConfigureFromServerSuccess,this.handleAttemptLoginConfigureFromServerFail)},handleCheckUsernameFetchIdentitySuccess:function(e){appLog("handleCheckUsernameFetchIdentitySuccess !!!!"),this.createAccountOrLinkPersonDataInvalid=!0,this.createAccountUsernameUnavailable=!0,this.loginBusy=!1,EcIdentityManager.default.clearIdentities(),EcIdentityManager.default.clearContacts()},handleCheckUsernameFetchIdentityFailure:function(e){appLog("handleCheckUsernameFetchIdentityFailure: "+e),e&&-1!==e.toString().toLowerCase().indexOf("user does not exist")?this.createNewAccountIdentityAndPerson():(this.createAccountOrLinkPersonDataInvalid=!0,this.createAccountUsernameUnavailable=!0,this.loginBusy=!1,EcIdentityManager.default.clearIdentities(),EcIdentityManager.default.clearContacts())},handleCheckUsernameConfigureFromServerSuccess:function(e){appLog("Fetching identity for username check..."),this.ecRemoteIdentMgr.startLogin(this.createAccountUsername,this.createAccountPassword),this.ecRemoteIdentMgr.fetch(this.handleCheckUsernameFetchIdentitySuccess,this.handleCheckUsernameFetchIdentityFailure)},handleCheckUsernameConfigureFromServerFail:function(e){this.loginBusy=!1,appLog("New account configure from server for username check failure: "+msg)},checkForExistingUsername:function(){appLog("Check if new account username already exists"),this.ecRemoteIdentMgr=new EcRemoteIdentityManager,this.ecRemoteIdentMgr.server=window.repo.selectedServer,this.ecRemoteIdentMgr.configureFromServer(this.handleCheckUsernameConfigureFromServerSuccess,this.handleCheckUsernameConfigureFromServerFail)},searchPersonsForNewAccountSuccess:function(e){appLog("New account person search success: "),appLog(e);var t,a=!1,i=Object(n["a"])(e);try{for(i.s();!(t=i.n()).done;){var s=t.value,r=new EcPerson;if(r.copyFrom(s),this.createLinkPersonEmail.equalsIgnoreCase(r.email)){a=!0;break}}}catch(o){i.e(o)}finally{i.f()}a?(this.createAccountOrLinkPersonDataInvalid=!0,this.createLinkPersonEmailExists=!0,this.loginBusy=!1):this.checkForExistingUsername()},searchPersonsForNewAccountFailure:function(e){this.checkForExistingUsername()},verifyEmailAddressForNewAccountAndGo:function(){this.loginBusy=!0;var e={};e.size=this.PERSON_SEARCH_SIZE,window.repo.searchWithParams('@type:Person AND email:"'+this.createLinkPersonEmail+'"',e,null,this.searchPersonsForNewAccountSuccess,this.searchPersonsForNewAccountFailure)},createNewAccount:function(){this.setAllNewAccountValidationsChecksToValid(),this.validateNewAccountData(),this.createAccountOrLinkPersonDataInvalid||this.verifyEmailAddressForNewAccountAndGo()},validateLinkPersonData:function(){this.createLinkPersonName&&!this.createLinkPersonName.trim().equals("")||(this.createAccountOrLinkPersonDataInvalid=!0,this.createLinkPersonNameInvalid=!0),this.createLinkPersonEmail&&!this.createLinkPersonEmail.trim().equals("")&&this.isValidEmail(this.createLinkPersonEmail)||(this.createAccountOrLinkPersonDataInvalid=!0,this.createLinkPersonEmailInvalid=!0)},searchPersonsForLinkPersonSuccess:function(e){this.loginBusy=!0;var t,a=!1,i=Object(n["a"])(e);try{for(i.s();!(t=i.n()).done;){var s=t.value,r=new EcPerson;if(r.copyFrom(s),this.createLinkPersonEmail.equalsIgnoreCase(r.email)){a=!0;break}}}catch(o){i.e(o)}finally{i.f()}a?(this.createAccountOrLinkPersonDataInvalid=!0,this.createLinkPersonEmailExists=!0,this.loginBusy=!1):this.createPersonObjectToLinkToIdentity()},verifyEmailAddressForLinkPersonAndGo:function(){appLog("Validating link person email...");var e={};e.size=this.PERSON_SEARCH_SIZE,window.repo.searchWithParams('@type:Person AND email:"'+this.createLinkPersonEmail+'"',e,null,this.searchPersonsForLinkPersonSuccess,this.searchPersonsForNewAccountFailure)},linkPerson:function(){this.setAllNewAccountValidationsChecksToValid(),this.validateLinkPersonData(),this.createAccountOrLinkPersonDataInvalid||this.verifyEmailAddressForLinkPersonAndGo()},areLoginParamsValid:function(){return null!=this.username&&0!==this.username.length&&null!=this.password&&0!==this.password.length||(this.loginParamsInvalid=!0,!1)},findLinkedPersonPersonSearchSuccess:function(e){appLog("Linked person person search success: "),appLog(e),this.identityToLinkToPerson=EcIdentityManager.default.ids[0];var t,a=!1,i=Object(n["a"])(e);try{for(i.s();!(t=i.n()).done;){var s=t.value,r=new EcPerson;r.copyFrom(s),r.getGuid().equals(this.identityToLinkToPerson.ppk.toPk().fingerprint())&&(a=!0,this.$store.commit("user/loggedOnPerson",r),this.linkedPerson=r,appLog("Matching person record found: "),appLog(r),EcIdentityManager.default.saveContacts(),EcIdentityManager.default.saveIdentities())}}catch(o){i.e(o)}finally{i.f()}a?this.addGroupIdentities():(appLog("Matching person record NOT found"),this.showCreateLinkedPerson())},findLinkedPersonPersonSearchFailure:function(e){this.loginBusy=!1,appLog("Linked person person search failure: "+e)},findLinkedPersonForIdentity:function(){appLog("Finding linked person for identity...");var e=EcIdentityManager.default.ids[0].ppk.toPk().fingerprint(),t={};t.size=this.PERSON_SEARCH_SIZE,window.repo.searchWithParams('@type:Person AND @id:"'+e+'"',t,null,this.findLinkedPersonPersonSearchSuccess,this.findLinkedPersonPersonSearchFailure)},handleAttemptLoginFetchIdentitySuccess:function(e){!EcIdentityManager.default.ids||EcIdentityManager.default.ids.length<=0?this.handleAttemptLoginFetchIdentityFailure("Login credentials valid but no identity could be found."):this.findLinkedPersonForIdentity()},handleAttemptLoginFetchIdentityFailure:function(e){this.identityFailMsg=e,this.identityFetchFailed=!0,this.loginBusy=!1},handleAttemptLoginConfigureFromServerSuccess:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return appLog("Fetching identity..."),this.ecRemoteIdentMgr.startLogin(this.username,this.password),e.next=4,this.ecRemoteIdentMgr.fetch(null,this.handleAttemptLoginFetchIdentityFailure).then((function(e){e&&(EcIdentityManager.default=e,a.handleAttemptLoginFetchIdentitySuccess())}));case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),handleAttemptLoginConfigureFromServerFail:function(e){this.configFailMsg=e,this.configRetrieveFailed=!0,this.loginBusy=!1},attemptCassLogin:function(){this.loginParamsInvalid=!1,this.identityFetchFailed=!1,this.configRetrieveFailed=!1,this.areLoginParamsValid()&&(appLog("Attempting CaSS login...."),this.loginBusy=!0,EcIdentityManager.default.clearContacts(),EcIdentityManager.default.clearIdentities(),this.ecRemoteIdentMgr=new EcRemoteIdentityManager,this.ecRemoteIdentMgr.server=window.repo.selectedServer,this.ecRemoteIdentMgr.configureFromServer(this.handleAttemptLoginConfigureFromServerSuccess,this.handleAttemptLoginConfigureFromServerFail))}},computed:{legacyLoginEnabled:function(){return this.$store.getters["featuresEnabled/legacyLoginEnabled"]},apiLoginEnabled:function(){return this.$store.getters["featuresEnabled/apiLoginEnabled"]}},mounted:function(){this.setDataToBaseLogin(!0)}},c=o,l=(a("21a0"),a("2877")),d=Object(l["a"])(c,i,s,!1,null,"3a2e080a",null);t["default"]=d.exports},ede4:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"section is-large",attrs:{id:"login"}},[a("div",{staticClass:"modal",class:[{"is-active":e.loginBusy}]},[a("div",{staticClass:"modal-background"}),e._m(0)]),e.loginBusy?e._e():a("div",{staticClass:"modal is-active"},[a("div",{staticClass:"modal-card"},[e.loginBusy?e._e():a("header",{staticClass:"modal-card-head has-text-centered has-background-primary"},[a("h3",{staticClass:"modal-card-title is-size-2 has-text-centered has-text-white"},[e._v(" Login to CaSS ")])]),a("section",{staticClass:"modal-card-body"},[a("div",{staticClass:"columns is-mobile is-multiline"},[a("div",{staticClass:"column is-6"},[a("div",{staticClass:"section box py-2 px-2"},[a("div",{staticClass:"modal-card-body has-text-centered"},[a("div",{staticClass:"button is-outlined is-primary",on:{click:e.attemptExternalCassLogin}},[e._m(1),a("span",[e._v("login")])])])])]),a("div",{staticClass:"column is-6"},[a("div",{staticClass:"section box py-2 px-2"},[a("div",{staticClass:"modal-card-body has-text-centered"},[a("div",{staticClass:"button is-outlined is-dark",on:{click:e.goToCreateAccount}},[e._m(2),a("span",[e._v("create account")])])])])]),e.identityFetchFailed||e.configRetrieveFailed||e.loginParamsInvalid?a("div",{staticClass:"column is-12"},[a("div",{staticClass:"panel is-warning py-2 px-2 has-text-danger"},[a("p",{staticClass:"panel-heading"},[e._v(" Login failed ")]),e.identityFetchFailed?a("div",{staticClass:"panel-block"},[a("p",[e._v("Could not fetch identity: "+e._s(e.identityFailMsg))])]):e._e(),e.configRetrieveFailed?a("div",{staticClass:"panel-block"},[a("p",[e._v("Could not retrieve configuration from selected server: "+e._s(e.configFailMsg))])]):e._e(),e.loginParamsInvalid?a("div",{staticClass:"panel-block"},[a("p",[e._v("Login failed: Invalid Username/Password")])]):e._e()])]):e._e(),e.legacyLoginEnabled?a("div",{staticClass:"column is-12 pt-4"},[a("div",{staticClass:"section box p-2 has-text-centered"},[a("i",{staticClass:"fas fa-exclamation-circle"}),e._v(" For accounts created in CaSS "),a("b",[e._v("1.3 and earlier")]),e._v(": "),a("a",{on:{click:e.goToLegacyLogin}},[e._v("Legacy Login")])])]):e._e()])])])])])},s=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"modal-content has-text-centered"},[a("span",{staticClass:"icon is-large has-text-center has-text-link"},[a("i",{staticClass:"fas fa-2x fa-spinner is-info fa-pulse"})])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"icon"},[a("i",{staticClass:"fa fa-sign-in-alt"})])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{staticClass:"icon"},[a("i",{staticClass:"fa fa-plus"})])}],n=(a("b0c0"),a("ac1f"),a("841c"),a("498a"),a("54f8")),r=(a("96cf"),a("c964")),o=a("f3d2"),c={name:"Login",mixins:[o["a"]],data:function(){return{GROUP_SEARCH_SIZE:1e4,PERSON_SEARCH_SIZE:1e4,loginBusy:!1,ecRemoteIdentMgr:null,identityFetchFailed:!1,configRetrieveFailed:!1,loginParamsInvalid:!1,identityFailMsg:"",configFailMsg:"",loginCredentials:null,identityToLinkToPerson:null,linkedPerson:null}},methods:{forceLogout:function(){this.redirectToExternalLogout()},goToAppHome:function(){this.loginBusy=!1,this.$router.push({path:"/frameworks"})},goToLegacyLogin:function(){this.loginBusy=!1,this.loginCredentials=null,this.identityToLinkToPerson=null,this.$router.push({path:"/legacyLogin"})},goToCreateAccount:function(){this.loginBusy=!1,this.loginCredentials=null,this.identityToLinkToPerson=null,this.$router.push({path:"/createAccount"})},addGroupIdentity:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a,i,s,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.getOrgKeys();case 3:for(a=e.sent,appLog("Adding group identities: ("+t.shortId()+") - "+t.getName()+" - ("+a.length+") keys"),i=0;i<a.length;i++)s=a[i],n=new EcIdentity,n.displayName=t.getName()+" - key["+i+"]",n.ppk=s,EcIdentityManager.default.addIdentityQuietly(n);e.next=10;break;case 8:e.prev=8,e.t0=e["catch"](0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])})));function t(t){return e.apply(this,arguments)}return t}(),searchRepositoryForGroupsSuccess:function(e){var t=this.linkedPerson.shortId();if(e&&e.length>0){var a,i=Object(n["a"])(e);try{for(i.s();!(a=i.n()).done;){var s=a.value;if(s.employee&&s.employee.length>0){var r,o=Object(n["a"])(s.employee);try{for(o.s();!(r=o.n()).done;){var c=r.value;if(!EcObject.isObject(c)&&c.equals(t)){this.addGroupIdentity(s);break}}}catch(l){o.e(l)}finally{o.f()}}}}catch(l){i.e(l)}finally{i.f()}}this.goToAppHome()},searchRepositoryForGroupsFailure:function(e){appLog("Group search failure: "+e),this.goToAppHome()},addGroupIdentities:function(){appLog("Finding assigned groups...");var e={};e.size=this.GROUP_SEARCH_SIZE,EcOrganization.search(window.repo,"",this.searchRepositoryForGroupsSuccess,this.searchRepositoryForGroupsFailure,e)},handleCreatePersonSuccess:function(){appLog("Person created."),this.addGroupIdentities()},createPersonObjectForIdentity:function(){appLog("Creating person object for identity...");var e=new EcPerson;e.assignId(window.repo.selectedServer,this.identityToLinkToPerson.ppk.toPk().fingerprint()),e.addOwner(this.identityToLinkToPerson.ppk.toPk()),e.name=this.loginCredentials.name,e.email=this.loginCredentials.email,this.$store.commit("user/loggedOnPerson",e),this.linkedPerson=e,EcRepository.save(e,this.handleCreatePersonSuccess,this.handleAttemptLoginFetchIdentityFailureNoCreateAccountCheck)},findLinkedPersonPersonSearchSuccess:function(e){appLog("Linked person person search success: "),appLog(e),this.identityToLinkToPerson=EcIdentityManager.default.ids[0];var t,a=!1,i=Object(n["a"])(e);try{for(i.s();!(t=i.n()).done;){var s=t.value,r=new EcPerson;r.copyFrom(s),r.getGuid().equals(this.identityToLinkToPerson.ppk.toPk().fingerprint())&&(a=!0,this.$store.commit("user/loggedOnPerson",r),this.linkedPerson=r,appLog("Matching person record found: "),appLog(r),EcIdentityManager.default.saveContacts(),EcIdentityManager.default.saveIdentities())}}catch(o){i.e(o)}finally{i.f()}a?this.addGroupIdentities():(appLog("Matching person record NOT found"),this.createPersonObjectForIdentity())},findLinkedPersonPersonSearchFailure:function(e){this.loginBusy=!1,appLog("Linked person person search failure: "+e)},findLinkedPersonForIdentity:function(){appLog("Finding linked person for identity...");var e=EcIdentityManager.default.ids[0].ppk.toPk().fingerprint(),t={};t.size=this.PERSON_SEARCH_SIZE,window.repo.searchWithParams('@type:Person AND @id:"'+e+'"',t,null,this.findLinkedPersonPersonSearchSuccess,this.findLinkedPersonPersonSearchFailure)},handleCreateAccountFetchIdentitySuccess:function(){appLog("Creating new account identity object...");var e=new EcIdentity;e.displayName=this.loginCredentials.name,e.ppk=EcPpk.generateKey(),EcIdentityManager.default.addIdentity(e),EcIdentityManager.default.saveContacts(),EcIdentityManager.default.saveIdentities(),this.identityToLinkToPerson=e,this.ecRemoteIdentMgr.commit(this.createPersonObjectForIdentity,this.handleAttemptLoginFetchIdentityFailureNoCreateAccountCheck)},handleCreateAccountRemoteIdentityMgrCreateSuccess:function(){appLog("Creating new account manager fetch..."),this.ecRemoteIdentMgr.fetch(this.handleCreateAccountFetchIdentitySuccess,this.handleAttemptLoginFetchIdentityFailureNoCreateAccountCheck)},handleCreateAccountConfigureFromServerSuccess:function(e){appLog("Creating new account identity..."),this.ecRemoteIdentMgr.startLogin(this.loginCredentials.username,this.loginCredentials.password),this.ecRemoteIdentMgr.create(this.handleCreateAccountRemoteIdentityMgrCreateSuccess,this.handleAttemptLoginFetchIdentityFailureNoCreateAccountCheck)},createNewAccountIdentity:function(){appLog("Creating new account..."),appLog("EcRemoteIdentityManager Configuring from server..."),this.ecRemoteIdentMgr=new EcRemoteIdentityManager,this.ecRemoteIdentMgr.server=window.repo.selectedServer,this.ecRemoteIdentMgr.configureFromServer(this.handleCreateAccountConfigureFromServerSuccess,this.handleAttemptLoginConfigureFromServerFail)},handleAttemptLoginFetchIdentityFailureNoCreateAccountCheck:function(e){this.identityFailMsg=e,this.identityFetchFailed=!0,this.loginBusy=!1},handleAttemptLoginFetchIdentitySuccess:function(e){!EcIdentityManager.default.ids||EcIdentityManager.default.ids.length<=0?this.handleAttemptLoginFetchIdentityFailure("Login credentials valid but no identity could be found."):this.findLinkedPersonForIdentity()},handleAttemptLoginFetchIdentityFailure:function(e){e&&e.toLowerCase().trim().equals("user does not exist.")?this.createNewAccountIdentity():(this.identityFailMsg=e,this.identityFetchFailed=!0,this.loginBusy=!1)},handleAttemptLoginConfigureFromServerSuccess:function(e){appLog("Fetching identity..."),this.ecRemoteIdentMgr.startLogin(this.loginCredentials.username,this.loginCredentials.password),this.ecRemoteIdentMgr.fetch(this.handleAttemptLoginFetchIdentitySuccess,this.handleAttemptLoginFetchIdentityFailure)},handleAttemptLoginConfigureFromServerFail:function(e){this.configFailMsg=e,this.configRetrieveFailed=!0,this.loginBusy=!1},performInternalCassLogin:function(){appLog("Attempting CaSS login...."),this.loginBusy=!0,this.identityToLinkToPerson=null,EcIdentityManager.default.clearContacts(),EcIdentityManager.default.clearIdentities(),this.ecRemoteIdentMgr=new EcRemoteIdentityManager,this.ecRemoteIdentMgr.server=window.repo.selectedServer,this.ecRemoteIdentMgr.configureFromServer(this.handleAttemptLoginConfigureFromServerSuccess,this.handleAttemptLoginConfigureFromServerFail)},attemptExternalCassLogin:function(){this.redirectToExternalLoginPage()},handleUserProfileAlreadyLoaded:function(e){var t=this.parseCredentialsFromProfileResponse(e);t.username&&t.username.trim().length>0&&t.password&&t.password.trim().length>0?(this.loginCredentials=t,this.performInternalCassLogin()):appLog("Unable to parse credentials from user profile response")},checkUserProfileRequestStatus:function(e){401===e.status?this.loginBusy=!1:200===e.status?this.handleUserProfileAlreadyLoaded(e):(appLog("Unexpected user profile response status: "+e.status),this.loginBusy=!1)},checkLoginStatus:function(){this.loginBusy=!0,this.getUserProfile(this.checkUserProfileRequestStatus)}},computed:{legacyLoginEnabled:function(){return this.$store.getters["featuresEnabled/legacyLoginEnabled"]},apiLoginEnabled:function(){return this.$store.getters["featuresEnabled/apiLoginEnabled"]}},mounted:function(){this.apiLoginEnabled?this.checkLoginStatus():this.goToLegacyLogin()}},l=c,d=(a("853d"),a("2877")),u=Object(d["a"])(l,i,s,!1,null,"f654a560",null);t["default"]=u.exports},f3d2:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));a("b0c0"),a("d3b7"),a("ddb0");var i={name:"cassApi",data:function(){return{USER_PROFILE_SERVICE:"user/profile",USER_CREATE_SERVICE:"user",USER_LOGIN_SERVICE:"login",USER_LOGOUT_SERVICE:"logout",LOGOUT_REDIRECT_URL:window.location.origin+"/cass-editor/#/login"}},methods:{parseCredentialsFromProfileResponse:function(e){var t=JSON.parse(e.responseText),a={};return a.username=t["preferred_username"],a.password=t["cass_password"],t["email"]?a.email=t["email"]:a.email="n/a",t["name"]?a.name=t["name"]:t["given_name"]&&t["family_name"]?a.name=t["given_name"]+" "+t["family_name"]:a.name=t["preferred_username"],a},performCreateUser:function(e,t){var a=new XMLHttpRequest;a.addEventListener("load",(function(e){return t(e.currentTarget)})),a.withCredentials=!0;var i=this.cassApiLocation+this.USER_CREATE_SERVICE;a.open("POST",i),a.setRequestHeader("Content-Type","application/json;charset=UTF-8"),a.send(JSON.stringify({username:e.username,password:e.password,email:e.email,firstName:e.firstName,lastName:e.lastName}))},getUserProfile:function(e){var t=new XMLHttpRequest;t.addEventListener("load",(function(t){return e(t.currentTarget)})),t.withCredentials=!0;var a=this.cassApiLocation+this.USER_PROFILE_SERVICE;t.open("GET",a),t.send()},redirectToExternalLogin:function(){appLog("Redirecting to external login..."),window.location=this.repositorySsoOptions.ssoLogin+"?redirectUrl="+encodeURIComponent(window.location)},redirectToExternalLogout:function(){appLog("Redirecting to external logout..."),window.location=this.repositorySsoOptions.ssoLogout+"?redirectUrl="+encodeURIComponent(window.location)},goToLogin:function(){this.apiLoginEnabled?this.$router.push({path:"/login"}):this.$router.push({path:"/legacyLogin"})},checkExternalLogoutStatus:function(e){200!==e.status&&appLog("Logout fired but returned an unexpected response code: "+e.status),this.goToLogin()},performExternalLogout:function(){var e=this;appLog("Performing external logout...");var t=new XMLHttpRequest;t.addEventListener("load",(function(t){return e.checkExternalLogoutStatus(t.currentTarget)})),t.withCredentials=!0;var a=this.cassApiLocation+this.USER_LOGOUT_SERVICE;t.open("GET",a),t.send()},performApplicationLogout:function(){appLog("Performing application logout..."),EcIdentityManager.default.clearContacts(),EcIdentityManager.default.clearIdentities();var e={};this.$store.commit("user/loggedOnPerson",e),this.apiLoginEnabled?this.redirectToExternalLogout():this.goToLogin()},performApplicationLogin:function(){appLog("Performing application login..."),EcIdentityManager.default.clearContacts(),EcIdentityManager.default.clearIdentities();var e={};this.$store.commit("user/loggedOnPerson",e),this.apiLoginEnabled?this.redirectToExternalLogin():this.goToLogin()},addQueryParams:function(){var e=this.$store.getters["editor/queryParams"],t=EcObject.keys(e);if(e&&t.length){var a="?";for(var i in t){0!==i&&(a+="&");var s=t[i],n=e[s];if(EcArray.isArray(n))for(var r in n)0!==r&&(a+="&"),a+=s+"="+n[r];else a+=s+"="+n}return a}return""}},computed:{cassApiLocation:function(){return this.$store.getters["environment/cassApiLocation"]},repositorySsoOptions:function(){return this.$store.getters["user/repositorySsoOptions"]},apiLoginEnabled:function(){return this.$store.getters["featuresEnabled/apiLoginEnabled"]}}}}}]);
//# sourceMappingURL=login.d788ca15.js.map