<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>KBAC Specification | CaSS Docs</title>
    <meta name="generator" content="VuePress 1.9.9">
    <script>
            window.onload = function() {
                var container = document.getElementsByClassName('theme-container');
                if(window.location.href.includes('credential')) {
                    container[0].classList.add('credential-editor');
                } else {
                    container[0].classList.add('cass-editor')
                }
            };
        </script>
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/docs/assets/css/0.styles.c280faa6.css" as="style"><link rel="preload" href="/docs/assets/js/app.28f45806.js" as="script"><link rel="preload" href="/docs/assets/js/2.5190c88e.js" as="script"><link rel="preload" href="/docs/assets/js/74.64dfe9e5.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.8cedbad6.js"><link rel="prefetch" href="/docs/assets/js/11.f334292a.js"><link rel="prefetch" href="/docs/assets/js/12.a9474667.js"><link rel="prefetch" href="/docs/assets/js/13.ec7102f2.js"><link rel="prefetch" href="/docs/assets/js/14.be1e000e.js"><link rel="prefetch" href="/docs/assets/js/15.b56bf42d.js"><link rel="prefetch" href="/docs/assets/js/16.9adcbc84.js"><link rel="prefetch" href="/docs/assets/js/17.38c83e49.js"><link rel="prefetch" href="/docs/assets/js/18.4d7d6be2.js"><link rel="prefetch" href="/docs/assets/js/19.3d5338a2.js"><link rel="prefetch" href="/docs/assets/js/20.e331ab67.js"><link rel="prefetch" href="/docs/assets/js/21.bb085710.js"><link rel="prefetch" href="/docs/assets/js/22.800bffba.js"><link rel="prefetch" href="/docs/assets/js/23.897be772.js"><link rel="prefetch" href="/docs/assets/js/24.735c0be2.js"><link rel="prefetch" href="/docs/assets/js/25.31b5c0a9.js"><link rel="prefetch" href="/docs/assets/js/26.5ec66fd1.js"><link rel="prefetch" href="/docs/assets/js/27.e96a94e9.js"><link rel="prefetch" href="/docs/assets/js/28.4059b381.js"><link rel="prefetch" href="/docs/assets/js/29.323c343d.js"><link rel="prefetch" href="/docs/assets/js/3.7e8a997f.js"><link rel="prefetch" href="/docs/assets/js/30.ee83dd45.js"><link rel="prefetch" href="/docs/assets/js/31.3e58394c.js"><link rel="prefetch" href="/docs/assets/js/32.635132cf.js"><link rel="prefetch" href="/docs/assets/js/33.d1934981.js"><link rel="prefetch" href="/docs/assets/js/34.fb0dbb46.js"><link rel="prefetch" href="/docs/assets/js/35.a84ce2c5.js"><link rel="prefetch" href="/docs/assets/js/36.be0bd795.js"><link rel="prefetch" href="/docs/assets/js/37.b8622210.js"><link rel="prefetch" href="/docs/assets/js/38.2a5c54f4.js"><link rel="prefetch" href="/docs/assets/js/39.be1cd15d.js"><link rel="prefetch" href="/docs/assets/js/4.24ad5b3e.js"><link rel="prefetch" href="/docs/assets/js/40.c24b4e12.js"><link rel="prefetch" href="/docs/assets/js/41.9687b04b.js"><link rel="prefetch" href="/docs/assets/js/42.891dbdeb.js"><link rel="prefetch" href="/docs/assets/js/43.412ab402.js"><link rel="prefetch" href="/docs/assets/js/44.a7e645bd.js"><link rel="prefetch" href="/docs/assets/js/45.26c8da3f.js"><link rel="prefetch" href="/docs/assets/js/46.e0f36c51.js"><link rel="prefetch" href="/docs/assets/js/47.d29c1ea2.js"><link rel="prefetch" href="/docs/assets/js/48.9638a8ca.js"><link rel="prefetch" href="/docs/assets/js/49.a219a4f2.js"><link rel="prefetch" href="/docs/assets/js/5.ef95df11.js"><link rel="prefetch" href="/docs/assets/js/50.684c089b.js"><link rel="prefetch" href="/docs/assets/js/51.a47655f0.js"><link rel="prefetch" href="/docs/assets/js/52.6743356e.js"><link rel="prefetch" href="/docs/assets/js/53.c83ec05b.js"><link rel="prefetch" href="/docs/assets/js/54.538a104b.js"><link rel="prefetch" href="/docs/assets/js/55.01192147.js"><link rel="prefetch" href="/docs/assets/js/56.dc118a40.js"><link rel="prefetch" href="/docs/assets/js/57.297c359b.js"><link rel="prefetch" href="/docs/assets/js/58.bbe69c6f.js"><link rel="prefetch" href="/docs/assets/js/59.c1616daa.js"><link rel="prefetch" href="/docs/assets/js/6.804b18c5.js"><link rel="prefetch" href="/docs/assets/js/60.5538035e.js"><link rel="prefetch" href="/docs/assets/js/61.2ed5dc55.js"><link rel="prefetch" href="/docs/assets/js/62.f34758bc.js"><link rel="prefetch" href="/docs/assets/js/63.36cbd88c.js"><link rel="prefetch" href="/docs/assets/js/64.6b536c3e.js"><link rel="prefetch" href="/docs/assets/js/65.5652601e.js"><link rel="prefetch" href="/docs/assets/js/66.c8ffde30.js"><link rel="prefetch" href="/docs/assets/js/67.b679a180.js"><link rel="prefetch" href="/docs/assets/js/68.efc0c65b.js"><link rel="prefetch" href="/docs/assets/js/69.67e1c852.js"><link rel="prefetch" href="/docs/assets/js/7.8b4c008b.js"><link rel="prefetch" href="/docs/assets/js/70.ef1d5b0c.js"><link rel="prefetch" href="/docs/assets/js/71.db2a4efc.js"><link rel="prefetch" href="/docs/assets/js/72.32b6915f.js"><link rel="prefetch" href="/docs/assets/js/73.063e2457.js"><link rel="prefetch" href="/docs/assets/js/75.b654b515.js"><link rel="prefetch" href="/docs/assets/js/76.3f3fb882.js"><link rel="prefetch" href="/docs/assets/js/77.09b9a218.js"><link rel="prefetch" href="/docs/assets/js/78.363cb91e.js"><link rel="prefetch" href="/docs/assets/js/79.f1d913c7.js"><link rel="prefetch" href="/docs/assets/js/8.9348e819.js"><link rel="prefetch" href="/docs/assets/js/80.f6680582.js"><link rel="prefetch" href="/docs/assets/js/81.93d90645.js"><link rel="prefetch" href="/docs/assets/js/9.021ca86e.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.c280faa6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><img src="/docs/cass-logo.png" alt="CaSS Docs" class="logo"> <span class="site-name can-hide">CaSS Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/docs/guide/introduction/" class="nav-link">
  Getting Started
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/docs/guide/introduction/" class="nav-link">
  Getting Started
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>High-Level Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Getting Started</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/guide/introduction/" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/guide/introduction/#use-cases" class="sidebar-link">Use Cases</a></li><li class="sidebar-sub-header"><a href="/docs/guide/introduction/#example-use-case" class="sidebar-link">Example Use Case</a></li><li class="sidebar-sub-header"><a href="/docs/guide/introduction/#developers" class="sidebar-link">Developers</a></li><li class="sidebar-sub-header"><a href="/docs/guide/introduction/#explore-the-interfaces" class="sidebar-link">Explore the interfaces</a></li><li class="sidebar-sub-header"><a href="/docs/guide/introduction/#join-the-community" class="sidebar-link">Join the community</a></li></ul></li><li><a href="/docs/guide/overview/" class="sidebar-link">Overview</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/guide/overview/#welcome" class="sidebar-link">Welcome</a></li><li class="sidebar-sub-header"><a href="/docs/guide/overview/#about-cass" class="sidebar-link">About CaSS</a></li><li class="sidebar-sub-header"><a href="/docs/guide/overview/#design-principles" class="sidebar-link">Design Principles</a></li><li class="sidebar-sub-header"><a href="/docs/guide/overview/#cass-instances-and-apis" class="sidebar-link">CaSS Instances and APIs</a></li><li class="sidebar-sub-header"><a href="/docs/guide/overview/#cass-objects" class="sidebar-link">CaSS Objects</a></li><li class="sidebar-sub-header"><a href="/docs/guide/overview/#cass-components" class="sidebar-link">CaSS Components</a></li><li class="sidebar-sub-header"><a href="/docs/guide/overview/#security-and-privacy" class="sidebar-link">Security and Privacy</a></li></ul></li></ul></section></li><li><a href="/docs/guide/interoperability/" class="sidebar-link">Interoperability</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/guide/interoperability/#import-export" class="sidebar-link">Import / Export</a></li><li class="sidebar-sub-header"><a href="/docs/guide/interoperability/#library-integration" class="sidebar-link">Library Integration</a></li><li class="sidebar-sub-header"><a href="/docs/guide/interoperability/#adapters-overview" class="sidebar-link">Adapters Overview</a></li></ul></li><li><a href="/docs/guide/assertion-processing/" class="sidebar-link">Assertion Processing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/guide/assertion-processing/#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/docs/guide/assertion-processing/#requirements" class="sidebar-link">Requirements</a></li><li class="sidebar-sub-header"><a href="/docs/guide/assertion-processing/#definitions-and-assumptions" class="sidebar-link">Definitions and Assumptions</a></li><li class="sidebar-sub-header"><a href="/docs/guide/assertion-processing/#assertion-api" class="sidebar-link">Assertion API</a></li><li class="sidebar-sub-header"><a href="/docs/guide/assertion-processing/#current-assertion-processing-algorithm" class="sidebar-link">Current Assertion Processing Algorithm</a></li><li class="sidebar-sub-header"><a href="/docs/guide/assertion-processing/#expected-changes" class="sidebar-link">Expected Changes</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Authoring Tool</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Developer's Guide</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Getting Started</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>CaSS Fundamentals</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Tutorials</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/docs/dev/design-principles/" class="sidebar-link">Design Principles</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/dev/design-principles/#open-linked-data" class="sidebar-link">Open Linked Data</a></li><li class="sidebar-sub-header"><a href="/docs/dev/design-principles/#no-knowledge-repository" class="sidebar-link">No Knowledge Repository</a></li><li class="sidebar-sub-header"><a href="/docs/dev/design-principles/#public-key-infrastructure" class="sidebar-link">Public Key Infrastructure</a></li><li class="sidebar-sub-header"><a href="/docs/dev/design-principles/#uri-url-urn-nuances" class="sidebar-link">URI/URL/URN Nuances</a></li><li class="sidebar-sub-header"><a href="/docs/dev/design-principles/#standards-based-api-s" class="sidebar-link">Standards-Based API's</a></li><li class="sidebar-sub-header"><a href="/docs/dev/design-principles/#descriptive-not-prescriptive" class="sidebar-link">Descriptive, not Prescriptive</a></li></ul></li><li><a href="/docs/dev/performance/" class="sidebar-link">Performance</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/dev/performance/#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/docs/dev/performance/#http-2" class="sidebar-link">HTTP/2</a></li><li class="sidebar-sub-header"><a href="/docs/dev/performance/#signatures" class="sidebar-link">Signatures</a></li><li class="sidebar-sub-header"><a href="/docs/dev/performance/#caching" class="sidebar-link">Caching</a></li><li class="sidebar-sub-header"><a href="/docs/dev/performance/#batch-queries" class="sidebar-link">Batch Queries</a></li><li class="sidebar-sub-header"><a href="/docs/dev/performance/#multiget" class="sidebar-link">Multiget</a></li></ul></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Extending CaSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Security</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/dev/security/kbac-specification/" aria-current="page" class="active sidebar-link">KBAC Specification</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/dev/security/kbac-specification/#specification" class="sidebar-link">Specification</a></li><li class="sidebar-sub-header"><a href="/docs/dev/security/kbac-specification/#types" class="sidebar-link">Types</a></li><li class="sidebar-sub-header"><a href="/docs/dev/security/kbac-specification/#identity-server-types-and-operations" class="sidebar-link">Identity Server, Types and Operations</a></li><li class="sidebar-sub-header"><a href="/docs/dev/security/kbac-specification/#repository" class="sidebar-link">Repository</a></li></ul></li><li><a href="/docs/dev/security/kbac-threat-model/" class="sidebar-link">KBAC Threat Model</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/dev/security/kbac-threat-model/#server-side-attacks" class="sidebar-link">Server-Side Attacks</a></li><li class="sidebar-sub-header"><a href="/docs/dev/security/kbac-threat-model/#client-side-attacks" class="sidebar-link">Client-Side Attacks</a></li></ul></li></ul></section></li><li><a href="/docs/dev/links-and-references/" class="sidebar-link">Links and References</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/dev/links-and-references/#github" class="sidebar-link">GitHub</a></li><li class="sidebar-sub-header"><a href="/docs/dev/links-and-references/#cass-installation-bash-script" class="sidebar-link">CaSS Installation Bash Script</a></li><li class="sidebar-sub-header"><a href="/docs/dev/links-and-references/#cass-project-website" class="sidebar-link">CaSS Project Website</a></li><li class="sidebar-sub-header"><a href="/docs/dev/links-and-references/#cass-library-api" class="sidebar-link">CaSS Library API</a></li><li class="sidebar-sub-header"><a href="/docs/dev/links-and-references/#cass-schema" class="sidebar-link">CaSS Schema</a></li><li class="sidebar-sub-header"><a href="/docs/dev/links-and-references/#sandbox" class="sidebar-link">Sandbox</a></li><li class="sidebar-sub-header"><a href="/docs/dev/links-and-references/#other-learning-resources" class="sidebar-link">Other Learning Resources</a></li><li class="sidebar-sub-header"><a href="/docs/dev/links-and-references/#contact-us" class="sidebar-link">Contact Us</a></li></ul></li><li><a href="/docs/dev/contributing/" class="sidebar-link">Contributing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/dev/contributing/#getting-started" class="sidebar-link">Getting Started</a></li><li class="sidebar-sub-header"><a href="/docs/dev/contributing/#getting-help" class="sidebar-link">Getting Help</a></li><li class="sidebar-sub-header"><a href="/docs/dev/contributing/#development-stack" class="sidebar-link">Development Stack</a></li><li class="sidebar-sub-header"><a href="/docs/dev/contributing/#governance" class="sidebar-link">Governance</a></li><li class="sidebar-sub-header"><a href="/docs/dev/contributing/#architecture" class="sidebar-link">Architecture</a></li><li class="sidebar-sub-header"><a href="/docs/dev/contributing/#contributing-2" class="sidebar-link">Contributing</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="kbac-specification"><a href="#kbac-specification" class="header-anchor">#</a> KBAC Specification</h1> <p>This document specifies how to implement <strong>Key-Based Access Control (KBAC)</strong>, which is the security and access control framework used by CaSS. KBAC adds security and access control to JSON and JSON-LD objects. It uses mechanisms found in <a href="https://en.wikipedia.org/wiki/Public_key_infrastructure" target="_blank" rel="noopener noreferrer">Public Key Infrastructure (PKI)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to federate identities, authenticate identities,  provide authorization, and encrypt data.</p> <h3 id="how-to-read-this-document"><a href="#how-to-read-this-document" class="header-anchor">#</a> How to Read this Document</h3> <p>This document describes the data model, functions, and algorithms used to implement KBAC for security, authorization, and encryption. It is intended for developers with a working understanding of encryption and access to code libraries that can be used to perform common encryption tasks.</p> <h3 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h3> <p>KBAC has the following components:</p> <ol><li>A <strong>permission system</strong> that defines what operations an individual or system can perform on any object in CaSS.</li> <li>An <strong>encryption-based enforcement system</strong> that enables end-to-end encryption. Cryptographic techniques are used to grant and deny read permissions and to validate the authenticity of objects or fields.</li> <li>A set of <strong>conformance criteria</strong> (with various levels of conformance) that ensure that a conforming system follows adequate security procedures and  respects permissions, including those that cannot be enforced via encryption.</li></ol> <p>KBAC assumes that objects are expressed in JSON-LD and adds fields and encryption to these objects to accomplish 1 and 2. KBAC does not specify how and where JSON-LD objects are stored or transmitted but is compatible with <em>NoSQL</em> and <em>SQL</em> databases, with systems that store JSON-LD as objects in a document object model, and with both secure and insecure data transmission protocols (e.g. HTTP and HTTPS). CaSS instances (installed using the code available on GitHub) store objects in a NoSQL database as JSON-LD with KBAC extensions and encryption and conform to the policy requirements of KBAC.</p> <h2 id="specification"><a href="#specification" class="header-anchor">#</a> Specification</h2> <h3 id="encodings"><a href="#encodings" class="header-anchor">#</a> Encodings</h3> <p>In <a href="https://www.json.org/json-en.html" target="_blank" rel="noopener noreferrer">JSON<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, a string is a &quot;<em>a sequence of zero or more Unicode characters, wrapped in double quotes, using backslash escapes.</em>&quot; CaSS uses <a href="https://en.wikipedia.org/wiki/UTF-8" target="_blank" rel="noopener noreferrer">UTF-8 encodings<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> of unicode characters. When necessary, <a href="https://en.wikipedia.org/wiki/Base64" target="_blank" rel="noopener noreferrer">Base64 encoding<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is used to convert sequences of bytes into strings.</p> <h3 id="entities-and-identities"><a href="#entities-and-identities" class="header-anchor">#</a> Entities and Identities</h3> <p>In KBAC, an <strong>Entity</strong> refers to a <em>person, organization, group,</em> or <em>system</em>.</p> <p>KBAC assigns identities to entities. KBAC assumes that real-world identities are defined and managed external to CaSS, e.g. via a <strong>Single Sign On (SSO)</strong> system, an enterprise directory service, <strong>OAUTH</strong>, or some other means. In CaSS, an identity for an entity is a pair consisting of a public and private key in the sense of Public Key Infrastructure (PKI).</p> <p>In this document's notation:</p> <ul><li><code>publickey(entity)</code> represents the public key portion of the identity (also called an <strong>Identifier</strong>)</li> <li><code>identity(entity)</code> represents the public/private key pair (also called the <strong>Identity</strong>)</li></ul> <p>CaSS should not store any identities that include PII.</p> <h3 id="groups"><a href="#groups" class="header-anchor">#</a> Groups</h3> <p>Identities can belong to groups. Groups are also representable by identities. CaSS assumes that an external service can validate whether an identity belongs to a given group.</p> <h3 id="aes-encryption"><a href="#aes-encryption" class="header-anchor">#</a> AES encryption</h3> <p><a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard" target="_blank" rel="noopener noreferrer">AES encryption<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (or AES) refers to the Advanced Encryption Standard as established by the <a href="https://www.nist.gov/" target="_blank" rel="noopener noreferrer">National Institute of Standards (NIST)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. When applying KBAC, the same AES implementation should be used whenever encrypting or decrypting data. CaSS uses <strong>AES-256-CTR</strong> as defined in <a href="https://tools.ietf.org/html/rfc3686" target="_blank" rel="noopener noreferrer">IETF RFC3686<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. This implementation uses a 32-byte secret that is separate from a 32-byte <a href="https://en.wikipedia.org/wiki/Initialization_vector" target="_blank" rel="noopener noreferrer">initialization vector<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. In this document we will represent AES as two functions:</p> <div class="language- extra-class"><pre class="language-text"><code>ciphertext = aesEncrypt(plaintext, secret, iv)
plaintext = aesDecrypt(ciphertext, secret, iv)
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>Though plaintext will usually be a string, any ordered sequence of bytes may be passed in</p></div> <h3 id="rsa-encryption"><a href="#rsa-encryption" class="header-anchor">#</a> RSA encryption</h3> <p><a href="https://en.wikipedia.org/wiki/RSA_(cryptosystem)" target="_blank" rel="noopener noreferrer">RSA encryption<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> refers to the asymmetric RSA encryption algorithm. CaSS uses a 2048-bit version of <a href="https://www.inf.pucrs.br/~calazans/graduate/TPVLSI_I/RSA-oaep_spec.pdf" target="_blank" rel="noopener noreferrer">RSA-OAEP<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for encryption and decryption, and SHA1 with RSA for signing and verification. In this document we will represent the functions relevant to RSA encryption as:</p> <div class="language- extra-class"><pre class="language-text"><code>new unique public and private key pair = generateKeys()
privatekey = private key from PPK = privateKey(PPK)
publickey = public key from PPK = publicKey(PPK)
ciphertext generated by applying RSA to plaintext (&lt; 256 bytes) = rsaEncrypt(plaintext, privatekey)
plaintext = rsaDecrypt(ciphertext, publickey)
signature = rsaSign(plaintext, privatekey)`
rsaVerify(signature, publickey) is true ⇔ rsaSign(signature, publickey) is an identifiable signature that conforms to an agreed-upon format for signatures.
</code></pre></div><h3 id="cryptographic-encodings"><a href="#cryptographic-encodings" class="header-anchor">#</a> Cryptographic Encodings</h3> <p>Cryptographic objects shall be encoded in the following fashions prior to storage in JSON:</p> <table><thead><tr><th>object</th> <th>encoding</th></tr></thead> <tbody><tr><td>secret</td> <td>Base64</td></tr> <tr><td>iv</td> <td>Base64</td></tr> <tr><td>privatekey</td> <td>PKCS#8 encoding with whitespace removed</td></tr> <tr><td>publickey</td> <td>PEM encoded SubjectPublicKeyInfo with whitespace removed</td></tr> <tr><td>ciphertext</td> <td>Base64</td></tr> <tr><td>signature</td> <td>SHA1 encoding before signature creation, Base64 encoding of the signature.</td></tr></tbody></table> <h3 id="kbac-components"><a href="#kbac-components" class="header-anchor">#</a> KBAC Components</h3> <p>A KBAC-conformant object should implement the following JSON-LD fields, if applicable:</p> <ul><li><code>@context</code></li> <li><code>@type</code></li> <li><code>@id</code></li></ul> <p>Definitions can be found in the <a href="https://json-ld.org/spec/ED/json-ld-syntax/20120522/#syntax-tokens-and-keywords" target="_blank" rel="noopener noreferrer">JSON-LD Specification<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>A KBAC-conformant JSON-LD object may contain the following fields:</p> <ul><li><code>@owner</code> <ul><li>The public keys of entities who are allowed to edit or delete the object.</li></ul></li> <li><code>@reader</code> <ul><li>The public keys of entities who are allowed to discover or read the object if the object is encrypted.</li></ul></li> <li><code>@signature</code> <ul><li>A cryptographic signature that can be decrypted and validated using the public keys of identities listed in <code>@owner</code> or <code>@reader</code>.  (The ability to decrypt a signature with one of these public keys is prima facie evidence that the corresponding identity created the signature.)</li></ul></li></ul> <p>Each of these fields shall, in its natural state, be an array.</p> <h3 id="kbac-identifiers"><a href="#kbac-identifiers" class="header-anchor">#</a> KBAC Identifiers</h3> <p>A KBAC-conformant URL shall be a resolvable URL (<a href="https://tools.ietf.org/html/rfc1738" target="_blank" rel="noopener noreferrer">RFC 1738<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="https://tools.ietf.org/html/rfc3986" target="_blank" rel="noopener noreferrer">3986<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, etc.) composed of the following parts:</p> <ul><li><strong>protocol</strong> <ul><li>http:// or https://</li></ul></li> <li><strong>endpoint</strong> <ul><li>hostname and path</li></ul></li> <li><strong>type</strong> <ul><li><code>@context</code> + <code>@type</code> with protocol removed and all sequences of symbols replaced with dots.
<ul><li>ex: <code>http://schema.cassproject.org/0.2/competency</code> -&gt; <code>schema.cassproject.org.0.2.competency</code></li></ul></li></ul></li> <li><strong>unique identifier</strong> <ul><li>May be a randomly generated GUID</li> <li>May be a canonical identifier with at least one letter or symbol.</li></ul></li> <li><strong>version</strong> <em>optional</em> <ul><li>Time the object was last modified in milliseconds since the epoch.</li></ul></li></ul> <p>When the version is omitted, the URL refers to the most recent version of the object.</p> <h2 id="types"><a href="#types" class="header-anchor">#</a> Types</h2> <h3 id="example-type-file"><a href="#example-type-file" class="header-anchor">#</a> Example Type -- File</h3> <p>A functional example of a JSON-LD File object follows:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;@context&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://schema.eduworks.com/general/0.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@owner&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>publickey1<span class="token punctuation">,</span> publickey2<span class="token punctuation">,</span> ...<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@signature&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        rsaSign(toSignableObject(this)<span class="token punctuation">,</span>privatekey1)<span class="token punctuation">,</span>
        rsaSign(toSignableObject(this)<span class="token punctuation">,</span>privatekey2)<span class="token punctuation">,</span>
        ...
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;mimeType&quot;</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
    <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> string
<span class="token punctuation">}</span>
</code></pre></div><h3 id="owners-and-signatures"><a href="#owners-and-signatures" class="header-anchor">#</a> Owners and Signatures</h3> <p>The algorithm to annotate a JSON-LD object follows:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;@owner&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>publickey1<span class="token punctuation">,</span>publickey2<span class="token punctuation">,</span>...<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@reader&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>publickey3<span class="token punctuation">,</span>publickey4<span class="token punctuation">,</span>...<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@signature&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
        rsaSign(toSignableObject(this)<span class="token punctuation">,</span>privatekey1)<span class="token punctuation">,</span>
        rsaSign(toSignableObject(this)<span class="token punctuation">,</span>privatekey2)<span class="token punctuation">,</span>
        ...
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The algorithm to prepare an object for signing follows:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">toSignableObject</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span> <span class="token operator">=</span>
    remove from object the fields<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@signature&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;@id&quot;</span><span class="token punctuation">]</span>
    Serialize to <span class="token constant">JSON</span> <span class="token keyword">with</span> zero whitespace <span class="token keyword">with</span> fields <span class="token keyword">in</span> <span class="token constant">ASCII</span> order<span class="token punctuation">.</span>
</code></pre></div><p>To verify an object:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">rsaVerify</span><span class="token punctuation">(</span><span class="token function">toSignableObject</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">,</span> signature1<span class="token punctuation">,</span> publickey1<span class="token punctuation">)</span>
</code></pre></div><p>To sign an object:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">rsaSign</span><span class="token punctuation">(</span><span class="token function">toSignableObject</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">,</span> privatekey1<span class="token punctuation">)</span>
</code></pre></div><p>If an object is annotated with KBAC fields and being stored in a repository, the system storing the object:</p> <ol><li>Must provide a signatureSheet with a valid signature for at least one owner.</li> <li>Must remove all invalid signatures.</li> <li>Should append at least one valid signature to the object.</li></ol> <p>The repository the object is being stored in:</p> <ol><li>Must validate all SignatureSheetSignatures in the SignatureSheet by:
<ul><li>Ensuring the expiry timestamp has not elapsed.</li> <li>Ensuring that the server url pertains to this machine and, if it specifies an object identifier, the object being stored.</li> <li>Ensuring the signature of the SignatureSheetSignature is valid.</li></ul></li> <li>If the object is being modified, must have at least one SignatureSheetSignature common with the unmodified object’s owner.</li> <li>Must validate any signatures provided with the object.</li></ol> <p>Any failure of any of these criteria shall result in an error.</p> <h3 id="signaturesheetsignature"><a href="#signaturesheetsignature" class="header-anchor">#</a> SignatureSheetSignature</h3> <p>A SignatureSheetSignature has the following fields:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;expiry&quot;</span><span class="token operator">:</span> long<span class="token punctuation">,</span> <span class="token comment">// (unix timestamp)</span>
    <span class="token property">&quot;server&quot;</span><span class="token operator">:</span> url
<span class="token punctuation">}</span>
</code></pre></div><p>And is generated by:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createSignatureSheetSignature</span><span class="token punctuation">(</span><span class="token parameter">ppk<span class="token punctuation">,</span>serverUrl<span class="token punctuation">,</span>expiryMilliseconds</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;@context&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://schema.cassproject.org/kbac/0.2/&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;@type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;TimeLimitedSignature&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;@owner&quot;</span><span class="token operator">:</span> <span class="token function">publickey</span><span class="token punctuation">(</span>ppk<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;@signature&quot;</span><span class="token operator">:</span> <span class="token function">rsaSign</span><span class="token punctuation">(</span><span class="token function">toSignableObject</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">privatekey</span><span class="token punctuation">(</span>ppk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;expiry&quot;</span><span class="token operator">:</span> <span class="token function">nowInUnixTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>expiryMilliseconds<span class="token punctuation">,</span>
        <span class="token string-property property">&quot;server&quot;</span><span class="token operator">:</span> serverUrl
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">signatureSheetSignatureValid</span><span class="token punctuation">(</span><span class="token parameter">object<span class="token punctuation">,</span>serverUrl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token function">rsaVerify</span><span class="token punctuation">(</span>object remove @signature<span class="token punctuation">,</span> @signature1<span class="token punctuation">,</span> @owner1<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        expiry <span class="token operator">&gt;</span> <span class="token function">nowInUnixTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        <span class="token function">startsWith</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> serverUrl<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="signaturesheet"><a href="#signaturesheet" class="header-anchor">#</a> SignatureSheet</h3> <p>A signature sheet is an array of SignatureSheetSignature:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span>signatureSheetSignature1<span class="token punctuation">,</span> signatureSheetSignature2<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">]</span>
</code></pre></div><h3 id="encryptedvalue"><a href="#encryptedvalue" class="header-anchor">#</a> EncryptedValue</h3> <p>EncryptedValue is an object that stores encrypted data. It has the following fields:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;@encryptedType&quot;</span><span class="token operator">:</span> @context + @type of the object encrypted. Optional.
    <span class="token property">&quot;secret&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>secret1<span class="token punctuation">,</span> secret2<span class="token punctuation">]</span>
    <span class="token property">&quot;payload&quot;</span><span class="token operator">:</span> ciphertext
<span class="token punctuation">}</span>
</code></pre></div><p>The following function specifies the object used to store a secret, iv, and other data for encryption:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">encryptedSecret</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span>field<span class="token punctuation">,</span>secret<span class="token punctuation">,</span>iv</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;s&quot;</span><span class="token operator">:</span> secret<span class="token punctuation">,</span>
        <span class="token string-property property">&quot;f&quot;</span><span class="token operator">:</span> field<span class="token punctuation">,</span>
        <span class="token string-property property">&quot;v&quot;</span><span class="token operator">:</span> iv<span class="token punctuation">,</span>
        <span class="token string-property property">&quot;d&quot;</span><span class="token operator">:</span> obj<span class="token punctuation">[</span><span class="token string">&quot;@id&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">toEncryptedValue</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> value<span class="token punctuation">,</span> field<span class="token punctuation">,</span> secret<span class="token punctuation">,</span> iv<span class="token punctuation">,</span> <span class="token punctuation">[</span>publickey1<span class="token punctuation">,</span> publickey2<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;@context&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://schema.cassproject.org/kbac/0.2/&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;@type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;EncryptedValue&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;@encryptedType&quot;</span><span class="token operator">:</span> obj<span class="token punctuation">[</span><span class="token string">&quot;@type&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;@owner&quot;</span><span class="token operator">:</span> obj<span class="token punctuation">[</span><span class="token string">&quot;@owner&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;@signature&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">rsaSign</span><span class="token punctuation">(</span><span class="token function">toSignableObject</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span>obj<span class="token punctuation">.</span>@owner1<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;@reader&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>publickey1<span class="token punctuation">,</span>publickey2<span class="token punctuation">,</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;secret&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token function">rsaEncrypt</span><span class="token punctuation">(</span><span class="token function">encryptedSecret</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> field<span class="token punctuation">,</span> secret<span class="token punctuation">,</span> iv<span class="token punctuation">)</span><span class="token punctuation">,</span> @owner1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">,</span>
            <span class="token function">rsaEncrypt</span><span class="token punctuation">(</span><span class="token function">encryptedSecret</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> field<span class="token punctuation">,</span> secret<span class="token punctuation">,</span> iv<span class="token punctuation">)</span><span class="token punctuation">,</span> @reader1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">...</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;payload&quot;</span><span class="token operator">:</span> <span class="token function">aesEncrypt</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span>secret<span class="token punctuation">,</span>iv<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Additionally:</p> <ul><li><strong>Secret</strong> and <strong>IV</strong> should be randomly generated.</li> <li>If <code>toEncryptedValue</code> is encrypting an object, the value shall be the serialized object and field shall be omitted.</li> <li>If <code>toEncryptedValue</code> is encrypting a field of an object, the value shall be the value of the field, and field shall be the JSONPath dot-and-bracket notation of the field’s location.</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fromEncryptedValue</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> <span class="token punctuation">[</span>ppk1<span class="token punctuation">,</span>ppk2<span class="token punctuation">,</span><span class="token operator">...</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> all i<span class="token operator">=</span>ppk<span class="token punctuation">,</span> j<span class="token operator">=</span>obj<span class="token punctuation">[</span><span class="token string">&quot;secret&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> stop on first decryption that results <span class="token keyword">in</span> a valid <span class="token constant">JSON</span> object
        <span class="token function">aesDecrypt</span><span class="token punctuation">(</span>
            obj<span class="token punctuation">[</span><span class="token string">&quot;plaintext&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token function">rsaDecrypt</span><span class="token punctuation">(</span>secretj<span class="token punctuation">,</span><span class="token function">privatekey</span><span class="token punctuation">(</span>ppki<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&quot;s&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token function">rsaDecrypt</span><span class="token punctuation">(</span>secretj<span class="token punctuation">,</span><span class="token function">privatekey</span><span class="token punctuation">(</span>ppki<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&quot;v&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">)</span>
    <span class="token keyword">return</span> the result <span class="token keyword">of</span> above<span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>A repository must strip any EncryptedValue objects from search or get results if:</p> <ol><li>A signatureSheet is not provided with the request.</li> <li>A signatureSheetSignature is invalid (based on the criteria given previously).</li> <li>A signatureSheetSignature does not provide a public key matching a key in the @reader or @owner fields of the result under consideration.</li></ol> <h2 id="identity-server-types-and-operations"><a href="#identity-server-types-and-operations" class="header-anchor">#</a> Identity Server, Types and Operations</h2> <p>It is common to use usernames and passwords in order to provide access to a system. In KBAC, a username and password may be used to store and retrieve credentials from a repository. The following types, functions and requirements provide a method of storing credentials in an encrypted fashion.</p> <h3 id="credential"><a href="#credential" class="header-anchor">#</a> Credential</h3> <p>A <code>Credential</code> object stores a private key in an encrypted form and has the following fields:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;iv&quot;</span><span class="token operator">:</span> iv<span class="token punctuation">,</span>
    <span class="token property">&quot;ppk&quot;</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
    <span class="token property">&quot;displayNameIv&quot;</span><span class="token operator">:</span> iv<span class="token punctuation">,</span>
    <span class="token property">&quot;displayName&quot;</span><span class="token operator">:</span> string
<span class="token punctuation">}</span>
</code></pre></div><p>Additionally:</p> <ul><li><code>Iv</code> should be regenerated any time the value of ppk is changed.</li> <li><code>displayNameIv</code> should be regenerated any time displayName is changed.</li></ul> <p>A functional definition follows:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">createCredential</span><span class="token punctuation">(</span><span class="token parameter">pk<span class="token punctuation">,</span> secret<span class="token punctuation">,</span> iv<span class="token punctuation">,</span> displayNameIv<span class="token punctuation">,</span> displayName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;@context&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://schema.cassproject.org/kbac/0.2/&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;@type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Credential&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;iv&quot;</span><span class="token operator">:</span> iv<span class="token punctuation">,</span>
        <span class="token string-property property">&quot;ppk&quot;</span><span class="token operator">:</span> <span class="token function">aesEncrypt</span><span class="token punctuation">(</span><span class="token function">pem</span><span class="token punctuation">(</span>ppk<span class="token punctuation">)</span><span class="token punctuation">,</span>secret<span class="token punctuation">,</span>iv<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;displayNameIv&quot;</span><span class="token operator">:</span> displayNameIv<span class="token punctuation">,</span>
        <span class="token string-property property">&quot;displayName&quot;</span><span class="token operator">:</span> <span class="token function">aesEncrypt</span><span class="token punctuation">(</span>displayName<span class="token punctuation">,</span>secret<span class="token punctuation">,</span>displayNameIv<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="contact"><a href="#contact" class="header-anchor">#</a> Contact</h3> <p>A <code>Contact</code> stores a public key in an encrypted form. It has the following fields:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;iv&quot;</span><span class="token operator">:</span> iv<span class="token punctuation">,</span>
    <span class="token property">&quot;pk&quot;</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
    <span class="token property">&quot;displayNameIv&quot;</span><span class="token operator">:</span> iv<span class="token punctuation">,</span>
    <span class="token property">&quot;displayName&quot;</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
    <span class="token property">&quot;sourceIv&quot;</span><span class="token operator">:</span> iv<span class="token punctuation">,</span>
    <span class="token property">&quot;source&quot;</span><span class="token operator">:</span> string
<span class="token punctuation">}</span>
</code></pre></div><p>A functional definition follows:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createContact</span><span class="token punctuation">(</span><span class="token parameter">pk<span class="token punctuation">,</span> secret<span class="token punctuation">,</span> iv<span class="token punctuation">,</span> displayNameIv<span class="token punctuation">,</span> sourceIv<span class="token punctuation">,</span> displayName<span class="token punctuation">,</span> source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;@context&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://schema.cassproject.org/kbac/0.2/&quot;</span>
        <span class="token string-property property">&quot;@type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Contact&quot;</span>
        <span class="token string-property property">&quot;iv&quot;</span><span class="token operator">:</span> iv
        <span class="token string-property property">&quot;pk&quot;</span><span class="token operator">:</span> <span class="token function">aesEncrypt</span><span class="token punctuation">(</span><span class="token function">pem</span><span class="token punctuation">(</span>pk<span class="token punctuation">)</span><span class="token punctuation">,</span>secret<span class="token punctuation">,</span>iv<span class="token punctuation">)</span>
        <span class="token string-property property">&quot;displayNameIv&quot;</span><span class="token operator">:</span> displayNameIv
        <span class="token string-property property">&quot;displayName&quot;</span><span class="token operator">:</span> <span class="token function">aesEncrypt</span><span class="token punctuation">(</span>displayName<span class="token punctuation">,</span>secret<span class="token punctuation">,</span>displayNameIv<span class="token punctuation">)</span>
        <span class="token string-property property">&quot;sourceIv&quot;</span><span class="token operator">:</span> displayNameIv
        <span class="token string-property property">&quot;source&quot;</span><span class="token operator">:</span> <span class="token function">aesEncrypt</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span>secret<span class="token punctuation">,</span>sourceIv<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="credentials"><a href="#credentials" class="header-anchor">#</a> Credentials</h3> <p>A <code>Credentials</code> object stores public and private keys in an encrypted form. It has the following functional definition:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createCredentials</span><span class="token punctuation">(</span><span class="token parameter">Credential<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Contact<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pad<span class="token punctuation">,</span> token</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;@context&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://schema.cassproject.org/kbac/0.2/&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;@type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Contact&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;token&quot;</span><span class="token operator">:</span> <span class="token comment">/* Optional */</span> token<span class="token punctuation">,</span>
        <span class="token string-property property">&quot;credentials&quot;</span><span class="token operator">:</span> Credential<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;contacts&quot;</span><span class="token operator">:</span> Contact<span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="hashing"><a href="#hashing" class="header-anchor">#</a> Hashing</h3> <p>The storage and retrieval of user credentials uses hashing. Each repository should generate a random hash, and systems using that repository should retrieve the following from the repository: the hash, the number of hashing iterations, and the length of the hash result.</p> <p>In CaSS, <a href="https://en.wikipedia.org/wiki/PBKDF2" target="_blank" rel="noopener noreferrer">PBKDF2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> using an <strong>HMAC SHA-1</strong> hash is used for hashing user credentials, defined by the following parameters and function:</p> <ul><li><strong>Value</strong>: string</li> <li><strong>Salt</strong>: string</li> <li><strong>Iterations</strong>: integer</li> <li><strong>Width</strong>: integer, length of the resultant hash in bytes</li></ul> <p>Additionally:</p> <ul><li>The number of iterations should be at least 5000.</li> <li>The width of the result should be at least 32 bytes.</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>hash <span class="token operator">=</span> <span class="token function">pbkdf2</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> salt<span class="token punctuation">,</span> iterations<span class="token punctuation">,</span> width<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="operations"><a href="#operations" class="header-anchor">#</a> Operations</h3> <h4 id="prepare"><a href="#prepare" class="header-anchor">#</a> Prepare</h4> <p>The following function may be used to splice strings.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">splice</span><span class="token punctuation">(</span><span class="token parameter">strings</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> result<span class="token punctuation">;</span>

    <span class="token comment">/*
    for all strings i and character positions j:
        [stringi,j,stringi+1,j,stringi+2,j,...] + [stringi,j+1,stringi+1,j+1,stringi+2,j+1] + ...
    */</span>

    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Any non-displayable characters are omitted.</p> <p>Given the following:</p> <ul><li>Username</li> <li>Password</li> <li>UsernameSalt</li> <li>PasswordSalt</li> <li>SecretSalt</li> <li>UsernameIterations</li> <li>PasswordIterations</li> <li>SecretIterations</li> <li>UsernameWidth</li> <li>PasswordWidth</li> <li>SecretWidth</li></ul> <p>The following functions hash a username and password, and provide a secret used to encrypt credentials:</p> <div class="language-js extra-class"><pre class="language-js"><code>usernameHash <span class="token operator">=</span> <span class="token function">pbkdf2</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> usernameSalt<span class="token punctuation">,</span> usernameIterations<span class="token punctuation">,</span> usernameWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
passwordHash <span class="token operator">=</span> <span class="token function">pbkdf2</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> passwordSalt<span class="token punctuation">,</span> passwordIterations<span class="token punctuation">,</span> passwordWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
secretHash <span class="token operator">=</span> <span class="token function">pbkdf2</span><span class="token punctuation">(</span><span class="token function">splice</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">,</span> secretSalt<span class="token punctuation">,</span> secretIterations<span class="token punctuation">,</span> secretWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><em>secretHash</em> is used as the secret in the encryption and decryption of Credential and Contact objects.</p> <h4 id="fetch"><a href="#fetch" class="header-anchor">#</a> Fetch</h4> <p>To fetch a credential package from a server, construct a <code>CredentialRequest</code> with the following functional definition:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createCredentialRequest</span><span class="token punctuation">(</span><span class="token parameter">usernameHash<span class="token punctuation">,</span> passwordHash</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;@context&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://schema.cassproject.org/kbac/0.2/&quot;</span>
        <span class="token string-property property">&quot;@type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;CredentialRequest&quot;</span>
        <span class="token string-property property">&quot;username&quot;</span><span class="token operator">:</span> usernameHash
        <span class="token string-property property">&quot;password&quot;</span><span class="token operator">:</span> passwordHash
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The submission of this request to a server should occur over HTTPS. The response will be a Credentials object.</p> <p>On the server side, the repository must:</p> <ul><li>Create or Load <em>serverUrl, serverPpk, serverSecret, serverSalt, serverIterations, serverWidth</em></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">saltedId</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">pbkdf2</span><span class="token punctuation">(</span>
        request<span class="token punctuation">[</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        serverSalt<span class="token punctuation">,</span>
        serverIterations<span class="token punctuation">,</span>
        serverWidth
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">fetchResponse</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">aesDecrypt</span><span class="token punctuation">(</span><span class="token comment">/*
        fetch encryptedValue WHERE
        @id = request[&quot;username&quot;] AND
        rsaDecrypt(
            encryptedValue[&quot;payload&quot;],
            serverSecret,
            saltedId
        )[&quot;password&quot;] = request[&quot;password&quot;]
    */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* Then replace credentials[&quot;token&quot;] with a new random token. */</span>
    <span class="token comment">/* Store the credentials with the new token in the same fashion as commitResponse. */</span>
    <span class="token comment">/* Return the result. */</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="store"><a href="#store" class="header-anchor">#</a> Store</h4> <p>To store a credential package in an identity server, create a <code>CredentialCommit</code> using the following functional definition:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createCredentialCommit</span><span class="token punctuation">(</span>
    <span class="token parameter">usernameHash<span class="token punctuation">,</span> passwordHash<span class="token punctuation">,</span> secretHash<span class="token punctuation">,</span> token<span class="token punctuation">,</span> Credentials<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Contacts<span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;@context&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://schema.cassproject.org/kbac/0.2/&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;@type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;CredentialCommit&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;username&quot;</span><span class="token operator">:</span> usernameHash<span class="token punctuation">,</span>
        <span class="token string-property property">&quot;password&quot;</span><span class="token operator">:</span> passwordHash<span class="token punctuation">,</span>
        <span class="token string-property property">&quot;token&quot;</span><span class="token operator">:</span> token<span class="token punctuation">,</span>
        <span class="token string-property property">&quot;credentials&quot;</span><span class="token operator">:</span> <span class="token function">createCredentials</span><span class="token punctuation">(</span>Credentials<span class="token punctuation">,</span> Contacts<span class="token punctuation">,</span> pk<span class="token punctuation">,</span> secretHash<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Credentials</strong> and <strong>Contacts</strong> should be created through the following parameterization:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">createCredential</span><span class="token punctuation">(</span>
    secret<span class="token punctuation">,</span> <span class="token comment">// secretHash,</span>
    iv<span class="token punctuation">,</span> <span class="token comment">// Random iv,</span>
    ppk<span class="token punctuation">,</span> <span class="token comment">// Ppk of the user,</span>
    displayNameIv<span class="token punctuation">,</span> <span class="token comment">// Random iv,</span>
    displayName <span class="token comment">// Display name for the user</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>

<span class="token function">createContact</span><span class="token punctuation">(</span>
    pk<span class="token punctuation">,</span> <span class="token comment">// Pk of the contact</span>
    secret<span class="token punctuation">,</span> <span class="token comment">// secretHash</span>
    iv<span class="token punctuation">,</span> <span class="token comment">// Random iv</span>
    displayNameIv<span class="token punctuation">,</span> <span class="token comment">// Random iv</span>
    sourceIv<span class="token punctuation">,</span> <span class="token comment">// Random iv</span>
    displayName<span class="token punctuation">,</span> <span class="token comment">// Display name of the contact</span>
    source<span class="token punctuation">,</span> <span class="token comment">// Home server of the contact</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div><p>The submission of this request to a server should occur over HTTPS. The response will be a confirmation or error string.</p> <p>The repository, upon receiving a credentialCommit shall:</p> <ul><li>Create or Load <em>serverUrl, serverPpk, serverSecret, serverSalt, serverIterations, serverWidth</em></li> <li>Execute the following functional definition:</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">commitResponse</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
        <span class="token function">isSuccessful</span><span class="token punctuation">(</span><span class="token function">fetchResponse</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        <span class="token function">fetchResponse</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">]</span> <span class="token operator">===</span> request<span class="token punctuation">[</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> signatureSheet <span class="token operator">=</span> <span class="token function">createSignatureSheetSignature</span><span class="token punctuation">(</span>serverPpk<span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">,</span>serverUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string-property property">&quot;@context&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://schema.cassproject.org/kbac/0.2/&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;@type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;EncryptedValue&quot;</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;@owner&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">pkFromPpk</span><span class="token punctuation">(</span>serverPpk<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;@signature&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">rsaSign</span><span class="token punctuation">(</span><span class="token function">toSignableObject</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span>serverPpk<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string-property property">&quot;plaintext&quot;</span><span class="token operator">:</span> <span class="token function">aesEncrypt</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">/* Store obj at saltedId(request) using signatureSheet */</span>
    <span class="token punctuation">}</span>
</code></pre></div><h2 id="repository"><a href="#repository" class="header-anchor">#</a> Repository</h2> <p>A KBAC repository is a <strong>REST-based</strong> repository, with its reference implementation built in <strong>LEVR</strong> using <strong>ElasticSearch</strong> for discovery, but may be implemented using different methods in different storage mediums such as <em>relational databases</em>, <em>triple stores</em>, or as <em>static files</em>.</p> <p>The repository must follow these rules:</p> <ul><li>Search or Read requests shall hide <code>EncryptedValue</code> objects if an owner or reader signature is not provided in a signature sheet and validated.</li> <li>Objects may only be stored if a signature is provided that validates the written object.</li> <li>Before writing an object to a repository, the repository shall ensure that a valid signature has been provided in a signature sheet that matches one of the owners provided in the object in the repository (if an object exists in the repository), and that the signature in the object is valid.</li> <li>Before deleting an object from a repository, the repository shall ensure that a valid signature in a signature sheet has been provided and matches an owner of the object in the repository.</li></ul> <h3 id="web-service-operation-pseudocode"><a href="#web-service-operation-pseudocode" class="header-anchor">#</a> Web Service Operation Pseudocode</h3> <h4 id="filter"><a href="#filter" class="header-anchor">#</a> Filter</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">result<span class="token punctuation">,</span> signatureSheet</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> result<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/* Remove result[i] and its children */</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>@type <span class="token operator">===</span> <span class="token string">&quot;EncryptedValue&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> decryptable <span class="token operator">=</span> <span class="token punctuation">(</span>
                <span class="token function">signatureSheetSignatureValid</span><span class="token punctuation">(</span>signatureSheet<span class="token punctuation">[</span><span class="token number">0.</span><span class="token punctuation">.</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> serverUrl<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                <span class="token punctuation">(</span>result<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>@owner ∩ signatureSheetn<span class="token punctuation">.</span>@owner<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Unable to decrypt?</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>decryptable <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">/* Delete result[i]; */</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    remove from
        result0<span class="token punctuation">.</span><span class="token punctuation">.</span>n
    resultn and children <span class="token keyword">of</span> resultn <span class="token function">where</span>
        <span class="token punctuation">(</span>resultn<span class="token punctuation">.</span>@type <span class="token operator">!==</span> EncryptedValue unless
                <span class="token function">signatureSheetSignatureValid</span><span class="token punctuation">(</span>signatureSheet0<span class="token punctuation">.</span><span class="token punctuation">.</span>n<span class="token punctuation">,</span>serverUrl<span class="token punctuation">)</span> <span class="token function">and</span>
                <span class="token punctuation">(</span>resultn<span class="token punctuation">.</span>@owner0<span class="token punctuation">.</span><span class="token punctuation">.</span>j ∩ signatureSheetn<span class="token punctuation">.</span>@owner <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="create"><a href="#create" class="header-anchor">#</a> Create</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter">object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token comment">/* SELECT record FROM store WHERE record.@id = id */</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
        <span class="token function">rsaVerify</span><span class="token punctuation">(</span><span class="token function">toSignableObject</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">,</span> object<span class="token punctuation">.</span>@signature0<span class="token punctuation">.</span><span class="token punctuation">.</span>i<span class="token punctuation">,</span> object<span class="token punctuation">.</span>@owner0<span class="token punctuation">.</span><span class="token punctuation">.</span>j<span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/* Create object.@id = object */</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="read"><a href="#read" class="header-anchor">#</a> Read</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> signatureSheet</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">filter</span><span class="token punctuation">(</span><span class="token comment">/* SELECT record FROM store WHERE record.@id = id,signatureSheet */</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="update"><a href="#update" class="header-anchor">#</a> Update</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">object<span class="token punctuation">,</span> signatureSheet</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
        <span class="token function">rsaVerify</span><span class="token punctuation">(</span><span class="token function">toSignableObject</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">,</span> object<span class="token punctuation">.</span>@signature0<span class="token punctuation">.</span><span class="token punctuation">.</span>i<span class="token punctuation">,</span> object<span class="token punctuation">.</span>@owner0<span class="token punctuation">.</span><span class="token punctuation">.</span>j<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        <span class="token function">signatureSheetSignatureValid</span><span class="token punctuation">(</span>signatureSheet0<span class="token punctuation">.</span><span class="token punctuation">.</span>n<span class="token punctuation">,</span> serverUrl<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        <span class="token punctuation">(</span><span class="token function">retrieve</span><span class="token punctuation">(</span>object<span class="token punctuation">.</span>@id<span class="token punctuation">)</span><span class="token punctuation">.</span>@owner0<span class="token punctuation">.</span><span class="token punctuation">.</span>j ∩ signatureSheetn<span class="token punctuation">.</span>@owner<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/* Store object.@id = object */</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="delete"><a href="#delete" class="header-anchor">#</a> Delete</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token parameter">object<span class="token punctuation">,</span> signatureSheet</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
        <span class="token function">signatureSheetSignatureValid</span><span class="token punctuation">(</span>signatureSheets<span class="token punctuation">[</span>i<span class="token punctuation">.</span><span class="token punctuation">.</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        <span class="token punctuation">(</span><span class="token function">retrieve</span><span class="token punctuation">(</span>object<span class="token punctuation">.</span>@id<span class="token punctuation">)</span><span class="token punctuation">.</span>@owner0<span class="token punctuation">.</span><span class="token punctuation">.</span>j ∩ signatureSheetn<span class="token punctuation">.</span>@owner<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/* Delete object.@id */</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="search"><a href="#search" class="header-anchor">#</a> Search</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token parameter">query<span class="token punctuation">,</span> signatureSheet</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">filter</span><span class="token punctuation">(</span><span class="token comment">/* Search for query, signatureSheet */</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/dev/extending-cass/adapters/ims-open-badge/" class="prev">
        IMS Open Badge 2.0
      </a></span> <span class="next"><a href="/docs/dev/security/kbac-threat-model/">
        KBAC Threat Model
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.28f45806.js" defer></script><script src="/docs/assets/js/2.5190c88e.js" defer></script><script src="/docs/assets/js/74.64dfe9e5.js" defer></script>
  </body>
</html>
